{"data":{"css":"#headertitle{\n  width:100%;\n  font-size: 1em;\n  min-height: 1.1em;\n  text-align: center;\n  display: block;\n  padding: .7em 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n  outline: 0!important;\n  text-shadow: 0 0 0 #4b8c2a;\n  font-weight: 500;\n  line-height: 1.1;\n  color: white;\n  background-color:#4b8c2a;\n  margin:0px;\n}\n\n.wrap{\n  background-color:#888;\n  position:relative;\n  border-width:0px;\n  width:100%;\n}\n\n.wrap h2 {\n  width:100%;\n  text-align:center;\n  position:absolute\n  top:-10px;\n  left:0px;\n  color:white;\n}\n\n.pb-peer-more{\n  width:300px;\n  height:155px;\n  overflow-y: auto;\n}\n\n.peerholder, .pb-accesscode{\n  border:thin solid black;\n  margin-bottom:-1px;\n  margin-right:-1px;\n  display:inline-block;\n  vertical-align:top;\n  color:white;\n  position:relative;\n}  \n\n.pb-accesscode{\n  background-color:#d9dbe0;\n  color:black;\n}\n\n.addcon, .addcode, .addinvite{\n  position:absolute;\n  top:0px;\n  left:0px;\n  bottom:0px;\n  right:0px;\n  overflow-y:auto;\n}\n\n.addconwrap, .addconwrap, .addinvitewrap{\n  margin-top:60px;\n  max-width:640px;\n  margin-left:auto;\n  margin-right:auto;\n}\n\n.pb-deviceinfo{\n  text-align:center;\n  text-shadow: 0 0 0 #000000;\n  color:#84bd00;\n  background-color:black;\n  padding:10px;\n  margin-bottom:20px;\n}\n\n.pb-tab{\n  margin-right:30px;\n}\n\n.pb-peerlist, #botlist, #accesscodelist{\n  margin-bottom:40px;\n  text-align:center;\n}","data":[],"name":"peerbot_old","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\n$('body').css('background-color', '#888');\n\n$(ME).find('.pb-nav').click(function(){\n  $(ME).find('.pb-tab').css('display', 'none');\n  $(ME).find('.pb-'+this.id.substring(7)).css('display', 'block');\n});\n\n$('#newconnectionbutton').click(function(){\n  $(ME).find('.wrap').css('display', 'none');\n  $(ME).find('.addcon').css('display', 'block');\n});\n\n$('#adconbackbutton').click(function(){\n  $(ME).find('.wrap').css('display', 'block');\n  $(ME).find('.addcon').css('display', 'none');\n});\n\n$('#addaccesscodebutton').click(function(){\n  $(ME).find('.wrap').css('display', 'none');\n  $(ME).find('.addcode').css('display', 'block');\n  suggestAccessCode();\n});\n\n$('#adcodebackbutton').click(function(){\n  $(ME).find('.wrap').css('display', 'block');\n  $(ME).find('.addcode').css('display', 'none');\n});\n\n$('#createinvitebutton').click(function(){\n  $(ME).find('.wrap').css('display', 'none');\n  $(ME).find('.addinvite').css('display', 'block');\n  $('.invitepanel').css('display', 'none');\n  $('#inviteform').css('display', 'block');\n});\n\n$('.closeinvitedialog').click(function(){\n  $(ME).find('.wrap').css('display', 'block');\n  $(ME).find('.addinvite').css('display', 'none');\n});\n\n$('#grouplist').change(function(){\n  newContactGroup($(this).val());\n});\n\n$('#allowanon').click(function(){\n  json(\"../peerbot/allowanon\",\"allow=\"+$(this).prop('checked'), function(result) {\n    console.log(result);\n  });\n});\n\n$('#rescandiscoverybutton').click(discovery);\n\nfunction update(){\n  if ($('body').find($(ME).find('.wrap')[0])[0]) json('../peerbot/connections', null, function(result){\n    me.peers = result.data;\n    var firsttime = !me.uuids;\n    if (firsttime) me.uuids = '';\n    for (var id in me.peers){\n      if (me.uuids.indexOf(id) == -1) {\n        if (me.uuids != '') me.uuids += ' ';\n        me.uuids += id;\n      }\n      \n      var p = me.peers[id];\n      p.mode = 'more';\n      p.millis = result.currenttimemillis - p.lastcontact;\n      var el = $(ME).find('.'+id)[0];\n      if (el){\n        if (el.api) el.api.update(p);\n      }\n      else {\n        var el = $('<div class=\"peerholder '+id+'\">')[0];\n        $(ME).find('.pb-peerlist').append(el);\n        installControl(el, \"coreapps\", \"peer\", null, p);\n      }\n    }\n      \n    setTimeout(update, 5000);\n  });\n}\n\nupdate();\n\nme.ready = function(){\n  json(\"../peerbot/getpeerinfo\", null, function(result) {\n    $('#localpeerid').text(result.id);\n    $('#localpeerport').text(result.port);\n    $('#allowanon').prop('checked', result.allowanon).checkboxradio('refresh');\n\n    json(\"../securitybot/listgroups\", null, function(result){\n      var newhtml = '';\n      var newhtml2 = '';\n      for (var i in result.data) {\n        var x = '<option value=\"'+result.data[i]+'\">'+result.data[i]+'<\/option>';\n        if (result.data[i] != 'anonymous') newhtml2 += x;\n        newhtml += x;\n      }\n      $('#grouplist').html(newhtml).selectmenu('refresh');\n      $('#grouplist2').html(newhtml2).selectmenu('refresh');\n      $('#grouplist3').html(newhtml2).selectmenu('refresh');\n    \n      discovery();\n      listAccessCodes();\n    });\n  });\n};\n\nfunction addGroup(){\n\tvar val = $('#grouplist').val();\n\tvar groups = $(\"#newcontactgroup\").val().trim();\n\tif ((','+groups+',').indexOf(','+val+',') == -1){\n\t\tif (groups != '') groups += ',';\n\t    $(\"#newcontactgroup\").val(groups+val);\n\t}\n}\n\nfunction newContactGroup(val){\n\tif (val == 'anonymous') {\n\t\t$(\"#newcontactgroup\").val(val);\n        $('#addgroupbutton').html('');\n\t}\n\telse {\n\t\tif ($(\"#newcontactgroup\").val() == 'anonymous') $(\"#newcontactgroup\").val(val);\n\t\t$('#addgroupbutton').html(\"<input type='button' value='add' class='madbutton' data-inline='true'>\").trigger('create');\n        $(ME).find('.madbutton').click(addGroup);\n\t}\n}\n  \nfunction newConnection() {\n  var id = $('#newcontactid').val();\n  var addr = $('#newcontactip').val();\n  var port = $('#newcontactport').val();\n  var code = $('#newcontactcode').val();\n  var groups = $('#newcontactgroup').val();\n\n  if (!id || id.trim() == '') $('#newconactmsg').html('<font color=\"red\">Universal ID is required<\/font>');\n  else {\n    if (!addr || addr.trim() == '') addr='';\n    if (!port || port.trim() == '') port='';\n    if (!code || code.trim() == '') code='';\n    if (!groups || groups.trim() == '') groups='';\n  \n    $('#newconactmsg').html('<font color=\"green\">Connecting to: '+id+'<\/font>');\n    $.getJSON('../peerbot/newconnection?sessionid='+sessionid+'&uuid='+encodeURIComponent(id)+\"&addr=\"+encodeURIComponent(addr)+\"&port=\"+encodeURIComponent(port)+\"&code=\"+encodeURIComponent(code)+\"&groups=\"+encodeURIComponent(groups)+\"&callback=?\", function(result) {\n      if (result.status == 'ok') {\n        $('#newconactmsg').html('');\n        $('#adconbackbutton').click();\n      }\n      else {\n        $('#newconactmsg').html('<font color=\"red\">ERROR: '+result.msg+'<\/font>');\n        setTimeout(\"$('#newconactmsg').html('');\", 5000);\n      }\n    });\n  }  \n}  \n$('#addcontactbutton').click(newConnection);\n\nfunction discovery() {\n  $('#botlist').html('<div class=\"pb-deviceinfo\">Scanning...<\/div>');\n\n  json(\"../botmanager/discover\", null, function(result) {\n    console.log(result);\n    var newhtml = '';\n    if (result.status != 'ok') newhtml = '<font color=\"red\">Error: '+result.msg+'<\/font>';\n    else {\n      var n=0;\n      for (var item in result.data) {\n        var rai = result.data[item];\n        if (rai.peerinfo) {\n          n++;\n          var url = \"http://\"+rai.address[0]+':'+rai.port+'/';\n          var con = me.peers[rai.uuid];\n          var floater;\n          if (con) {\n            if (con.connected) floater = \"<font color='green'>connected<\/font><br><input type='button' value='disconnect' onclick='disconnect(\\\"\"+rai.uuid+\"\\\");' data-mini='true'>\";\n            else floater = \"not connected<br><input type='button' value='connect' onclick='connect(\\\"\"+rai.uuid+\"\\\");' data-mini='true' data-theme='a'>\";\n          }\n          else floater = \"<input type='button' value='add connection' onclick='addConnection(\\\"\"+rai.uuid+\"\\\",\\\"\"+rai.address[0]+\"\\\",\\\"\"+rai.peerinfo.port+\"\\\");' data-theme='a'>\";\n          newhtml \n            += '<li id=\"li_'+rai.name+'\"><div style=\"position:absolute;z-index:10;right:50px;text-align:right;\">'+floater+'<\/div><a id=\"a_'+rai.name+'\" class=\"li_botlist\" href=\"'+url+'\">'\n            + '<h3 class=\"ui-li-heading\">'+rai.name+' ('+rai.uuid+')<\/h3><p class=\"ui-li-desc\">'+rai.address[0]+':'+rai.port+'<\/p><\/a><\/li>';\n        }\n      }\n\t\t\t\n      if (n>0) newhtml \n          = '<ul id=\"ul_botlist\" data-role=\"listview\" data-inset=\"true\" data-theme=\"c\" data-divider-theme=\"b\"><li data-role=\"list-divider\">Available Peers<\/li>'\n          + newhtml\n          + '<\/ul>';\n      else newhtml = '<div class=\"pb-deviceinfo\">No Peers Detected in Local Network.<\/div>';\n    }\n    $('#botlist').html(newhtml);\n    $('#botlist').trigger('create');\n    document.getElementById('botlist').botlist = result.data;\n  });\n}\n\nconnect = function(uuid){\n  $(ME).find('.'+uuid)[0].api.connect(discovery);\n};\n\ndisconnect = function(uuid){\n  $(ME).find('.'+uuid)[0].api.disconnect(discovery);\n};\n\naddConnection = function(uuid, addr, port){\n  $('#newcontactid').val(uuid);\n  $('#newcontactip').val(addr);\n  $('#newcontactport').val(port);\n  \n  $('#newconnectionbutton').click();\n};\n\nfunction addGroupToCode(){\n    var g = $('#grouplist2').val();\n    var l = ','+$('#accesscodegroups').val()+',';\n    if (l.indexOf(','+g+',') == -1) {\n        l += g;\n        while (l.indexOf(',')==0) l = l.substring(1);\n        $('#accesscodegroups').val(l);\n    }\n}\n$('#addgrouptoaccesscode').click(addGroupToCode);\n\nfunction addGroupToInvite(){\n    var g = $('#grouplist3').val();\n    var l = ','+$('#invitegroups').val()+',';\n    if (l.indexOf(','+g+',') == -1) {\n        l += g;\n        while (l.indexOf(',')==0) l = l.substring(1);\n        $('#invitegroups').val(l);\n    }\n}\n$('#addgrouptoinvite').click(addGroupToInvite);\n\nfunction showInvite(which){\n    $('.invitepanel').css('display','none');\n    $('#'+which).css('display','block');\n}\n\nfunction createInvite(){\n\tjson('suggestaccesscode', null, function(result){\n\t\tvar code = encodeURIComponent(result.msg);\n\t\tvar del = true;\n\t\tvar groups = encodeURIComponent($('#invitegroups').val());\n\t\tjson('../peerbot/addaccesscode', 'code='+code+'&delete='+del+'&groups='+groups, function(result){\n\t\t    if (result.status == 'ok') {\n\t\t        var url = 'http://localhost:5773/peerbot/index.html?connect='+$('#localpeerid').text()+'&code='+code;\n                $('#newinvitelink').val(url);\n                setTimeout(function(){\n                    $('#newinvitelink').focus();\n                    $('#newinvitelink').select();\n                }, 500);\n\t\t        showInvite('inviteresult');\n                listAccessCodes();\n\t\t    }\n\t\t    else alert(result.msg);\n\t\t});\n\t});\n}\n$('#createtheinvite').click(createInvite);\n\nfunction addAccessCode(){\n\tvar code = encodeURIComponent($('#newaccesscode').val());\n\tvar del = $('#deleteonuse').prop('checked');\n\tvar groups = encodeURIComponent($('#accesscodegroups').val());\n\tjson('../peerbot/addaccesscode', 'code='+code+'&delete='+del+'&groups='+groups, function(result){\n\t\tif (result.status == 'ok') {\n\t\t\t$('#adcodebackbutton').click();\n\t\t\tlistAccessCodes();\n\t\t}\n\t\telse alert(result.msg);\n\t});\n}\n$('#addtheaccesscode').click(addAccessCode);\n\nfunction deleteAccessCode(id){\n\tjson('../peerbot/deleteaccesscode', 'code='+encodeURIComponent(id), function(result){\n\t\tlistAccessCodes();\n\t});\n}\n\nfunction suggestAccessCode(){\n\tjson('../peerbot/suggestaccesscode', null, function(result){\n\t\t$('#newaccesscode').val(result.msg);\n\t});\n}\n\nfunction listAccessCodes(){\n\tjson('../peerbot/accesscodes', null, function(result){\n\t\tvar newhtml = '';\n\t\tvar b = true;\n\t\t\t\n\t\tfor (var i in result.data){\n\t\t\tb = false;\n\t\t\tvar rdi = result.data[i];\n//\t\t\tnewhtml += '<li><div style=\"float:right;\"><a data-role=\"button\" data-inline=\"true\" data-mini=\"true\" onclick=\"deleteAccessCode(\\''+i+'\\');\">delete<\/a><\/div><h3>'+i+'<\/h3><p>'+(rdi.delete == 'true' ? 'Single use only: ' : 'Reusable: ')+rdi.groups+'<\/p><\/li>';\n          newhtml += '<div class=\"pb-accesscode\">'\n            + '<table border=\"0\" cellpadding=\"3\" cellspacing=\"0\"><tr><td rowspan=\"2\">'\n            + '<a class=\"deleteaccesscodebutton\" data-role=\"button\" data-icon=\"delete\" data-iconpos=\"notext\" data-inline=\"true\" data-mini=\"true\" data-theme=\"b\" data-id=\"'+i+'\">Delete<\/a>'\n            + '<\/td><td>'\n            + i\n            + '<\/td><\/tr><tr><td>'\n            + (rdi.delete == 'true' ? 'Single use only: ' : 'Reusable: ')+rdi.groups\n            + '<\/td><\/tr><\/table><\/div>';\n\t\t}\n        if (b) newhtml = '<div class=\"pb-deviceinfo\">None found...<\/div>';\n//        else newhtml = '<ul id=\"ul_invitelist\" data-role=\"listview\" data-inset=\"true\" data-theme=\"c\" data-divider-theme=\"a\"><li data-role=\"list-divider\">Access Codes<\/li>' + newhtml + '<\/ul>';\n\t\t$('#accesscodelist').html(newhtml).trigger('create');\n      \n      $(ME).find('.deleteaccesscodebutton').click(function(){\n        var id = $(this).data('id');\n        deleteAccessCode(id);\n      });\n\t});\n}\n","groups":"","ctl":"yoymiy162b5b3535dx6e8","html":"<h1 id=\"headertitle\">Peer Bot<\/h1>\n<a href=\"../botmanager/index.html\" data-role=\"none\" data-ajax=\"false\" style=\"position:absolute;top:2px;\"><img src=\"../botmanager/img/menu.png\" width=\"36px\"height=\"36px\"><\/a>\n<div data-role=\"navbar\" class=\"ui-body-b customnav\">\n    <ul>\n        <li><a href=\"#\" id=\"pb-nav-peers\" class=\"pb-nav ui-btn-active\">Peers<\/a><\/li>\n        <li><a href=\"#\" id=\"pb-nav-lan\" class=\"pb-nav\">LAN<\/a><\/li>\n        <li><a href=\"#\" id=\"pb-nav-accesscodes\" class=\"pb-nav\">Access Codes<\/a><\/li>\n    <\/ul>\n<\/div>\n<div class='wrap ui-body-c ui-body'>\n  <div class='pb-peers pb-tab'>\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\">\n      <tr>\n        <td width='300px'><label><input type=\"checkbox\" name=\"allowanon\" id=\"allowanon\" class=\"custom\" data-theme=\"c\" data-mini=\"true\" data-inline=\"true\"/>Allow anonymous incoming connections<\/label><\/td>\n        <td><\/td>\n        <td style='text-align:right;'><button data-mini='true' data-inline='true' id='createinvitebutton'>create invite<\/button><\/td>\n      <\/tr>\n    <\/table>\n    <div class='pb-deviceinfo'>\n      Local Peer ID: <span id='localpeerid'><\/span><br>\n      Local Port: <span id='localpeerport'><\/span><br>\n    <\/div>\n    <div class='pb-peerlist'><\/div>\n    <a id='newconnectionbutton' data-role=\"button\" data-theme=\"b\">add connection...<\/a>\n  <\/div>\n  <div class='pb-lan pb-tab hideme' style='display:none;'>\n    <br>\n    <div id='botlist'><\/div>\n    <a id='rescandiscoverybutton' data-role=\"button\" data-theme=\"b\">scan again...<\/a>\n  <\/div>\n  <div class='pb-accesscodes pb-tab hideme' style='display:none;'>\n    <br>\n    <div id='accesscodelist'><\/div>\n    <a id='addaccesscodebutton' data-role=\"button\" data-theme=\"b\">add code...<\/a>\n  <\/div>\n<\/div>\n<div class='addinvite ui-body-b ui-body hideme' style='display:none;'>\n  <h2 style='position:absolute;top:-10px;width:100%;text-align:center;'>Create Invite<\/h2>\n  <div style='position:absolute;top:4px;right:3px;'><a class='closeinvitedialog' data-role='none' data-ajax='false'><img src='../botmanager/img/close.png' style='width:50px;height:50px;'><\/a><\/div>\n  <div class='addinvitewrap'>\n    <div id='inviteform' class='invitepanel'>\n        <table border='0' cellpadding='0' cellspacing='0'>\n            <tr>\n                <td><select id='grouplist3' data-mini='true'><\/select><\/td>\n                <td><a id='addgrouptoinvite' data-role='button' data-inline='true' data-mini='true'>add group<\/a><\/td>\n            <\/tr>\n        <\/table>\n        <div data-role=\"fieldcontain\">\n            <label for='invitegroups'>Groups:<\/label>\n            <input type='text' id='invitegroups' >\n        <\/div>\n        <a data-role='button' data-theme='a' id='createtheinvite'>create<\/a>\n    <\/div>\n    <div id='inviteresult' class='invitepanel hideme'>\n       <h3>New invite created...<\/h3>\n       <i>Copy the following link address and send it to the person you've invited:<\/i>\n       <input type='text' id='newinvitelink'>\n       <input type='button' value='close' id=\"closeinvitedialog\" class=\"closeinvitedialog\">\n    <\/div>\n  <\/div>\n<\/div>\n<div class='addcode ui-body-b ui-body hideme' style='display:none;'>\n  <h2 style='position:absolute;top:-10px;width:100%;text-align:center;'>Add Access Code<\/h2>\n  <div style='position:absolute;top:4px;right:3px;'><a id='adcodebackbutton' data-role='none' data-ajax='false'><img src='../botmanager/img/close.png' style='width:50px;height:50px;'><\/a><\/div>\n  <div class='addconwrap'>\n    <div data-role=\"fieldcontain\">\n        <label for='newaccesscode'>Access Code:<\/label>\n        <input type='text' id='newaccesscode' >\n    <\/div>\n    <div data-role=\"fieldcontain\">\n        <fieldset data-role=\"controlgroup\">\n            <input type=\"checkbox\" name=\"deleteonuse\" id=\"deleteonuse\" checked/>\n            <label for=\"deleteonuse\">Single use only<\/label>\n        <\/fieldset>\n    <\/div>\n    <table border='0' cellpadding='0' cellspacing='0'>\n        <tr>\n            <td><select id='grouplist2' data-mini='true'><\/select><\/td>\n            <td><a id='addgrouptoaccesscode' data-role='button' data-inline='true' data-mini='true'>add group<\/a><\/td>\n        <\/tr>\n    <\/table>\n    <div data-role=\"fieldcontain\">\n        <label for='accesscodegroups'>Groups:<\/label>\n        <input type='text' id='accesscodegroups' >\n    <\/div>\n    <a data-role='button' data-theme='a' id='addtheaccesscode'>add<\/a>\n  <\/div>\n<\/div>\n<div class='addcon ui-body-b ui-body hideme' style='display:none;'>\n  <h2 style='position:absolute;top:-10px;width:100%;text-align:center;'>Add Connection<\/h2>\n  <div style='position:absolute;top:4px;right:3px;'><a id='adconbackbutton' data-role='none' data-ajax='false'><img src='../botmanager/img/close.png' style='width:50px;height:50px;'><\/a><\/div>\n  <div class='addconwrap'>\n    <label>\n      Universal ID\n      <input type='text' id='newcontactid' placeholder='The unique universal identifier of the device'>\n    <\/label>\n    <label>\n      Groups&nbsp;\n      <span id='addgroupbutton'><\/span>\n      <select id='grouplist' class='grouplist' data-mini='true' data-inline='true'><\/select>\n      <input type='text' data-inline='true' id='newcontactgroup' value='anonymous'>\n    <\/label>\n    <label>\n      Access Code\n      <input type='text' id='newcontactcode' placeholder='Enter the access code (if they gave you one)'>\n    <\/label>\n    <label>\n      IP Address\n      <input type='text' id='newcontactip' placeholder='Their internet address (if you have it)'>\n    <\/label>\n    <label>\n      Port\n      <input type='text' id='newcontactport' placeholder='Their port number (if you have it)'>\n    <\/label>\n    <br>\n    <div id='newconactmsg'><\/div>\n    <input type='button' id='addcontactbutton' value='ADD' data-theme='a'>\n  <\/div>\n<\/div>\n\n","db":"peerbot","desc":""},"id":"yoymiy162b5b3535dx6e8","sessionid":"jhtpuq15d03ce0a74q0","time":1523466889066,"username":"mraiser"}