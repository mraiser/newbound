{"data":{"css":"","data":[],"name":"jsonloader","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar mname = me.modelid = ME.id;\n\nvar set = this.models = [];\n$(ME).data('models', set);\n\nvar helpset = [];\nvar scaleVal = 3;\n\nvar datGUI = me.datgui = $(ME).data('datgui');\nvar scene = me.scene = $(ME).data('scene');\nvar db = me.db = $(ME).data('db');\nvar animations = me.animations = [];\n\nvar files = $(ME).data('assets');\nif (files) files = files.list;\n\nvar rig = me.rig = new function(){\n  this.speed  = 0.25;\n\n  var pos = $(ME).data('pos');\n  var rot = $(ME).data('rot');\n  var scale = $(ME).data('scale');\n  \n  this.pos_x = pos ? pos.x : 0;\n  this.pos_y = pos ? pos.y : 0;\n  this.pos_z = pos ? pos.z : 0;\n\n  this.rot_x = rot ? rot.x : 0;\n  this.rot_y = rot ? rot.y : 0;\n  this.rot_z = rot ? rot.z : 0;\n\n  this.scale_x = scale ? scale.x : 1;\n  this.scale_y = scale ? scale.y : 1;\n  this.scale_z = scale ? scale.z : 1;\n};\n\nme.onload = function(cb){\n  me.onloadcb = cb;\n  me.checkIfDone();\n};\n\nme.checkIfDone = function(){\n  if (me.onloadcb && files.length == me.models.length) {\n    me.onloadcb();\n  }\n};\n\nme.ready = function(){\n  if (datGUI) {\n    var cfolder = me.cfolder = me.cfolder ? me.cfolder : datGUI ? datGUI.addFolder(mname) : null;\n    $(ME).data('cfolder', cfolder);  \n\n    cfolder.add(rig, 'pos_x',-10, 10);\n    cfolder.add(rig, 'pos_y',-10, 10);\n    cfolder.add(rig, 'pos_z',-10, 10);\n    cfolder.add(rig, 'rot_x',-3.14, 3.14);\n    cfolder.add(rig, 'rot_y',-3.14, 3.14);\n    cfolder.add(rig, 'rot_z',-3.14, 3.14);\n    cfolder.add(rig, 'scale_x',0, 10);\n    cfolder.add(rig, 'scale_y',0, 10);\n    cfolder.add(rig, 'scale_z',0, 10);\n  }\n\n  loader = new THREE.JSONLoader();\n  \n  if (scene.naughty || $(ME).data('naughty')) {\n    var f = [];\n    var n;\n    for (var i in files) {\n      if ((n = files[i].indexOf('-min.json')) != -1) f.push(files[i].substring(0,n)+'.json');\n      else if (files[i].indexOf('suit') == -1 && files[i].indexOf('shoes') == -1) f.push(files[i]);\n    }\n    files = f;\n  }\n      \n  for (var i in files) loader.load('../botmanager/asset/'+db+'/'+files[i], addModel);\n};\n\nfunction addModel( geometry,  materials ){\n  var set = me.models;\n  var i = set.length;\n\n  materials[0].skinning = true;\n\n  var cs = scaleVal;\n  \n  set[i]= new THREE.SkinnedMesh( geometry, new THREE.MeshFaceMaterial(materials) );\n  set[i].castShadow = true;\n  set[i].receiveShadow = true;\n  \n//  rig.pos_y = -cs/1.2;\n  \n  scene.add(set[i]);\n  helpset[i] = new THREE.SkeletonHelper(set[i]);\n  \n  if (datGUI){\n    var cfolder = me.cfolder;\n    for (var j in set[i].skeleton.bones){\n      var child = set[i].skeleton.bones[j];\n      if (typeof rig[child.name+'_x'] == 'undefined'){\n        var n = child.name;\n\n        rig[n+'_x'] = 0.0;\n        rig[n+'_y'] = 0.0;\n        rig[n+'_z'] = 0.0;\n        \n        cfolder.add(rig, n+'_x',-3.14, 3.14);\n        cfolder.add(rig, n+'_y',-3.14, 3.14);\n        cfolder.add(rig, n+'_z',-3.14, 3.14);\n      }\n    }\n  }\n  me.checkIfDone();\n}\n\nfunction render() { \n  var now = new Date().getTime();\n  for (var i in animations) animations[i](me, now);\n\n  for (var i in set){\n    var child = set[i];\n    child.position.set(rig.pos_x,rig.pos_y,rig.pos_z);\n    child.rotation.set(rig.rot_x,rig.rot_y,rig.rot_z);\n    child.scale.set(rig.scale_x,rig.scale_y,rig.scale_z);\n\n    for (var j in child.skeleton.bones) {\n      var b = child.skeleton.bones[j];\n      b.rotation.x = rig[b.name+'_x'];\n      b.rotation.y = rig[b.name+'_y'];\n      b.rotation.z = rig[b.name+'_z'];\n    }\n    \n//    if (me.postrender) me.postrender();\n  }\n}\nme.render = render;\n","groups":"anonymous","ctl":"omyrgq1625828c684h15a","html":"","db":"peerbot","desc":""},"readers":["anonymous"],"id":"omyrgq1625828c684h15a","sessionid":"jvgvwg16b7a4d277bt3","time":1574954038002,"addr":"/0:0:0:0:0:0:0:1:49158","username":"admin"}