{"data":{"css":".aligncenter{\n  vertical-align:top;\n}\n\n.rp-status{\n  float:right;\n}\n\n.rp-info {\n  display:inline-block;\n  vertical-align:top;\n}\n\n.rp-uuid {\n  font-size:x-small;\n  margin-top:-10px;\n}\n\n.width100{\n  width:100%;\n}\n\n.dark .mdl-tabs__tab{\n  color:white;\n  width:50%;\n}\n\n.dark .mdl-tabs.is-upgraded .mdl-tabs__tab.is-active{\n  color:#83bc00;\n}\n\n.upsome{\n  margin-top:-20px;\n}\n\n.padsome{\n  padding:20px;\n}\n\n.clickmore{\n  color:#83bc00;\n  cursor:pointer;\n}\n\n.moreip{\n  padding:10px;\n  display:none;\n}\n\n.iconmode{\n  width:140px;\n  height:140px;\n  display:inline-block;\n  vertical-align:top;\n}\n\n.availablecontrols{\n  display:none;\n  color:black;\n  height:300px;\n}\n\n.aclist{\n  height: 200px;\n  overflow-y: auto;\n  width: 95%;\n}\n\n.actable{\n  width:100%;\n}\n\n.controlsettings .mdl-button{\n  color:white;\n}\n\n.controlsettings{\n  display:none;\n}\n\n.popmeup {\n  width:80%;\n  height:80%;\n  display:none;\n  z-index:100000;\n}\n\n.popupcontents{\n  height:100%;\n}\n\n.deletepeerbutton{\n  display:none;\n  float:right;\n  margin-top:30px;\n}\n","data":[],"name":"headsup","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.data = {\"list\":[]};\n\nme.ready = me.refresh = function(){\n  $(ME).find('.rp-name').text(ME.DATA.name);\n  $(ME).find('.rp-uuid').text(ME.DATA.id);\n  \n  $(ME).find('.adminonly').css('display', 'none');\n  $(ME).find('.hudapps').css('display', 'block');\n  $(ME).find('.controlsettings').css('display', 'none').css('opacity', '1');\n\n  var addr = '';\n  for (var i in ME.DATA.addresses) {\n    var a = ME.DATA.addresses[i];\n    var j = a.lastIndexOf(':');\n    a = a.substring(0,j);\n    addr += '<span class=\"mdl-chip\"><span class=\"mdl-chip__text\">'+a+'<\/span><\/span> ';\n  }\n  var ip = 'Port: '+ME.DATA.port+'<br>IP Address: '+ME.DATA.addr+'&nbsp;<i class=\"material-icons aligncenter clickmore\">more_horiz<\/i><div class=\"moreip\">'+addr+'<\/div>';\n  $(ME).find('.rp-ipaddr').html(ip).find('.clickmore').click(function(){\n    if ($(this).text() == 'more_horiz'){\n      $(this).text('close');\n      $(ME).find('.moreip').css('display', 'block');\n    }\n    else{\n      $(this).text('more_horiz');\n      $(ME).find('.moreip').css('display', 'none');\n    }\n  });;\n  \n  $(ME).find('.hudapps').html('<i>Scanning...<\/i>');\n  $(ME).find('.deletepeerbutton').css('display', ME.DATA.connected ? 'none' : 'block');\n  \n  componentHandler.upgradeAllRegistered();\n  \n  installControl($(ME).find('.localbrokers5')[0], 'peerbot', 'brokers', function(api){}, {});\n  \n  installControl($(ME).find('.rp-status')[0], 'peerbot', 'connectionstatus', function(api){}, ME.DATA);\n  if (ME.DATA.connected){\n    installControl($(ME).find('.rp-update')[0], 'metabot', 'updatebutton', function(api){}, {});\n    json('../peerbot/remote/'+ME.DATA.id+'/botmanager/read', 'db=runtime&id=installedcontrols', function(result){\n      if (result.status != 'ok'){\n        $(ME).find('.hudapps').html(result.msg);\n      }\n      else {\n        var data = me.data = result.data;\n        var wrap = $(ME).find('.hudapps');\n        wrap.empty();\n\n        var settings = '<ul class=\"mdl-list\">';\n        var count = 0;\n        for (var i in data.list){\n          var ctl = data.list[i];\n          var inline = ctl.position && ctl.position != 'inline' ? false : true;\n\n          if (inline) {\n            addHUDCTL(ctl);\n            count++\n\n            settings += '<li class=\"mdl-list__item\"><span class=\"mdl-list__item-primary-content\">'\n              + '<i class=\"material-icons mdl-list__item-avatar\">settings<\/i>'\n              + '<button class=\"editcontrolbutton mdl-button mdl-js-button mdl-js-ripple-effect\" data-index=\"'\n              + i\n              +'\" data-ctltype=\"'\n              + ctl.type\n              + '\">'\n              + ctl.title\n              + '<\/button><\/span>'\n              + '<a class=\"deletecontrolbutton mdl-list__item-secondary-action\" data-index=\"'\n              + i\n              +'\" href=\"#\"><i class=\"material-icons\">delete<\/i><\/a>'\n              + '<\/span><\/li>';\n          }\n        }\n        if (count == 0) wrap.html(\"\");\n        else {\n            $('a.mdl-tabs__tab').removeClass('is-active');\n            $('#dashboardtab').addClass('is-active');\n            $('.mdl-tabs__panel').removeClass('is-active');\n            $('#tab2-panel').addClass('is-active');        \n        }\n        settings += '<\/ul><button class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect editctldonebutton\">Done<\/button>';\n        $('.controlsettings').html(settings).find('.editcontrolbutton').click(function(){\n          var sa = $(this).data('ctltype').split(':');\n          var el = $(ME).find('.popmeup').css('display', 'block')[0];\n          var i = $(this).data('index');\n          var data = {\n            \"ctldb\": sa[0],\n            \"ctlid\": sa[1],\n            \"data\": me.data.list[i],\n            \"list\": me.data.list,\n            \"index\": i,\n            \"cb\": function(val){\n              el.api.closeAndReset();\n              json(CURRENTDEVICEPREFIX+'botmanager/write', 'db=runtime&id=installedcontrols&data='+encodeURIComponent(JSON.stringify(me.data)), function(result){});\n            }\n          };\n\n          installControl(el, 'metabot', 'popupdialog', function(){\n            setTimeout(function(){\n              installControl($(el).find('.popupcontents')[0], 'peerbot', 'controlsettings', function(){}, data);\n            }, 1000);\n          }, data);\n        });\n\n        $('.controlsettings').find('.deletecontrolbutton').click(function(){\n          $(ME).find('.controlsettings').animate({'opacity':'0'}, 500);\n          var i = $(this).data('index');\n          me.data.list.splice(i,1);\n          json(CURRENTDEVICEPREFIX+'botmanager/write', 'db=runtime&id=installedcontrols&data='+encodeURIComponent(JSON.stringify(me.data)), function(result){\n            me.refresh();\n          });\n        });\n        \n        $('.controlsettings').find('.editctldonebutton').click(me.refresh);\n        \n        $('.close-settings').css('display', 'none');\n      }\n      json(CURRENTDEVICEPREFIX+'botmanager/read', 'db=runtime&id=availablecontrols', function(result){\n        var newhtml = '';\n        for (var i in result.data.list){\n          var rdli = result.data.list[i];\n          newhtml += '<tr onclick=\"addactlrow('\n            + i\n            + ');\"><td class=\"mdl-data-table__cell--non-numeric\">'\n            + rdli.title\n            + '<\/td><td class=\"mdl-data-table__cell--non-numeric\">'\n            + rdli.type\n            + '<\/td><td>'\n            + JSON.stringify(rdli.groups)\n            +'<\/td><\/tr>';\n        }\n        $(ME).find('.aclisttablebody').html(newhtml)[0].data = result.data.list;\n        componentHandler.upgradeAllRegistered();\n      });\n    });\n    json('../peerbot/remote/'+ME.DATA.id+'/securitybot/currentuser', null, function(result){\n      $(ME).find('.rp-key').text(result.groups);\n      if (result.groups.indexOf('admin') != -1) $(ME).find('.adminonly').css('display', 'block');\n    });\n  }\n  else{\n    $(ME).find('.rp-key').text('--');\n  }\n  \n  json('../securitybot/listusers', null, function(result){\n    var u = getByProperty(result.data, 'username', ME.DATA.id);\n    var g = u.groups[0] ? u.groups : 'anonymous';\n    $(ME).find('.rp-lock').text(g);\n  });\n};\n\nfunction addHUDCTL(ctl){\n  var wrap = $(ME).find('.hudapps');\n  var id = ctl.type;\n  var j = id.indexOf(':');\n  var db = j == -1 ? 'newboundpowerstrip' : id.substring(0,j);\n  id = j == -1 ? id : id.substring(j+1);\n  j = db.indexOf(':');\n  var d = j != -1 && db.substring(j+1,1) == '{' ? JSON.parse(db.substring(j+1)) : ctl;\n  db = j == -1 ? db : db.substring(0,j);\n  var claz = !ctl.big ? 'iconmode' : 'big';\n\n  var el = $('<div class=\"inline '+claz+'\"><\/div>')[0];\n  wrap.append(el);\n  installControl(el, db, id, function(api){}, d);\n}\n\n$(ME).find('.refreshhud').click(me.refresh);\n\n$(ME).find('.addhudctl').click(function(){\n  var el = $(ME).find('.availablecontrols');\n  installControl(el[0], 'metabot', 'popupdialog', function(){\n    el.css('display', 'block');\n  }, {});\n});\n\naddactlrow = function(row){\n  var data = $(ME).find('.aclisttablebody')[0].data[row];\n  data = Object.assign({}, data);\n  data.position = 'inline';\n  data.id = guid();\n  me.data.list.push(data);\n  json(CURRENTDEVICEPREFIX+'botmanager/write', 'db=runtime&id=installedcontrols&data='+encodeURIComponent(JSON.stringify(me.data)), function(result){\n    addHUDCTL(data);\n  });\n  $(ME).find('.availablecontrols')[0].api.closeAndReset();\n};\n\n$(ME).find('.hudctlsettings').click(function(){\n  $(ME).find('.hudapps').css('display', 'none');\n  $(ME).find('.controlsettings').css('display', 'block');\n});\n\n$(ME).find('.hudrestart').click(function(){\n  json('../peerbot/remote/'+ME.DATA.id+'/botmanager/restart', null, function(result){\n    var snackbarContainer = document.querySelector('#restart-snackbar2');\n    var data = {\n      message: result.msg\n    };\n    snackbarContainer.MaterialSnackbar.showSnackbar(data);\n  });\n});\n\n$(ME).find('.deletepeerbutton').click(function(){\n  me.network.delete(ME.DATA);\n});\n\n\n","groups":"","ctl":"pxogqq168d35e160bv1646","html":"<h4>\n  <div class='rp-status'><\/div>\n  <button class=\"mdl-button mdl-js-button mdl-button--icon aligncenter\" id=\"rp-more\">\n    <i class=\"material-icons\">more_vert<\/i>\n  <\/button>\n  <ul class=\"mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect\" for=\"rp-more\">\n    <li class=\"mdl-menu__item mdl-menu__item--full-bleed-divider refreshhud\">Refresh<\/li>\n    <li class=\"mdl-menu__item addhudctl adminonly\">Add Control<\/li>\n    <li class=\"mdl-menu__item hudctlsettings mdl-menu__item--full-bleed-divider adminonly\">Control Settings<\/li>\n    <li class=\"mdl-menu__item hudrestart adminonly\">Restart Services<\/li>\n  <\/ul>\n  <div class='rp-info'>\n    <div class='rp-name'><\/div>\n    <div class='rp-uuid'><\/div>\n  <\/div>\n<\/h4>\n\n<div class = \"mdl-layout__content width100 dark upsome\">    \n  <div class = \"mdl-tabs mdl-js-tabs\">\n     <div class = \"mdl-tabs__tab-bar\">\n        <a href = \"#tab1-panel\" class = \"mdl-tabs__tab is-active\">Info<\/a>\n        <a href = \"#tab2-panel\" class = \"mdl-tabs__tab\" id=\"dashboardtab\">Dashboard<\/a>\n     <\/div>\n\n     <div class = \"mdl-tabs__panel is-active padsome\" id = \"tab1-panel\">\n       <div class='rp-ipaddr'><\/div>\n       <div class='localbrokers5'><\/div>\n       <i class=\"material-icons aligncenter\">vpn_key<\/i>&nbsp;<span class='rp-key'><\/span>\n       <i class=\"material-icons aligncenter\">lock<\/i>&nbsp;<span class='rp-lock'><\/span>\n       <br><br>\n       <div class='rp-update'><\/div>\n       <button class=\"deletepeerbutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\">delete<\/button>\n     <\/div>\n\n     <div class = \"mdl-tabs__panel padsome\" id = \"tab2-panel\">\n       <div class='hudapps'><\/div>\n       <div class='controlsettings'><\/div>\n     <\/div>\n  <\/div>\n<\/div>\n\n\n\n<div class='availablecontrols'>\n\n\n  <div class=\"mdl-card__title\">\n    <h2 class=\"mdl-card__title-text\">Install Control<\/h2>\n  <\/div>\n  <div class=\"aclist mdl-card__supporting-text\">\n    <table class=\"actable mdl-data-table mdl-js-data-table mdl-shadow--2dp\">\n      <thead>\n        <tr>\n          <th class=\"mdl-data-table__cell--non-numeric\">Name<\/th>\n          <th class=\"mdl-data-table__cell--non-numeric\">lib:id<\/th>\n          <th class=\"mdl-data-table__cell--non-numeric\">security<\/th>\n        <\/tr>\n      <\/thead>\n      <tbody class='aclisttablebody'>\n      <\/tbody>\n    <\/table>      \n  <\/div>\n  <div class=\"mdl-card__menu\">\n    <button class=\"closeaddctl mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\" onclick=\"$(this).closest('.availablecontrols')[0].api.closeAndReset();\">\n      <i class=\"material-icons\">close<\/i>\n    <\/button>\n  <\/div>    \n\n<\/div>\n\n<div class='popmeup'><div class='popupcontents'><\/div><\/div>\n<div id=\"restart-snackbar2\" class=\"mdl-js-snackbar mdl-snackbar\">\n  <div class=\"mdl-snackbar__text\"><\/div>\n  <button class=\"mdl-snackbar__action\" type=\"button\"><\/button>\n<\/div>\n","three":{"controls":[]},"db":"peerbot","desc":""},"id":"pxogqq168d35e160bv1646","sessionid":"jhtpuq15d03ce0a74q0","time":1552571924554,"addr":"/0:0:0:0:0:0:0:1:62706","username":"mraiser"}