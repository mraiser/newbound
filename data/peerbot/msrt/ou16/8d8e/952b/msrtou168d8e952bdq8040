{"data":{"css":".matrixviewer{\n  position:relative;\n  top:0px;\n  left:0px;\n  width:100%;\n  height:100%;\n}\n\n.localinfo{\n  position:fixed;\n  top:20px;\n  left:100px;\n  color:white;\n}\n\n.localpeername{\n  font-size:large;\n  cursor:pointer;\n}\n\n.localpeername:hover{\n  color:#83bc00;\n}\n\n.hud{\n  position:fixed;\n  background-color: #000000aa;\n  color: #ffffff;\n  padding:40px;\n  display: none;\n  overflow-y: auto;\n}\n\n.hud1 {\n  top: 0vw;\n  right: 0vw;\n  width: 600px;\n  height: 100vh;\n  max-width:90%;\n}\n\n.closehudbutton{\n  position:fixed;\n  top:0px;\n  right:0px;\n  color:white;\n}\n\n.editcontrolsbutton{\n  position:absolute;\n  left: 2px;\n  top: 35px;\n}\n\n.connectedandadminonly {\n  display:none;\n}\n\n.pb-peer-name{\n  font-size:large;\n}\n\n.pb-peer-alladdr {\n  margin-top:20px;\n}\n\n.connectionindicator {\n    margin-top: 6px;\n    margin-left: 3px;\n    height: 10px;\n    width: 10px;\n    border: thin solid black;\n    border-radius: 10px;\n    display: inline-block;\n}\n\n.pb-peer-strength {\n  float: right;\n  cursor:pointer;\n}\n\n.hudms{\n  font-size:x-small;\n  float:right;\n  text-align:right;\n}\n\n.hudappsx{\n  position:absolute;\n  top:100px;\n  bottom:0px;\n  left:40px;\n  right:0px;\n  overflow:auto;\n}\n\n.app-card{\n  width:100px;\n  height:100px;\n  display:none;\n  vertical-align:top;\n  margin:5px;\n  overflow:hidden;\n  text-align:center;\n  font-size:x-small;\n  position:relative;\n  cursor:pointer;\n}\n\n.mdl-card__actions>.app-card-image__filename{\n  font-size:x-small;\n}\n\n.app-card > .app-card-square > .mdl-card__actions{\n  height:24px;\n  padding:6px;\n}\n\n.app-card > .app-card-square > .mdl-card--expand{\n  height:76px;\n}\n\n.appinfo-meta{\n  color:black;\n}\n\n.deletepeerbutton{\n  display:none;\n  float:right;\n  margin-top:30px;\n}\n\n.iconmode{\n  width:140px;\n  height:140px;\n  display:inline-block;\n  vertical-align:top;\n}\n\n.hudappdetail{\n  margin-bottom:40px;\n}\n\n\n.mdl-button--fab.mdl-button--colored{\n  background-color:#83bc00;\n}\n\n.mdl-button--fab.mdl-button--colored:hover{\n  background-color:#b7ef49;\n}\n\n.mdl-card__title{\n  background-color:#83bc00;\n  color:white;\n}\n\n.mdl-card__menu>.mdl-button--icon{\n  color:white;\n}\n\n.availablecontrols{\n  display:none;\n  color:black;\n  height:300px;\n}\n\n.aclist{\n  height:200px;\n  overflow-y:auto;\n}\n\n.bottombuttons{\n  position: fixed;\n  bottom:20px;\n  left:20px;\n}\n\n.topbuttons{\n  position: fixed;\n  top:20px;\n  left:20px;\n}\n\n.mdl-button--raised.mdl-button--colored{\n  color:white;\n}\n\n.addpeerpopup, .accesscodespopup, .lanpopup{\n  max-width:90%;\n  max-height:90%;\n  display:none;\n}\n\n.addpeerpopup{\n  height:400px;\n  width:600px;\n}\n\n.botlist{\n  height:300px;\n  overflow-y:scroll;\n  position:relative;\n}\n\n.accesscodespopup, .lanpopup{\n  height:400px;\n  width:600px;\n}\n\n#newconactmsgx{\n  position:absolute;\n  top:-20px;\n}\n\n.codelist{\n  height:120px;\n  overflow-y:scroll;\n}\n\n.addaccesscodebutton{\n  float:right;\n  margin-top:-5px;\n}\n\n.singleuse{\n  width:120px;\n}\n\ndiv .mdl-chip__text{\n  padding-top:7px;\n  font-size:x-small;\n  line-height:10px;\n}\n\n#ul_botlist{\n  width:100%;\n  font-size:small;\n  list-style-type:none;\n  margin-bottom:5px;\n  text-align:left;\n}\n\n.li_botlist{\n  text-decoration:none;\n}\n\n.flex{\n  display:flex;\n  flex-wrap:wrap;\n  justify-content:center;\n  position:relative;\n}\n\n.mdl-layout.is-upgraded .mdl-layout__tab.is-active {\n  color:white;\n}\n\n.mdl-layout.is-upgraded .mdl-layout__tab.is-active::after{\n  background-color:white;\n}\n\n.smallcols>.mdl-textfield, .invitegroupselect{\n  width:200px;\n}\n\n.invitegroupselect{\n  margin-bottom:-10px;\n  margin-left:40px;\n  width:510px;\n}\n\n.invitegroupselect>.groupselect>.injectselect>.mdl-selectfield{\n  width:510px;\n}\n\n.inline{\n  background-color:#fff8;\n}\n\n.controlsettings{\n  background-color:white;\n  display:none;\n}\n\n.close-settings{\n  display:none;\n  position:absolute;\n  top:100px;\n  left:2px;\n}\n\n.popmeup {\n  width:80%;\n  height:80%;\n  display:none;\n  z-index:100000;\n}\n\n.popupcontents{\n  height:100%;\n}","data":[],"name":"peerbot_recent","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar servertime = 0;\nvar serverdelta = 0;\nvar peers = [];\nvar hold = [];\n\nWSCB = function(data){\n  var p = data.data;\n  if (p.addr) updatePeer(p);  \n};\n\nString.prototype.hashCode = function() {\n  var hash = 0, i, chr;\n  if (this.length === 0) return hash;\n  for (i = 0; i < this.length; i++) {\n    chr   = this.charCodeAt(i);\n    hash  = ((hash << 5) - hash) + chr;\n    hash |= 0; // Convert to 32bit integer\n  }\n  return hash;\n};\n\nfunction updatePeer(p){\n  if (me.peers){\n    p.millis = new Date().getTime() - serverdelta - p.lastcontact;\n    var el = $('#'+p.id)[0];\n    if (el) $(el).data('peer', p);\n    else {\n      addPeer(me.viewer, p, p.id.hashCode(), 100000);\n    }\n\n    var curhud = $(ME).find('.pb-peer-uuid').text();\n    if (p.id == curhud) {\n      setStrength(p);\n    }\n  }\n  else hold.push(p);\n}\n\ndocument.body.ALLPEERIDS = '';\n\nme.ready = function(){\n  componentHandler.upgradeAllRegistered();\n  $('#matrixviewer').data('threepath', '../botmanager/asset/threejs/three.js-master/');\n  $('#matrixviewer').data('datguipath', '../botmanager/asset/threejs/dat.gui-master/');\n  $('#matrixviewer').data('orbitcontrols', true);\n  \n  json('../peerbot/getpeerinfo', null, function(result){\n    $(ME).find('.localpeername').text(result.name);\n    $(ME).find('.localpeerid').text(result.id);\n    $(ME).find('.localpeerport').text(\"Port: \"+result.port);\n    \n    $('.localpeername').click(function(){\n      var data = {\n        \"title\": \"Rename this device\",\n        \"text\": \"Device Name\",\n        \"value\": result.name,\n        \"cb\": function(val){\n          var params = 'machineid='+encodeURIComponent(val);\n          json('../botmanager/getsettings', params, function(result){\n            if (result.status != 'ok') alert(result.msg);\n            else {\n              $(ME).find('.localpeername').text(val);\n            }\n          });\n        }\n      };\n      var el = $(ME).find('.popmeup');\n      el.css('display', 'block');\n      installControl(el[0], 'metabot', 'promptdialog', function(api){}, data);\n    });\n    \n    installControl($(ME).find('.localbrokers2')[0], 'peerbot', 'brokers', function(api){}, result);\n  });\n\n  installControl('#matrixviewer', 'peerbot', 'viewer', function(api){\n    me.viewer = api;\n    api.waitReady(function(){\n\n      var loader = new THREE.FontLoader();\n\n      loader.load( 'helvetiker_regular.typeface.json', function ( ff ) {\n        font = ff;\n\n        json('../peerbot/connections', null, function(result){\n          me.peers = document.peers = result.data;\n          servertime = result.currenttimemillis;\n          serverdelta = new Date().getTime() - result.currenttimemillis;\n          \n          while (hold.length>0) updatePeer(hold.pop());\n          for (var i in result.data) updatePeer(result.data[i]);\n\n          updatePeriodically();\n        });\n      });\n      \n      \n      var camera = me.camera = api.scene.camera;\n      me.scene = api.scene;\n\n      function onDocumentMouseDown( event ) {\n//        if ($(ME).find('.hud1').css('display') == 'block') return;\n        \n        event.preventDefault();\n        var vector = new THREE.Vector3(\n            ( event.clientX / window.innerWidth ) * 2 - 1,\n          - ( event.clientY / window.innerHeight ) * 2 + 1,\n            0.5\n        );\n        vector.unproject(camera);\n\n        var ray = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );\n        \n        var peers = []\n        for (var i in api.models) peers.push(api.models[i].models[0]);\n        var intersects = ray.intersectObjects( peers );\n\n        if ( intersects.length > 0 ) {\n          var i = peers.indexOf(intersects[0].object);\n          var model = api.models[i];\n          if (!api.focus){\n            me.whereiwas = {\n              pos: {\n                x: camera.position.x,\n                y: camera.position.y,\n                z: camera.position.z\n              }, rot: {\n                x: camera.rotation.x,\n                y: camera.rotation.y,\n                z: camera.rotation.z\n              }, scale: {\n                x: camera.scale.x,\n                y: camera.scale.y,\n                z: camera.scale.z\n              }                \n            };\n          }\n          api.focus = api.focus == model ? null : model;\n          if (api.focus == null) closeHUD();\n          else{\n            showTheHUD(model.UUID);\n          }\n        }\n\n      }\n      $('#matrixviewer').click(onDocumentMouseDown);\n    });\n  });\n};\n\nfunction showTheHUD(uuid){\n  $('.hudapps').css('display', 'block');\n  $('.controlsettings').css('display', 'none');\n  $('.close-settings').css('display', 'none');\n  $('.updateremote').empty();\n\n  var data = $('#'+uuid).data('peer');\n  $(ME).find('.hud').css('display', 'block');\n  $(ME).find('.pb-peer-name').text(data.name);\n  $(ME).find('.pb-peer-uuid').text(data.id);\n//            $(ME).find('.pb-peer-port').text(data.port);\n//            $(ME).find('.pb-peer-keepalive').prop('checked', data.keepalive);\n\n  setStrength(data);\n  $(ME).find('.deletepeerbutton').css('display', data.connected ? 'none' : 'block');\n\n  var addr = '<br><br>IP Addresses:<br>';\n  for (var n in data.addresses) addr += '<br>'+(data.connected && data.addresses[n] == data.addr+\":\"+data.port ? ('<font color=\"#84bd00\">'+data.addresses[n]+'<\/font>') : data.addresses[n]);\n  if (data.relays.length>0){\n    addr += '<br><br>Relays:<br>';\n    for (var n in data.relays) {\n      var id = data.relays[n];\n      if ($('#'+id).data('peer')){\n        var name = $('#'+id).data('peer').name;\n        addr += '<br>'+name+' ('+id+')';\n      }\n    }\n  }\n  $(ME).find('.pb-peer-alladdr').html(addr);\n\n  if (data.connected){\n    $(ME).find('.hudapps').html(\"<i>scanning...<\/i>\");\n    $(ME).find('.addremotecontrolbutton').css('display', 'inline-block');\n\n    CURRENTDEVICEID = data.id;\n    CURRENTDEVICEPREFIX = '../peerbot/remote/'+data.id+'/';\n\n    installControl($(ME).find('.updateremote')[0], 'metabot', 'updatebutton', function(api){}, {});\n\n    $(ME).find('.connectedandadminonly').css('display', 'block');\n\n    me.data = { list:[] };\n    json(CURRENTDEVICEPREFIX+'botmanager/read', 'db=runtime&id=installedcontrols', function(result){\n//              json(prefix+'botmanager/read', 'db=knowesys&id=DASHBOARD', function(result){\n      if (result.status != 'ok'){\n        $(ME).find('.hudapps').html(result.msg);\n      }\n      else {\n        var data = me.data = result.data;\n        var wrap = $(ME).find('.hudapps');\n        wrap.empty();\n\n        var settings = '<ul class=\"mdl-list\">';\n        var count = 0;\n        for (var i in data.list){\n          var ctl = data.list[i];\n          var inline = ctl.position && ctl.position != 'inline' ? false : true;\n\n          if (inline) {\n            addHUDCTL(ctl);\n            count++\n\n            settings += '<li class=\"mdl-list__item\"><span class=\"mdl-list__item-primary-content\">'\n              + '<i class=\"material-icons mdl-list__item-avatar\">settings<\/i>'\n              + '<button class=\"editcontrolbutton mdl-button mdl-js-button mdl-js-ripple-effect\" data-index=\"'\n              + i\n              +'\" data-ctltype=\"'\n              + ctl.type\n              + '\">'\n              + ctl.title\n              + '<\/button><\/span>'\n              + '<a class=\"deletecontrolbutton mdl-list__item-secondary-action\" data-index=\"'\n              + i\n              +'\" href=\"#\"><i class=\"material-icons\">delete<\/i><\/a>'\n              + '<\/span><\/li>';\n          }\n        }\n        if (count == 0) wrap.html(\"\");\n        settings += '<\/ul>';\n        $('.controlsettings').html(settings).find('.editcontrolbutton').click(function(){\n          var sa = $(this).data('ctltype').split(':');\n          var el = $(ME).find('.popmeup').css('display', 'block')[0];\n          var i = $(this).data('index');\n          var data = {\n            \"ctldb\": sa[0],\n            \"ctlid\": sa[1],\n            \"data\": me.data.list[i],\n            \"cb\": function(val){\n              el.api.close();\n              json(CURRENTDEVICEPREFIX+'botmanager/write', 'db=runtime&id=installedcontrols&data='+encodeURIComponent(JSON.stringify(me.data)), function(result){});\n            }\n          };\n\n          installControl(el, 'metabot', 'popupdialog', function(){\n            setTimeout(function(){\n              installControl($(el).find('.popupcontents')[0], 'peerbot', 'controlsettings', function(){}, data);\n            }, 1000);\n          }, data);\n        });\n\n        $('.controlsettings').find('.deletecontrolbutton').click(function(){\n          var i = $(this).data('index');\n          me.data.list.splice(i,1);\n          json(CURRENTDEVICEPREFIX+'botmanager/write', 'db=runtime&id=installedcontrols&data='+encodeURIComponent(JSON.stringify(me.data)), function(result){\n            showTheHUD(uuid);\n          });\n        });\n\n        $('.close-settings').css('display', 'none');\n      }\n\n      json(CURRENTDEVICEPREFIX+'botmanager/read', 'db=runtime&id=availablecontrols', function(result){\n        var newhtml = '';\n        for (var i in result.data.list){\n          var rdli = result.data.list[i];\n          newhtml += '<tr onclick=\"addactlrow('\n            + i\n            + ');\"><td class=\"mdl-data-table__cell--non-numeric\">'\n            + rdli.title\n            + '<\/td><td class=\"mdl-data-table__cell--non-numeric\">'\n            + rdli.type\n            + '<\/td><td>'\n            + JSON.stringify(rdli.groups)\n            +'<\/td><\/tr>';\n        }\n        $(ME).find('.aclisttablebody').html(newhtml)[0].data = result.data.list;\n        componentHandler.upgradeAllRegistered();\n      });\n\n    });\n  }\n  else {\n    $(ME).find('.hudapps').html(\"<i>Not connected.<\/i>\");\n    $(ME).find('.connectedandadminonly').css('display', 'none');\n//              $(ME).find('.addremotecontrolbutton').css('display', 'none');\n  }\n}\n\nfunction addHUDCTL(ctl){\n  var wrap = $(ME).find('.hudapps');\n  var id = ctl.type;\n  var j = id.indexOf(':');\n  var db = j == -1 ? 'newboundpowerstrip' : id.substring(0,j);\n  id = j == -1 ? id : id.substring(j+1);\n  j = db.indexOf(':');\n  var d = j != -1 && db.substring(j+1,1) == '{' ? JSON.parse(db.substring(j+1)) : ctl;\n  db = j == -1 ? db : db.substring(0,j);\n  var claz = !ctl.big ? 'iconmode' : 'big';\n\n  var el = $('<div class=\"inline '+claz+'\"><\/div>')[0];\n  wrap.append(el);\n  installControl(el, db, id, function(api){}, d);\n}\n\naddactlrow = function(row){\n  var data = $(ME).find('.aclisttablebody')[0].data[row];\n  data = Object.assign({}, data);\n  data.position = 'inline';\n  data.id = guid();\n  me.data.list.push(data);\n  json(CURRENTDEVICEPREFIX+'botmanager/write', 'db=runtime&id=installedcontrols&data='+encodeURIComponent(JSON.stringify(me.data)), function(result){\n    addHUDCTL(data);\n  });\n  closeADDCTL();\n};\n\n$(ME).find('.pb-peer-strength').click(function(){\n  var curhud = $(ME).find('.pb-peer-uuid').text();\n  var data = $('#'+curhud).data('peer');\n  json('../peerbot/connect', 'uuid='+curhud, function(result){\n    console.log(result);\n  });\n});\n\nfunction setStrength(data){\n  var b = data.connected;\n  var i = data.strength;\n  var s = makeDot(b, i>0) + makeDot(b, i>1) + makeDot(b, i>2);\n  s += '<br><span class=\"hudms\">'+(data.millis>15000 ? '&infin;' : data.millis+'ms')+'<\/span>';\n  $(ME).find('.pb-peer-strength').html(s);\n}\n\nfunction makeDot(b1, b2){\n  return '<div class=\"connectionindicator\" style=\"background-color:'+(b1 && b2 ? '#84bd00' : b2 ? '#ff0' : '#ccc')+';\"><\/div>';\n}\n\nfunction addPeer(api, p, num, count){\n  var all = document.body.ALLPEERIDS;\n  all = all == '' ? '' : all+' ';\n  all += p.id;\n  document.body.ALLPEERIDS = all;\n//  console.log(all);\n  \n//  p.millis = servertime - p.lastcontact;\n  p.millis = new Date().getTime() - serverdelta - p.lastcontact;\n  var r = 5; //((count*2)/Math.PI)/20;\n  var n = (num/count)*Math.PI*2;\n  var s = 0.25; //10/count;\n  \n  var x = Math.sin(n)*r;\n  var y = ((num % 2) - 0.5)*0.02*Math.random();\n  var z = Math.cos(n)*r;\n  \n  var el = $('<div class=\"peerorb\" />')[0];\n  el.id = p.id;\n  $(el).data('pos', { x: x, y:y, z:z });\n  $(el).data('scale', { x: s, y:s, z:s });\n  $(el).data('peer', p);\n  $(ME).append(el);\n  api.add(el, 'peerbot', 'orb', null);\n};\n\nfunction updatePeriodically(){\n  setTimeout(function(){\n    json('../peerbot/connections', null, function(result){\n      servertime = result.currenttimemillis;\n      var curhud = $(ME).find('.pb-peer-uuid').text();\n      for (var i in result.data) updatePeer(result.data[i]);\n      updatePeriodically();\n    });\n  }, 3000);\n}\n\nshowHudApp = function(appid){\n  var app = { data: getByProperty($(ME).find('.hudapps').data('apps').list, 'id', appid) };\n  installControl($(ME).find('.hudappdetail')[0], 'metabot', 'appcard', function(){}, app);\n};\n\n$('.hudappdetail').click(function(event){\n  event.preventDefault();\n});\n\nfunction closeHUD(){\n  var camera = me.camera;\n  camera.position.x = me.whereiwas.pos.x;\n  camera.position.y = me.whereiwas.pos.y;\n  camera.position.z = me.whereiwas.pos.z;    \n//  camera.lookAt(me.scene.position);\n  camera.rotation.x = me.whereiwas.rot.x;\n  camera.rotation.y = me.whereiwas.rot.y;\n  camera.rotation.z = me.whereiwas.rot.z;    \n  camera.scale.x = me.whereiwas.scale.x;\n  camera.scale.y = me.whereiwas.scale.y;\n  camera.scale.z = me.whereiwas.scale.z;    \n  $(ME).find('.hud').css('display', 'none');\n  me.viewer.focus = null;\n  me.viewer.lastlook.copy(me.scene.position);\n}\n\n$(ME).find('.deletepeerbutton').click(function(){\n  var id = $(ME).find('.pb-peer-uuid').text();\n  json(\"deletepeer\",\"uuid=\"+id, function(result) {});\n\n  var model = $('#'+id)[0].api;\n  \n  model.scene.remove(model.text3d);\n  \n  var rig = model.rig;\n  var size = rig.scale_x;\n  model.animations.push(function(model){\n    \n    if (size > 0.0001){\n      size *= 0.8;\n      rig.scale_x = size;\n      rig.scale_y = size;\n      rig.scale_z = size;\n    }\n    else {\n      model.scene.remove(model.models[0]);\n      closeHUD();\n      var i = model.animations.indexOf(this);\n      model.animations.splice(i,1);\n    }\n  });\n});\n\n$(ME).find('.closehudbutton').click(closeHUD);\n\nfunction listAccessCodes(){\n  json('../peerbot/accesscodes', null, function(result){\n    var newhtml = '';\n    for (var i in result.data){\n      var rdi = result.data[i];\n      var use = rdi.delete == 'true' ? 'single use' : 'reusable';\n      newhtml += '<div class=\"mdl-chip mdl-chip--deletable\"><div class=\"mdl-chip__text\">'+use+': '+rdi.groups+'<br>'+i+'<\/div><button type=\"button\" class=\"codechip mdl-chip__action\" onclick=\"deleteaccesscode(\\''+i+'\\');\"><i class=\"material-icons\">cancel<\/i><\/button><\/div>';\n    }\n    $(ME).find('.codelist').html(newhtml);\n  });\n}\nlistAccessCodes();\n\ndeleteaccesscode = function(id){\n\tjson('../peerbot/deleteaccesscode', 'code='+encodeURIComponent(id), function(result){\n\t\tlistAccessCodes();\n\t});\n};\n\n$(ME).find('.accesscodebutton').click(function(){\n  var el = $(ME).find('.accesscodespopup');\n  installControl(el[0], 'metabot', 'popupdialog', function(){\n    el.css('display', 'block');\n    setTimeout(function(){\n//      $('#addcontactbutton').click(newConnection);\n      $(ME).find('.accesscodespopupclose').click(function(){\n        el[0].api.close(function(){\n          el.empty();\n          el.append(el[0].api.oldhtml);\n          el.css('display','none');\n        });\n      });\n      \n      json('../peerbot/suggestaccesscode', null, function(result){\n        $('#newaccesscode').val(result.msg);\n      });\n      \n      $('.addaccesscodebutton').click(addAccessCode);\n      \n    }, 1000);\n  }, {});\n});\n\nfunction addAccessCode(){\n\tvar code = encodeURIComponent($('#newaccesscode').val());\n\tvar del = $('#deleteonuse').prop('checked');\n\tvar groups = encodeURIComponent($('.acgroupselect').find('select').val());\n\n    json('../peerbot/addaccesscode', 'code='+code+'&delete='+del+'&groups='+groups, function(result){\n\t\tif (result.status == 'ok') {\n\t\t\t$('#adcodebackbutton').click();\n\t\t\tlistAccessCodes();\n          \n            json('../peerbot/suggestaccesscode', null, function(result){\n              $('#newaccesscode').val(result.msg);\n            });\n          \n\t\t}\n\t\telse alert(result.msg);\n\t});\n}\n\nfunction discovery() {\n  $('#botlist').html('<div class=\"pb-deviceinfo\">Scanning...<\/div>');\n\n  json(\"../botmanager/discover\", null, function(result) {\n    console.log(result);\n    var newhtml = '';\n    if (result.status != 'ok') newhtml = '<font color=\"red\">Error: '+result.msg+'<\/font>';\n    else {\n      var n=0;\n      for (var item in result.data) {\n        var rai = result.data[item];\n        if (rai.peerinfo) {\n          n++;\n          var url = \"http://\"+rai.address[0]+':'+rai.port+'/';\n          var con = me.peers[rai.uuid];\n          var floater;\n          if (con) {\n            if (con.connected) floater = \"<font color='green'>connected<\/font><br><input type='button' value='disconnect' onclick='disconnect(\\\"\"+rai.uuid+\"\\\");' data-mini='true'>\";\n            else floater = \"not connected<br><input type='button' value='connect' onclick='connect(\\\"\"+rai.uuid+\"\\\");' data-mini='true' data-theme='a'>\";\n          }\n          else floater = \"<input type='button' value='add connection' onclick='addConnection(\\\"\"+rai.uuid+\"\\\",\\\"\"+rai.address[0]+\"\\\",\\\"\"+rai.peerinfo.port+\"\\\");' data-theme='a'>\";\n          newhtml \n            += '<li id=\"li_'+rai.uuid+'\"><div style=\"position:absolute;z-index:10;right:50px;text-align:right;\">'+floater+'<\/div><a id=\"a_'+rai.uuid+'\" class=\"li_botlist\" href=\"'+url+'\">'\n            + '<span class=\"ui-li-heading\">'+rai.name+' ('+rai.uuid+')<\/span><p class=\"ui-li-desc\"><span class=\"daddr\">'+rai.address[0]+'<\/span>:<span class=\"dport\">'+rai.port+'<\/span><\/p><\/a><\/li>';\n        }\n      }\n\t\t\t\n      if (n>0) newhtml \n          = 'Available Peers<ul id=\"ul_botlist\">'\n          + newhtml\n          + '<\/ul>';\n      else newhtml = '<div class=\"pb-deviceinfo\">No Peers Detected in Local Network.<\/div>';\n    }\n    $('#botlist').html(newhtml);\n    $('#botlist').trigger('create');\n    document.getElementById('botlist').botlist = result.data;\n  });\n}\n\nconnect = function(uuid){\n  var addr = $('#li_'+rai.uuid).find('.daddr').text();\n  var port = $('#li_'+rai.uuid).find('.dport').text();\n  json('../peerbot/connect', 'uuid='+uuid+'&addr='+encodeURIComponent(addr)+'&port='+port, function(result){\n    discovery();\n  });\n};\n\ndisconnect = function(uuid){\n  json('../peerbot/disconnect', 'uuid='+uuid, function(result){\n    discovery();\n  });\n};\n\naddConnection = function(uuid, addr, port){\n  $('#newcontactid').val(uuid);\n  $('#newcontactip').val(addr);\n  $('#newcontactport').val(port);\n  \n  newConnection();\n  discovery();\n};\n\n$(ME).find('.lanbutton').click(function(){\n  $('#botlist').html('');\n  var el = $(ME).find('.lanpopup');\n  installControl(el[0], 'metabot', 'popupdialog', function(){\n    el.css('display', 'block');\n    setTimeout(function(){\n      discovery();\n      $(ME).find('.lanpopupclose').click(function(){\n        el[0].api.close(function(){\n          el.empty();\n          el.append(el[0].api.oldhtml);\n          el.css('display','none');\n        });\n      });\n    }, 1000);\n  }, {});\n});\n\n\n$(ME).find('.addpeerbutton').click(function(){\n  $('.gep1').css('display', 'block');\n  $('.gep2').css('display', 'none')\n      \n  var el = $(ME).find('.addpeerpopup');\n  installControl(el[0], 'metabot', 'popupdialog', function(){\n    el.css('display', 'block');\n    setTimeout(function(){\n      $('#addcontactbutton').click(newConnection);\n      $('#createtheinvite').click(createInvite);\n      $('#accepttheinvite').click(acceptInvite);\n      \n      $(ME).find('.addpeerpopupclose').click(function(){\n        el[0].api.close(function(){\n          el.empty();\n          el.append(el[0].api.oldhtml);\n          el.css('display','none');\n        });\n      });\n    }, 1000);\n  }, {});\n});\n\nfunction newConnection() {\n  var id = $('#newcontactid').val();\n  var addr = $('#newcontactip').val();\n  var port = $('#newcontactport').val();\n  var code = $('#newcontactcode').val();\n  var groups = $('.peergroupselect').find('select').val();\n\n  if (!id || id.trim() == '') $('#newconactmsg').html('<font color=\"red\">Universal ID is required<\/font>');\n  else {\n    if (!addr || addr.trim() == '') addr='';\n    if (!port || port.trim() == '') port='';\n    if (!code || code.trim() == '') code='';\n    if (!groups || groups.trim() == '') groups='';\n  \n    $('#newconactmsg').html('<font color=\"green\">Connecting to: '+id+'<\/font>');\n    json('../peerbot/newconnection', 'sessionid='+sessionid+'&uuid='+encodeURIComponent(id)+\"&addr=\"+encodeURIComponent(addr)+\"&port=\"+encodeURIComponent(port)+\"&code=\"+encodeURIComponent(code)+\"&groups=\"+encodeURIComponent(groups), function(result) {\n      if (result.status == 'ok') {\n        document.location.href = ''+document.location.href;\n      }\n      else {\n        $('#newconactmsg').html('<font color=\"red\">ERROR: '+result.msg+'<\/font>');\n        setTimeout(\"$('#newconactmsg').html('');\", 5000);\n      }\n    });\n  }  \n}  \n\n$(ME).find('.addremotecontrolbutton').click(function(){\n  var el = $(ME).find('.availablecontrols');\n  installControl(el[0], 'metabot', 'popupdialog', function(){\n    el.css('display', 'block');\n  }, {});\n});\n\ncloseADDCTL = function(){\n  var el = $(ME).find('.availablecontrols');\n  el[0].api.close(function(){\n    el.empty();\n    el.append(el[0].api.oldhtml);\n    el.css('display','none');\n  });\n};\n\n$(ME).find('.restartservicesbutton').click(function(){\n  var uuid = $(ME).find('.pb-peer-uuid').text();\n  json('../peerbot/remote/'+uuid+'/botmanager/restart', null, function(result){\n    var snackbarContainer = document.querySelector('#restart-snackbar');\n    var data = {\n      message: result.msg\n    };\n    snackbarContainer.MaterialSnackbar.showSnackbar(data);\n  });\n});\n\n$(ME).find('.refreshcontrolsbutton').click(function(){\n  var uuid = $(ME).find('.pb-peer-uuid').text();\n  showTheHUD(uuid);\n});\n\n$(ME).find('.managecontrolsbutton').click(function(){\n  $('.hudapps').css('display', 'none');\n  $('.close-settings').css('display', 'block');\n  $(ME).find('.controlsettings').css('opacity', '0').css('display', 'block').animate({\"opacity\": 1}, 500);\n});\n\n$(ME).find('.close-settings').click(function(){\n  $('.close-settings').css('display', 'none');\n  $('.controlsettings').css('display', 'none');\n  $(ME).find('.hudapps').css('opacity', '0').css('display', 'block').animate({\"opacity\": 1}, 500);\n});\n\nfunction acceptInvite(){\n  var ic = $('#enterinvitecode').val().split('_');\n  if (ic.length != 2) alert(\"That is not a valid invite code!\");\n  var groups = encodeURIComponent($('.invitegroupselect').find('select').val());\n  json('../peerbot/connect', 'uuid='+ic[0]+'&code='+ic[1]+'&groups='+groups, function(result){\n    if (result.status != 'ok') alert(result.msg);\n    else document.location.href = ''+document.location.href;\n  });\n}\n\nfunction createInvite(){\n  json('suggestaccesscode', null, function(result){\n    var ac = encodeURIComponent(result.msg);\n    var code = encodeURIComponent(result.msg);\n    var del = true;\n    var groups = encodeURIComponent($('.invitegroupselect').find('select').val());\n    json('../peerbot/addaccesscode', 'code='+code+'&delete='+del+'&groups='+groups, function(result){\n      if (result.status == 'ok') {\n        json('../peerbot/getpeerid', null, function(result){\n          var meid = result.msg;\n          $('.gep1').css('display', 'none');\n          $('.gep2').css('display', 'block').html('<center><br><br><br>Send the following code to your friend:<br><br><font size=\"large\">'+meid+'_'+ac+'<\/font><\/center>');\n          listAccessCodes();\n        });\n      }\n      else alert(result.msg);\n    });\n  });\n}\n\n$(document).click(function(event) {\n   window.lastElementClicked = event.target;\n});\n\n\n\n\n","groups":"","ctl":"msrtou168d8e952bdq8040","html":"<div id='matrixviewer' />\n<div class='localinfo'>\n  <div class='localpeername'><\/div>\n  <div class='localbrokers2'><\/div>\n  <div class='localpeerid'><\/div>\n  <div class='localpeerport'><\/div>\n<\/div>\n<div class='hud1 hud'>\n  <span class='pb-peer-strength'><\/span>\n  \n  <button id=\"control-menu-lower-left\" class=\"editcontrolsbutton mdl-button mdl-js-button mdl-button--icon\">\n    <i class=\"material-icons\">more_vert<\/i>\n  <\/button>\n\n  <ul class=\"mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect\"\n      for=\"control-menu-lower-left\">\n    <li class=\"mdl-menu__item refreshcontrolsbutton\">Refresh<\/li>\n    <li class=\"mdl-menu__item addremotecontrolbutton connectedandadminonly\">Add Control<\/li>\n    <li class=\"mdl-menu__item managecontrolsbutton connectedandadminonly\">Manage Controls<\/li>\n    <li class=\"mdl-menu__item restartservicesbutton connectedandadminonly\">Restart Services<\/li>\n  <\/ul>  \n  \n  \n  \n  \n  <div class='pb-peer-name'><\/div>\n  <span class='pb-peer-uuid'><\/span>\n  <button class=\"deletepeerbutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\">delete<\/button>\n  <div class='updateremote'><\/div>\n  <span class='pb-peer-alladdr'><\/span>\n  <div class='pb-peer-raw'><\/div>\n  <button id=\"close-settings\" class=\"close-settings editcontrolsbutton mdl-button mdl-js-button mdl-button--icon\">\n    <i class=\"material-icons\">close<\/i>\n  <\/button>\n  <div class='controlsettings'><\/div>\n  <div class='hudapps'><\/div>\n  \n  <div class='availablecontrols'>\n  \n    \n    <div class=\"mdl-card__title\">\n      <h2 class=\"mdl-card__title-text\">Install Control<\/h2>\n    <\/div>\n    <div class=\"aclist mdl-card__supporting-text\">\n      <table class=\"actable mdl-data-table mdl-js-data-table mdl-shadow--2dp\">\n        <thead>\n          <tr>\n            <th class=\"mdl-data-table__cell--non-numeric\">Name<\/th>\n            <th class=\"mdl-data-table__cell--non-numeric\">lib:id<\/th>\n            <th class=\"mdl-data-table__cell--non-numeric\">security<\/th>\n          <\/tr>\n        <\/thead>\n        <tbody class='aclisttablebody'>\n        <\/tbody>\n      <\/table>      \n    <\/div>\n    <div class=\"mdl-card__menu\">\n      <button class=\"closeaddctl mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\" onclick=\"closeADDCTL();\">\n        <i class=\"material-icons\">close<\/i>\n      <\/button>\n    <\/div>    \n    \n  <\/div>\n  \n  <br><br><br><br><br><br><br><br>\n\n  <button class=\"closehudbutton mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab\"><i class=\"material-icons\">close<\/i><\/button>\n\n<\/div>\n\n<div class='topbuttons'>\n  <button class=\"backbutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\" onclick=\"document.location.href='../';\"><i class=\"material-icons\">chevron_left<\/i><\/button>\n<\/div>\n\n<div class=\"bottombuttons\">\n  <button class=\"addpeerbutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\"><i class=\"material-icons\">person_add<\/i><\/button>\n  <button class=\"accesscodebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\"><i class=\"material-icons\">security<\/i><\/button>\n  <button class=\"lanbutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\"><i class=\"material-icons\">wifi<\/i><\/button>\n<\/div>\n\n\n\n<div class='lanpopup'>\n  <div class=\"mdl-card__title\"><h2 class=\"mdl-card__title-text\">Local Area Network<\/h2><\/div>\n  <div id=\"botlist\" class='botlist mdl-card__supporting-text'><\/div>\n  <div class=\"mdl-card__menu\">\n    <button id=\"lanpopupclose\" class=\"lanpopupclose mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">\n      <i class=\"material-icons\">close<\/i>\n    <\/button>\n  <\/div>\n<\/div>\n\n\n\n\n\n<div class='accesscodespopup'>\n  <div class=\"mdl-card__title\"><h2 class=\"mdl-card__title-text\">Access Codes<\/h2><\/div>\n  <div class='codelist mdl-card__supporting-text'><\/div>\n  <div class=\"mdl-card__actions mdl-card--border\">\n    <form action=\"#\">\n      <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n        <input class=\"mdl-textfield__input\" type=\"text\" id=\"newaccesscode\" value=\" \">\n        <label class=\"mdl-textfield__label\" for=\"newaccesscode\">Access Code<\/label>\n      <\/div>\n      <div class='data-control acgroupselect' data-control='securitybot:groupselect' data-exclude=\"anonymous\"><\/div>\n      <a class=\"addaccesscodebutton mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect\">\n        Add\n      <\/a>\n      <label class=\"singleuse mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect\" for=\"deleteonuse\">\n        <input type=\"checkbox\" id=\"deleteonuse\" class=\"mdl-checkbox__input\" checked>\n        <span class=\"mdl-checkbox__label\">Single use<\/span>\n      <\/label>    \n    <\/form>    \n  <\/div>    \n  <div class=\"mdl-card__menu\">\n    <button id=\"accesscodespopupclose\" class=\"accesscodespopupclose mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">\n      <i class=\"material-icons\">close<\/i>\n    <\/button>\n  <\/div>\n<\/div>\n\n<div class='addpeerpopup'>\n  <div class=\"mdl-card__title\">\n    <h2 class=\"mdl-card__title-text\">Add Connection<\/h2>\n  <\/div>\n\n  \n  <div class=\"mdl-layout mdl-js-layout mdl-layout--fixed-header\">\n    <header class=\"mdl-layout__header\">\n      <div class=\"mdl-layout__tab-bar mdl-js-ripple-effect\">\n        <a href=\"#scroll-tab-1\" class=\"mdl-layout__tab is-active\">Invitations<\/a>\n        <a href=\"#scroll-tab-2\" class=\"mdl-layout__tab\">Manual<\/a>\n      <\/div>\n    <\/header>\n    <main class=\"mdl-layout__content\">\n      <section class=\"mdl-layout__tab-panel is-active\" id=\"scroll-tab-1\">\n        <div class=\"page-content\">\n          <div class='gep1'>\n            <br>\n            <div class='data-control invitegroupselect' data-control='securitybot:groupselect'><\/div>\n            <table border='0' cellpadding='0' cellspacing='0' style='width:100%;'>\n              <tr>\n                <td style='text-align:center;vertical-align:bottom;'>\n                  <div class='generatedinvite'>&nbsp;<\/div>\n                  <button id=\"createtheinvite\"  class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\">\n                    Generate Invite\n                  <\/button>\n                <\/td>\n                <td>OR&nbsp;&nbsp;&nbsp;&nbsp;<\/td>\n                <td style='vertical-align:top;width:250px;'>\n                  <form class=\"smallcols\" action=\"#\">\n                    <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                      <input class=\"mdl-textfield__input\" type=\"text\" id=\"enterinvitecode\">\n                      <label class=\"mdl-textfield__label\" for=\"enterinvitecode\">Enter Invite Code<\/label>\n                    <\/div>\n                  <\/form>\n                  <button id=\"accepttheinvite\" class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored\">\n                    Accept Invite\n                  <\/button>\n                <\/td>\n              <\/tr>\n            <\/table>\n          <\/div>\n        <\/div>\n        <div class='gep2'><\/div>\n      <\/section>\n      <section class=\"mdl-layout__tab-panel\" id=\"scroll-tab-2\">\n        <div class=\"page-content\">\n          <div class='addpeerform mdl-card__supporting-text'>\n            <form action=\"#\">\n              <table border='0' cellpadding='0' cellspacing='0' style='margin-bottom:-20px;'>\n                <tr>\n                  <td style='vertical-align:top;width:250px;'>\n                    <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                      <input class=\"mdl-textfield__input\" type=\"text\" id=\"newcontactid\">\n                      <label class=\"mdl-textfield__label\" for=\"newcontactid\">Device UUID<\/label>\n                    <\/div>\n                    <div class='data-control peergroupselect' data-control='securitybot:groupselect'><\/div>\n                    <br><br>\n                    <div id='newconactmsg'><\/div>\n                  <\/td>\n                  <td>&nbsp;&nbsp;&nbsp;&nbsp;<\/td>\n                  <td style='vertical-align:top;width:250px;'>\n                    <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                      <input class=\"mdl-textfield__input\" type=\"text\" id=\"newcontactcode\">\n                      <label class=\"mdl-textfield__label\" for=\"newcontactcode\">Access Code (if you have one)<\/label>\n                    <\/div>\n                    <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                      <input class=\"mdl-textfield__input\" type=\"text\" id=\"newcontactip\">\n                      <label class=\"mdl-textfield__label\" for=\"newcontactip\">IP Address (if you have it)<\/label>\n                    <\/div>\n                    <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                      <input class=\"mdl-textfield__input\" type=\"text\" id=\"newcontactport\">\n                      <label class=\"mdl-textfield__label\" for=\"newcontactport\">Port Number (if you have it)<\/label>\n                    <\/div>\n                  <\/td>\n                <\/tr>\n              <\/table>\n            <\/form>    \n\n          <\/div>  \n          <div class=\"mdl-card__actions mdl-card--border\">\n            <a id=\"addcontactbutton\" class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect\">\n              Add\n            <\/a>\n          <\/div>    \n        <\/div>\n      <\/section>\n    <\/main>\n  <\/div>\n  \n  \n  <div class=\"mdl-card__menu\">\n    <button id=\"adconbackbutton\" class=\"addpeerpopupclose mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">\n      <i class=\"material-icons\">close<\/i>\n    <\/button>\n  <\/div>\n<\/div>\n\n\n<div class='popmeup'><div class='popupcontents'><\/div><\/div>","three":{"controls":[]},"db":"peerbot","desc":""},"id":"msrtou168d8e952bdq8040","sessionid":"jhtpuq15d03ce0a74q0","time":1549827435603,"addr":"/0:0:0:0:0:0:0:1:58858","username":"mraiser"}