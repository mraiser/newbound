{"data":{"css":".hideme{\n  display:none;\n}\n\n.aeditor{\n  display:none;\n  position:absolute;\n  width:330px;\n  height:400px;\n}\n\n.scrolllist{\n  position:relative;\n  height:255px;\n  overflow-y:scroll;\n}\n\n.animationstep{\n  height:118px;\n}\n\n.deleteanimationbutton{\n  float:right;\n}","data":[],"name":"animationlist","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.poses = ME.DATA.poses = ME.DATA.poses ? ME.DATA.poses : [];\nme.animations = ME.DATA.animations = ME.DATA.animations ? ME.DATA.animations : [{}];\n\nme.ready = function(){\n  if (me.poses.length == 0) $(ME).find('.alist').html('<i>Poses are required to create animations, but you have none. Create some poses first.<\/i>');\n  else {\n    $(ME).find('.addanimation').removeClass('hideme').click(addAnimation);\n    rebuildAnimations();\n  }\n\n  componentHandler.upgradeAllRegistered();\n};\n\nfunction addAnimation(){\n  var a = {\n    name: \"Untitled\",\n    id: guid(),\n    steps:[{}]\n  };\n  editAnimation(a);\n}\n\nfunction editAnimation(a){\n  me.animation = a;\n  var el = $(ME).find('.aeditor');\n  installControl(el[0], 'metabot', 'popupdialog', function(api){\n    setTimeout(function(){\n      rebuildAnimation();\n      $(ME).find('.addanimationpose').click(function(){\n        me.animation.steps.push({});\n        rebuildAnimation();\n      });\n      $(ME).find('.saveanimationlistbutton').click(function(){\n        if (getByProperty(me.animations, \"id\", me.animation.id) == null) \n          me.animations.push(me.animation);\n        me.animation.name = $('#animationname').val();\n        me.animation.steps = extractSteps();\n        $(ME).find('.aeditor')[0].api.closeAndReset();\n        saveAnimations();\n      });\n      var i = me.animations.indexOf(me.animation);\n      if (i != -1){\n        $(ME).find('.deleteanimationbutton').css('display', 'inline-block').click(function(){\n          me.animations.splice(i,1);\n          $(ME).find('.aeditor')[0].api.closeAndReset();\n          saveAnimations();\n        });\n      }\n      else{\n        $(ME).find('.deleteanimationbutton').css('display', 'none');\n      }\n    }, 1000);\n  }, {});\n}\n\nfunction extractSteps(){\n  var steps = [];\n  var divs = $(ME).find('.aplist').find('.animationstep');\n  var n = divs.length;\n  for (var i=0;i<n;i++){\n    var div = $(divs[i]);\n    var millis = div.find('.apmillis').find('input').val();\n    var pose = div.find('.apselect').find('select').val();\n    var data = {\n      millis:millis,\n      pose:pose\n    };\n    steps.push(data);\n  }\n  return steps;\n}\n\nfunction saveAnimations(){\n  ME.DATA.cb();\n  rebuildAnimations();\n}\n\nfunction rebuildAnimations(){\n  var el = $(ME).find('.alist');\n  var newhtml = '';\n  for (var i in me.animations){\n    var a = me.animations[i];\n    var name = a.name = a.name ? a.name : \"Untitled\";\n    var id = a.id = a.id ? a.id : guid();\n    var steps = a.steps = a.steps ? a.steps : [];\n    newhtml += '<span class=\"mdl-chip mdl-chip--deletable clickme\" data-index=\"'+i+'\"><span class=\"mdl-chip__text\">'+name+'<\/span><button type=\"button\" class=\"mdl-chip__action\"><i class=\"material-icons\">edit<\/i><\/button><\/span>';\n  }\n  if (newhtml != '') newhtml += '<br><br>';\n  el.html(newhtml);\n  el.find('.mdl-chip__text').click(function(){\n    var i = $(this).parent().data('index');\n    $('#Model').data('animate', a.id);\n  });\n  el.find('.mdl-chip__action').click(function(){\n    var i = $(this).parent().data('index');\n    var a = me.animations[i];\n    editAnimation(a);\n  });\n}\n\nfunction rebuildAnimation(){\n  var a = me.animation;\n  $('#animationname').val(a.name).parent()[0].MaterialTextfield.checkDirty();\n  var div = $(ME).find('.aplist');\n  div.empty();\n  for (var i in a.steps){\n    var s = a.steps[i];\n    var data = {\n      poses: me.poses,\n      animation: s\n    }\n    var el = $('<div class=\"animationstep\"/>');\n    div.append('Step '+(Number(i)+1)+':');\n    div.append(el);\n    installControl(el[0], 'threejs', 'animationeditor', function(api){}, data);\n  }\n}","groups":"","ctl":"uxrnvm166cb38b87al68b0","html":"<div class='alist'><\/div>\n<button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored hideme addanimation\">\n  <i class=\"material-icons\">add<\/i>\n<\/button>\n<div class='aeditor'>\n\n  <div class=\"demo-card-wide mdl-card mdl-shadow--2dp\">\n    <div class=\"mdl-card__title\">\n      <h2 class=\"mdl-card__title-text\">Edit Animation<\/h2>\n    <\/div>\n    <div class=\"mdl-card__supporting-text scrolllist\">\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"animationname\">\n          <label class=\"mdl-textfield__label\" for=\"animationname\">Name<\/label>\n        <\/div>\n      <\/form>      \n      <b>Animation Steps:<\/b>\n      <div class='aplist'><\/div>\n      <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addanimationpose\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>\n    <\/div>\n    <div class=\"mdl-card__actions mdl-card--border\">\n      <a class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect saveanimationlistbutton\">\n        Save\n      <\/a>\n      <a class=\"mdl-button mdl-js-button mdl-js-ripple-effect deleteanimationbutton\">\n        Delete\n      <\/a>\n    <\/div>\n    <div class=\"mdl-card__menu\">\n      <button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\" onclick=\"$(this).closest('.aeditor')[0].api.closeAndReset();\">\n        <i class=\"material-icons\">close<\/i>\n      <\/button>\n    <\/div>\n  <\/div>\n  \n  \n<\/div>\n","db":"threejs","desc":""},"id":"uxrnvm166cb38b87al68b0","sessionid":"jhtpuq15d03ce0a74q0","time":1541096522310,"addr":"/0:0:0:0:0:0:0:1:51464","username":"mraiser"}