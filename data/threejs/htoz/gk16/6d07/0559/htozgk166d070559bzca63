{"data":{"css":"","data":[],"name":"poseanimation","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  componentHandler.upgradeAllRegistered();\n};\n\nme.animate = function(model){\n  me.metadata = $(ME).data('metadata');\n  var animations = model.animations;\n  var current, step, start, nrig, drig, millis;\n  animations.push(function(model){\n    var now = new Date().getTime();\n    if (current){\n      var p = Math.min(1, (now - start)/millis);\n      for (var i in drig){\n        model.rig[i] = drig[i] + ((nrig[i] - drig[i])*p);\n      }\n      if (p == 1) {\n        step++;\n        if (step >= current.steps.length) current = null;\n        else{\n          start += millis;\n          drig = {};\n          var s = current.steps[step];\n          var p = getByProperty(me.metadata.poses, \"id\", s.pose);\n          nrig = p.pose;\n          for (var i in model.rig) if (model.rig[i] != nrig[i]) drig[i] = model.rig[i];\n          millis = Number(s.millis);  \n        }\n      }\n    }\n    else{\n      var a = $(ME).data('animate');\n      if (a){\n        $(ME).data('animate', null);\n        current = getByProperty(me.metadata.animations, 'id', a);\n        step = 0;\n        start = now;\n        drig = {};\n        var s = current.steps[step];\n        var p = getByProperty(me.metadata.poses, \"id\", s.pose);\n        nrig = p.pose;\n        for (var i in model.rig) if (model.rig[i] != nrig[i]) drig[i] = model.rig[i];\n        millis = Number(s.millis); \n      }\n    }\n  });\n};","groups":"anonymous","ctl":"htozgk166d070559bzca63","html":"","db":"threejs","desc":""},"readers":["anonymous"],"id":"htozgk166d070559bzca63","sessionid":"jvgvwg16b7a4d277bt3","time":1574954038825,"addr":"/0:0:0:0:0:0:0:1:49184","username":"admin"}