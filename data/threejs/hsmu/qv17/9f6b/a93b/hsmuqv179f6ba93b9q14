{"data":{"css":"","data":[],"name":"controlloader","js":"var me = this; \nvar ME = $('#'+me.UUID)[0];\n\nvar mname = me.modelid = ME.id;\n\nvar set = this.models = [];\n$(ME).data('models', set);\n\nvar helpset = [];\nvar scaleVal = 3;\n\nvar datGUI = me.datgui = $(ME).data('datgui');\nvar scene = me.scene = $(ME).data('scene');\nvar group = me.group = $(ME).data('group');\nvar db = me.db = $(ME).data('db');\nvar animations = me.animations = [];\n\nvar files = $(ME).data('assets');\nif (files && files.list) files = files.list;\n\nvar rig = me.rig = new function(){\n  this.speed  = 0.25;\n\n  var pos = $(ME).data('pos');\n  var rot = $(ME).data('rot');\n  var scale = $(ME).data('scale');\n  \n  this.pos_x = pos ? pos.x : ME.DATA.pos ? ME.DATA.pos.x : 0;\n  this.pos_y = pos ? pos.y : ME.DATA.pos ? ME.DATA.pos.y : 0;\n  this.pos_z = pos ? pos.z : ME.DATA.pos ? ME.DATA.pos.z : 0;\n\n  this.rot_x = rot ? rot.x : ME.DATA.rot ? ME.DATA.rot.x : 0;\n  this.rot_y = rot ? rot.y : ME.DATA.rot ? ME.DATA.rot.y : 0;\n  this.rot_z = rot ? rot.z : ME.DATA.rot ? ME.DATA.rot.z : 0;\n\n  this.scale_x = scale ? scale.x : ME.DATA.scale ? ME.DATA.scale.x : 1;\n  this.scale_y = scale ? scale.y : ME.DATA.scale ? ME.DATA.scale.y : 1;\n  this.scale_z = scale ? scale.z : ME.DATA.scale ? ME.DATA.scale.z : 1;\n};\n\nme.onload = function(cb){\n  me.onloadcb = cb;\n  me.checkIfDone();\n};\n\nme.checkIfDone = function(){\n  if (me.onloadcb && (!files || files.length == me.models.length)) {\n    me.onloadcb(me);\n  }\n};\n\nme.ready = function(){\n  if (datGUI) {\n    var cfolder = me.cfolder = me.cfolder ? me.cfolder : datGUI ? datGUI.addFolder(mname) : null;\n    $(ME).data('cfolder', cfolder);  \n\n    cfolder.add(rig, 'pos_x',-10, 10);\n    cfolder.add(rig, 'pos_y',-10, 10);\n    cfolder.add(rig, 'pos_z',-10, 10);\n    cfolder.add(rig, 'rot_x',-3.14, 3.14);\n    cfolder.add(rig, 'rot_y',-3.14, 3.14);\n    cfolder.add(rig, 'rot_z',-3.14, 3.14);\n    cfolder.add(rig, 'scale_x',0, 10);\n    cfolder.add(rig, 'scale_y',0, 10);\n    cfolder.add(rig, 'scale_z',0, 10);\n  }\n\n  for (var i in files) {\n    var ci = files[i].indexOf(':');\n    var mdb = ci == -1 ? db : files[i].substring(0, ci);\n    var mfi = ci == -1 ? files[i] : files[i].substring(ci+1);\n    var mfilc = mfi.toLowerCase();\n    \n    if (mfilc.endsWith('.gltf')){\n        \n      var loader = new THREE.GLTFLoader();\n      loader.load(\n        '../botmanager/asset/'+mdb+'/'+mfi, \n        function (gtlf) {\n          addMesh(gtlf.scene);\n        },\n        (xhr) => {\n            console.log((xhr.loaded / xhr.total * 100) + '% loaded')\n        },\n        (error) => {\n            console.log(error);\n        }\n      );\n        \n        \n    }\n  }\n};\n\nfunction addMesh(mesh){\n  var set = me.models;\n  var i = set.length;\n  set[i] = mesh;\n  set[i].castShadow = true;\n  set[i].receiveShadow = true;\n\n  if (group) group.add(set[i]);\n  else scene.add(set[i]);\n  helpset[i] = new THREE.SkeletonHelper(set[i]);\n\n  if (datGUI){\n    var cfolder = me.cfolder;\n    mesh.traverse(function(a){\n      if (a instanceof THREE.SkinnedMesh){\n        a.frustumCulled = false;\n        for (var j in a.skeleton.bones){\n          var child = a.skeleton.bones[j];\n          if (typeof rig[child.name+'_x'] == 'undefined'){\n            var n = child.name;\n\n            rig[n+'_x'] = child.rotation.x;\n            rig[n+'_y'] = child.rotation.y;\n            rig[n+'_z'] = child.rotation.z;\n\n            cfolder.add(rig, n+'_x',-3.14, 3.14);\n            cfolder.add(rig, n+'_y',-3.14, 3.14);\n            cfolder.add(rig, n+'_z',-3.14, 3.14);\n          }\n        }\n      }\n    });\n  }\n  me.checkIfDone();\n}\n\nfunction render() { \n  var now = new Date().getTime();\n  for (var i in animations) animations[i](me, now);\n\n  if (!rig.ignore) {\n    if (group){\n      group.position.set(rig.pos_x,rig.pos_y,rig.pos_z);\n      group.rotation.set(rig.rot_x,rig.rot_y,rig.rot_z);\n      group.scale.set(rig.scale_x,rig.scale_y,rig.scale_z);\n    }\n    for (var i in set){\n      var child = set[i];\n      \n      if (!group){\n        child.position.set(rig.pos_x,rig.pos_y,rig.pos_z);\n        child.rotation.set(rig.rot_x,rig.rot_y,rig.rot_z);\n        child.scale.set(rig.scale_x,rig.scale_y,rig.scale_z);\n      }\n      \n      child.traverse(function(a){\n        if (a instanceof THREE.SkinnedMesh){\n          for (var j in a.skeleton.bones){\n            var b = a.skeleton.bones[j];\n            b.rotation.x = rig[b.name+'_x'];\n            b.rotation.y = rig[b.name+'_y'];\n            b.rotation.z = rig[b.name+'_z'];\n          }\n        }\n      });\n    }\n  }\n}\nme.render = render;\n\nme.mousedown = function(event){\n  if (me.api && me.api.mousedown) return me.api.mousedown(event);\n  else if (me.parent && me.parent.mousedown) return me.parent.mousedown(event);\n};\n\nme.mousemove = function(event){\n  if (me.api && me.api.mousemove) return me.api.mousemove(event);\n  else if (me.parent && me.parent.mousemove) return me.parent.mousemove(event);\n};\n\nme.mouseup = function(event){\n  if (me.api && me.api.mouseup) return me.api.mouseup(event);\n  else if (me.parent && me.parent.mouseup) return me.parent.mouseup(event);\n};\n\nme.drag = function(event){\n  if (me.api && me.api.drag) return me.api.drag(event);\n  else if (me.parent && me.parent.drag) return me.parent.drag(event);\n};\n\nme.dragover = function(event, model){\n  if (me.api && me.api.dragover) return me.api.dragover(event, model);\n  else if (me.parent && me.parent.dragover) return me.parent.dragover(event, model);\n};\n\nme.dragoff = function(event){\n  if (me.api && me.api.dragoff) return me.api.dragoff(event);\n  else if (me.parent && me.parent.dragoff) return me.parent.dragoff(event);\n};\n\nme.drop = function(event, model){\n  if (me.api && me.api.drop) return me.api.drop(event, model);\n  else if (me.parent && me.parent.drop) return me.parent.drop(event, model);\n};\n\nme.click = function(event){\n  if (me.api && me.api.click) return me.api.click(event);\n  else if (me.parent && me.parent.click) return me.parent.click(event);\n};\n\nme.dblclick = function(event){\n  if (me.api && me.api.dblclick) return me.api.dblclick(event);\n  else if (me.parent && me.parent.dblclick) return me.parent.dblclick(event);\n};\n","groups":"","ctl":"hsmuqv179f6ba93b9q14","html":"","db":"threejs","desc":""},"id":"hsmuqv179f6ba93b9q14","sessionid":"jvgvwg16b7a4d277bt3","time":1623345332537,"addr":"/0:0:0:0:0:0:0:1:59554","username":"admin"}