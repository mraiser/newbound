{"data":{"css":".closeeditmodelbutton{\n  position:absolute;\n  top:5px;\n  right:5px;\n}\n\n.selectassetbutton{\n  position:absolute;\n  margin-top:-84px;\n  left:300px;\n}\n\n.popmeup{\n  position:absolute;\n  display:none;\n  width:330px;\n  height:210px;\n}\n\n.clickme{\n  cursor:pointer;\n}","data":[],"name":"modeleditor","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  $('#editmodelname').val(ME.DATA.model.name);\n  $('#editmodelthumbnail').val(ME.DATA.model.thumbnail);\n  $('#editmodelbackground').val(ME.DATA.model.background);\n  $('#editmodeloverlay').val(ME.DATA.model.overlay);\n  $('#opslider').val(ME.DATA.model.overlayopacity);\n  componentHandler.upgradeAllRegistered();\n  \n  me.viewer = ME.DATA.viewer;\n  \n  var data = {\n    lib: ME.DATA.model.lib,\n    allowadd:true,\n    list: ME.DATA.model.assets,\n    cb: function(val){\n      if (ME.DATA.cb) ME.DATA.cb(ME.DATA.model);\n    }\n  };\n  var el = $(ME).find('.assetlistgoeshere');\n  installControl(el[0], 'metabot', 'assetlist', function(api){}, data);\n  \n  ME.DATA.model.overlayopacity = $('#opslider').val();\n  updateImages();\n\n  me.poses = ME.DATA.model.poses = ME.DATA.model.poses ? ME.DATA.model.poses : [];\n  me.animations = ME.DATA.model.animations = ME.DATA.model.animations ? ME.DATA.model.animations : [];\n  rebuildPoses();\n};\n\nfunction updateImages(){\n  el = $('#'+ME.DATA.viewer.UUID)\n  el.find('.imagebackground').css('background-image', 'url('+ME.DATA.model.background+')');\n  el.find('.imageoverlay').css('background-image', 'url('+ME.DATA.model.overlay+')').css('opacity', ME.DATA.model.overlayopacity/100);\n}\n\nfunction popupAssetPicker(which){\n  me.field = which;\n  data = {\n    lib: ME.DATA.model.lib,\n    allowadd:true\n  };\n  installControl($(ME).find('.assetpicker')[0], 'metabot', 'assetselect', function(api){\n    me.picker = api;    \n    installControl($(ME).find('.popmeup')[0], 'metabot', 'popupdialog', function(api){}, {});\n  }, data);\n}\n\n$(ME).find('.choosethumbbutton').click(function(event) {\n  popupAssetPicker('thumbnail');\n});\n\n$(ME).find('.choosebackgroundbutton').click(function(event) {\n  popupAssetPicker('background');\n});\n\n$(ME).find('.chooseoverlaybutton').click(function(event) {\n  popupAssetPicker('overlay');\n});\n\nme.selectThumb = function(val){\n  var lib = me.picker.lib;\n  var val = me.picker.value();\n  var url = '../botmanager/asset/'+lib+'/'+val;\n  $('#editmodel'+me.field).val(url).parent()[0].MaterialTextfield.checkDirty();\n  $(ME).find('.closeme').click();\n  ME.DATA.model[me.field] = url;\n  updateImages();\n  if (ME.DATA.cb) ME.DATA.cb(ME.DATA.model, true);\n}\n\n$('#opslider').change(function(){\n  ME.DATA.model.overlayopacity = $(this).val();\n  updateImages();\n  if (ME.DATA.cb) ME.DATA.cb(ME.DATA.model, true);\n});\n\n$('#editmodelname').change(function(){\n  var val = $(this).val();\n  ME.DATA.model.name = val;\n  if (ME.DATA.cb) ME.DATA.cb(ME.DATA.model, true);\n});\n\n$('#editmodelthumbnail').change(function(){\n  var val = $(this).val();\n  ME.DATA.model.thumbnail = val;\n  updateImages();\n  if (ME.DATA.cb) ME.DATA.cb(ME.DATA.model, true);\n});\n\n$('#editmodelbackground').change(function(){\n  var val = $(this).val();\n  ME.DATA.model.background = val;\n  updateImages();\n  if (ME.DATA.cb) ME.DATA.cb(ME.DATA.model, true);\n});\n\n$('#editmodeloverlay').change(function(){\n  var val = $(this).val();\n  ME.DATA.model.overlay = val;\n  updateImages();\n  if (ME.DATA.cb) ME.DATA.cb(ME.DATA.model, true);\n});\n\nfunction rebuildPoses(){\n  var newhtml = '';\n  for (var i in me.poses){\n    var p = me.poses[i];\n    newhtml += '<span class=\"mdl-chip mdl-chip--deletable clickme\" data-index=\"'+i+'\"><span class=\"mdl-chip__text\">'+p.name+'<\/span><button type=\"button\" class=\"mdl-chip__action\"><i class=\"material-icons\">cancel<\/i><\/button><\/span>';\n    if (!p.id) p.id = guid();\n  }\n  if (newhtml != '') newhtml += '<br><br>';\n  var el = $(ME).find('.poselistgoeshere');\n  el.html(newhtml);\n  el.find('.mdl-chip__text').click(function(){\n    var i = $(this).parent().data('index');\n    var p = me.poses[i];\n    setPose(p);\n  });;\n  el.find('.mdl-chip__action').click(function(){\n    var i = $(this).parent().data('index');\n    var data = {\n      title:\"Delete Pose\",\n      text:\"Are you sure you want to delete this pose?\",\n      cb:function(){\n        me.poses.splice(i,1);\n        savePoses();\n        rebuildPoses();\n      }\n    }\n    installControl('#popmeup2', 'metabot', 'confirmdialog', function(result){}, data);\n  });;\n  componentHandler.upgradeAllRegistered();\n  \n  var el = $(ME).find('.animationlistgoeshere');\n  var data = {\n    \"poses\": me.poses,\n    \"animations\": me.animations,\n    \"cb\": function(data){\n      saveAnimations();\n    }\n  };\n  installControl(el[0], 'threejs', 'animationlist', function(result){}, data);\n}\n\nfunction savePoses(){\n  ME.DATA.cb(ME.DATA.model, true);\n}\n\nfunction saveAnimations(){\n  ME.DATA.cb(ME.DATA.model, true);\n}\n\nfunction setPose(pose){\n  var rig = me.viewer.modelapi.rig;\n  for (var i in pose.pose){\n    rig[i] = pose.pose[i];\n  }\n  var gui = me.viewer.datGUI;\n  for (var i = 0; i < gui.__folders.Model.__controllers.length; i++) {\n    var c = gui.__folders.Model.__controllers[i];\n    var name = c.property;\n    c.setValue(rig[name]);\n  }\n                                                     \n  if (rig.campos){\n    var cam = me.viewer.scene.camera;\n    var con = me.viewer.controls;\n    cam.position.set(rig.campos.x, rig.campos.y, rig.campos.z);\n    con.target.set(rig.camrot.x, rig.camrot.y, rig.camrot.z);\n    cam.scale.set(rig.camscale.x, rig.camscale.y, rig.camscale.z);\n    con.update();\n  }\n}\n\n\n$(ME).find('.newposebutton').click(function(){\n  \n  function cb(val){\n    var rig = me.viewer.modelapi.rig;\n    rig = Object.assign({}, rig);\n    var cam = me.viewer.scene.camera;\n    var con = me.viewer.controls;\n    rig.campos = {};\n    rig.campos.x = cam.position.x;\n    rig.campos.y = cam.position.y;\n    rig.campos.z = cam.position.z;\n    rig.camrot = {};\n    rig.camrot.x = con.target.x;\n    rig.camrot.y = con.target.y;\n    rig.camrot.z = con.target.z;\n    rig.camscale = {};\n    rig.camscale.x = cam.scale.x;\n    rig.camscale.y = cam.scale.y;\n    rig.camscale.z = cam.scale.z;\n    \n    var pose = {\n      \"name\": val,\n      \"id\": guid(),\n      \"pose\": rig\n    };\n    \n    me.poses.push(pose);\n    rebuildPoses();\n    savePoses();\n  }\n  \n  var data = {\n    \"title\": \"New Pose\",\n    \"text\": \"Enter a name for the new pose\",\n    \"subtext\": \"\",\n    \"cb\": cb\n  };\n  \n  installControl('#popmeup2', 'metabot', 'promptdialog', null, data);\n});\n\n\n\n\n\n\n\n","groups":"anonymous","ctl":"mpqxjo166b75d8761z1a05","html":"<h3>Edit Model<\/h3>\n<div class = \"mdl-tabs mdl-js-tabs\">\n  <div class = \"mdl-tabs__tab-bar\">\n    <a href = \"#tab1-panel\" class = \"mdl-tabs__tab is-active\">Info<\/a>\n    <a href = \"#tab2-panel\" class = \"mdl-tabs__tab\">Assets<\/a>\n    <a href = \"#tab3-panel\" class = \"mdl-tabs__tab\">Pose<\/a>\n    <a href = \"#tab4-panel\" class = \"mdl-tabs__tab\">Animate<\/a>\n  <\/div>\n\n  <div class = \"mdl-tabs__panel is-active\" id = \"tab1-panel\">\n    <br>\n    <form action=\"#\">\n      <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n        <input class=\"mdl-textfield__input\" type=\"text\" id=\"editmodelname\">\n        <label class=\"mdl-textfield__label\" for=\"editmodelname\">Model Name<\/label>\n      <\/div>\n    <\/form>\n    <form action=\"#\">\n      <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n        <input class=\"mdl-textfield__input\" type=\"text\" id=\"editmodelthumbnail\">\n        <label class=\"mdl-textfield__label\" for=\"editmodelthumbnail\">Thumbnail URL<\/label>\n      <\/div>\n    <\/form>\n    <button class=\"mdl-button mdl-js-button mdl-button--icon selectassetbutton choosethumbbutton\">\n      <i class=\"material-icons\">list<\/i>\n    <\/button>  \n    <form action=\"#\">\n      <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n        <input class=\"mdl-textfield__input\" type=\"text\" id=\"editmodelbackground\">\n        <label class=\"mdl-textfield__label\" for=\"editmodelbackground\">Background Image<\/label>\n      <\/div>\n    <\/form>\n    <button class=\"mdl-button mdl-js-button mdl-button--icon selectassetbutton choosebackgroundbutton\">\n      <i class=\"material-icons\">list<\/i>\n    <\/button>  \n    <form action=\"#\">\n      <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n        <input class=\"mdl-textfield__input\" type=\"text\" id=\"editmodeloverlay\">\n        <label class=\"mdl-textfield__label\" for=\"editmodeloverlay\">Overlay Image<\/label>\n      <\/div>\n    <\/form>\n    <button class=\"mdl-button mdl-js-button mdl-button--icon selectassetbutton chooseoverlaybutton\">\n      <i class=\"material-icons\">list<\/i>\n    <\/button>  \n    Overlay Opacity:\n    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n    <input type=\"range\" min=\"0\" max=\"100\" value=\"50\" class=\"slider\" id=\"opslider\">\n  <\/div>\n  <div class = \"mdl-tabs__panel\" id = \"tab2-panel\">\n    <h4>JSON model files<\/h4>\n    <div class='assetlistgoeshere'><\/div>\n  <\/div>\n\n  <div class = \"mdl-tabs__panel\" id = \"tab3-panel\">\n    <h4>Pose Model<\/h4>\n    <div class='poselistgoeshere'><\/div>\n    <button class=\"newposebutton mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored\">\n      <i class=\"material-icons\">add<\/i>\n    <\/button>\n  <\/div>\n\n  <div class = \"mdl-tabs__panel\" id = \"tab4-panel\">\n    <h4>Animations<\/h4>\n    <div class='animationlistgoeshere'><\/div>\n  <\/div>\n<\/div>\n\n\n\n\n\n\n\n<br><br><br>\n<div id='popmeup2'><\/div>\n<div class='popmeup'>\n  <div class=\"mdl-card__title\">\n    <h2 class=\"mdl-card__title-text\">Select an Asset<\/h2>\n  <\/div>\n  <div class=\"mdl-card__title mdl-card--expand\">\n    <div class='assetpicker'><\/div>\n  <\/div>\n  <div class=\"mdl-card__actions mdl-card--border\">\n    <a class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect chooseassetbutton\" onclick=\"$(this).closest('.popmeup').parent()[0].api.selectThumb();\">\n      select\n    <\/a>\n  <\/div>\n  <div class=\"mdl-card__menu\">\n    <button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect closeme\" onclick=\"$(this).closest('.popmeup')[0].api.closeAndReset();\">\n      <i class=\"material-icons\">close<\/i>\n    <\/button>\n  <\/div>\n<\/div>\n\n\n<button class=\"mdl-button mdl-js-button mdl-button--icon closeeditmodelbutton\">\n  <i class=\"material-icons\">close<\/i>\n<\/button>","db":"threejs","desc":""},"readers":["anonymous"],"id":"mpqxjo166b75d8761z1a05","sessionid":"jvgvwg16b7a4d277bt3","time":1623514864305,"addr":"/0:0:0:0:0:0:0:1:53112","username":"admin"}