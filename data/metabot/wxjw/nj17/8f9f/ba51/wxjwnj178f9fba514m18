{"data":{"css":"","data":[],"name":"commandselect","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar cbs = [];\n\nvar l = ME.DATA.label ? ME.DATA.label : 'Select a Command';\nvar a = ME.DATA.allownone ? true : false;\n\nvar cdb = null;\nvar cid = null;\nvar cmd = null;\n\nme.ready = function(){\n  var val = ME.DATA.value;\n  if (val){\n    var sa = val.split(\":\");\n    cdb = sa[0];\n    cid = sa[1];\n    cmd = sa[2];\n  }\n\n  var ctl = ME.DATA.ctl;\n  if (ctl) me.setControl(ctl);\n  else {\n    var args = {\n      value: cdb ? cdb+\":\"+cid : null,\n      allownone:a,\n      ready:function(api){\n        me.setControl(api.value());\n      },\n      cb:me.setControl\n    };\n    installControl($(ME).find('.cmdsellibwrap')[0], 'metabot', 'controlselect', function(api){\n      me.ctlsel = api;\n    }, args);\n  }\n  if (ME.DATA.cb) me.change(ME.DATA.cb);\n};\n\nme.setControl = function(ctl){\n  me.lib = cdb = me.ctlsel.lib;\n  me.ctl = cid = ctl;\n  var ccb = function(val){\n    cmd = val;\n    for (var i in cbs) cbs[i](val, cmd);\n  };\n  json('../botmanager/read', 'db='+cdb+'&id='+cid, function(result){\n    var cmdlist = me.cmdlist = result.data ? result.data.cmd : [];\n    var data = {\n      value:cmd,\n      label: l,\n      list: cmdlist,\n      allownone:a,\n      ready:function(api){\n        if (ME.DATA.ready) ME.DATA.ready(me);\n        ccb(api.value());\n      },\n      cb:ccb\n    };\n\n    installControl($(ME).find('.cmdselwrap')[0], 'metabot', 'select', function(api){}, data);\n  });\n};\n\nme.change = function(cb){\n  cbs.push(cb);\n};\n  \nme.value = function(){\n  return $(ME).find('.cmdselwrap').find('select').val();\n};\n  \nme.command = function(){\n  var val = $(ME).find('.cmdselwrap').find('select').val();\n  val = getByProperty(me.cmdlist, 'id', val);\n  return val;\n};\n  \nme.name = function(){\n  return me.command().name;\n};\n","groups":"","ctl":"wxjwnj178f9fba514m18","html":"<div class='cmdsellibwrap'><\/div>\n<div class='cmdselwrap'><\/div>","three":{"controls":[]},"db":"metabot","desc":""},"id":"wxjwnj178f9fba514m18","sessionid":"jvgvwg16b7a4d277bt3","time":1619531371142,"addr":"/0:0:0:0:0:0:0:1:39000","username":"admin"}