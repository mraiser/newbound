{"data":{"css":".ctllistwrap::-webkit-scrollbar {\n    width: 4px;\n}\n \n.ctllistwrap::-webkit-scrollbar-track {\n    -webkit-box-shadow: inset 0 0 6px rgba(255,255,255,0.3);\n}\n \n.ctllistwrap::-webkit-scrollbar-thumb {\n  background-color: darkgrey;\n  outline: 1px solid slategrey;\n}\n\n.fullwidth {\n  position:absolute;\n  top:0px;\n  left:340px;\n  right:0px;\n  height:100%;\n  background-color:black;\n}\n\n.dg.ac {\n  display:none;\n  top:100px;\n}\n\n.ctllistwrap{\n  color:#fff8;\n  width:300px;\n  height:100%;\n  position:absolute;\n  top:0px;\n  left:0px;\n  overflow-y:scroll;\n  padding-left:20px;\n  padding-right:20px;\n}\n\n.mdl-tabs__tab {\n  color: #fff8;\n  font-size:x-small;\n}\n\n.mdl-tabs.is-upgraded .mdl-tabs__tab.is-active {\n  color: #fff;\n}\n\n.mdl-list__item{\n  color:#fff8;\n  width:100%;\n}\n\n.mdl-list__item--two-line .mdl-list__item-primary-content .mdl-list__item-sub-title{\n  color:#fff8;\n  width:100%;\n  overflow:hidden;\n  font-size:xx-small;\n}\n\n.editctl, .delctl{\n  cursor:pointer;\n}\n\n.edit3dhere{\n  position:absolute;\n  top:20px;\n  left:365px;\n  display:none;\n  vertical-align:top;\n}\n\n.edit3dhere .mdl-textfield{\n  vertical-align:bottom;\n}\n\n.edit3dhere .mdl-textfield__label, .edit3dhere .mdl-textfield__input, .edit3dhere table{\n  color:#fff8;\n}\n\n.poselistgoeshere, .animationlistgoeshere {\n  padding: 20px;\n}\n","data":[],"name":"edit3d","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(api){\n  componentHandler.upgradeAllRegistered();\n\n  var el = $(ME).find('.matrixviewer');\n  el.data('orbitcontrols', true);\n  el.data('showdatgui', true);\n  \n  function addModel(el, ctl, cb){\n    me.viewer.add(el[0], ctl.db, ctl.id, function(model){\n      cb();\n    }, ctl);\n  }\n  \n  function addAsset(el, a, cb){\n    var assets = [ a.db+\":\"+a.id];\n    me.viewer.loadModel(el[0], assets, null, a.db, a.pos, a.rot, a.scale, function(model){\n//    me.viewer.loadModel(el[0], null, assets, null, a.db, a.pos, a.rot, a.scale, null, function(model){\n      cb();\n    }, a);\n  }\n  \n  installControl(el[0], 'threejs', 'viewer', function(api){\n    me.viewer = api;\n    api.waitReady(function(){\n      var scene = me.viewer.scene;\n      var camera = scene.camera;\n      camera.position.set(0,0,-10);\n      camera.position.x = 0;\n      camera.position.y = 0;\n      camera.position.z = 10;    \n      camera.lookAt(scene.position);\n      me.data = ME.DATA;\n      if (!me.data) me.data = {};\n      if (!me.data.three) me.data.three = { \"controls\": [] };\n      if (!me.data.three.assets) me.data.three.assets = [];\n      \n      \n      \n      \n      var l = me.queue = me.data.three.controls.slice();\n      var l2 = me.queue2 = me.data.three.assets.slice();\n      var popnext = me.popnext = function(){\n        if (l.length>0){\n          var ctl = l.shift();\n          if (!ctl.uuid) ctl.uuid = guid();\n          var el = $('<div id=\"'+ctl.uuid+'\"/>');\n          console.log(JSON.stringify(ctl));\n          $(ME).append(el);\n          addModel(el, ctl, popnext);\n        }\n        else if (l2.length>0){\n          var asset = l2.shift();\n          if (!asset.uuid) asset.uuid = guid();\n          var el = $('<div id=\"'+asset.uuid+'\"/>');\n          console.log(JSON.stringify(asset));\n          $(ME).append(el);\n          addAsset(el, asset, popnext);\n        }\n        else start();\n      };\n      popnext();\n    });\n  }, {});\n};\n\nfunction dirty(){\n  $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored');\n}\n\nfunction start(){\n  startctl();\n  startasset();\n  rebuildPoses();\n}\n\nfunction startctl(){\n  startlist('ctl', me.data.three.controls);\n}\n\nfunction startasset(){\n  startlist('asset', me.data.three.assets);\n}\n\nfunction rebuildPoses(){\n  var newhtml = '';\n  \n  me.poses = me.data.three.poses = me.data.three.poses ? me.data.three.poses : [];\n  me.animations = me.data.three.animations = me.data.three.animations ? me.data.three.animations : [];\n  \n  for (var i in me.poses){\n    var p = me.poses[i];\n    newhtml += '<span class=\"mdl-chip mdl-chip--deletable clickme\" data-index=\"'+i+'\"><span class=\"mdl-chip__text\">'+p.name+'<\/span><button type=\"button\" class=\"mdl-chip__action\"><i class=\"material-icons\">cancel<\/i><\/button><\/span>';\n    if (!p.id) p.id = guid();\n  }\n  if (newhtml != '') newhtml += '<br><br>';\n  var el = $(ME).find('.poselistgoeshere');\n  el.html(newhtml);\n  el.find('.mdl-chip__text').click(function(){\n    var i = $(this).parent().data('index');\n    var p = me.poses[i];\n    setPose(p);\n  });;\n  el.find('.mdl-chip__action').click(function(){\n    var i = $(this).parent().data('index');\n    var data = {\n      title:\"Delete Pose\",\n      text:\"Are you sure you want to delete this pose?\",\n      cb:function(){\n        me.poses.splice(i,1);\n        savePoses();\n        rebuildPoses();\n      }\n    }\n    installControl('#popmeup2', 'metabot', 'confirmdialog', function(result){}, data);\n  });;\n  componentHandler.upgradeAllRegistered();\n  \n  var el = $(ME).find('.animationlistgoeshere');\n  var data = {\n    \"poses\": me.poses,\n    \"animations\": me.animations,\n    \"cb\": function(data){\n      saveAnimations();\n    }\n  };\n  installControl(el[0], 'threejs', 'animationlist', function(result){}, data);\n}\n\nfunction startlist(type, list){\n  var newhtml = '<ul class=\"demo-list-'+type+' mdl-list\">';\n  for (var i in list){\n    var ctl = list[i];\n    var name = ctl.name ? ctl.name : ctl.id;\n    newhtml += '<li class=\"mdl-list__item mdl-list__item--two-line\" data-index=\"'+i+'\" id=\"li_'+ctl.uuid+'\"><span class=\"mdl-list__item-primary-content editctl\"><span class=\"namespan\">'+name+'<\/span><span class=\"mdl-list__item-sub-title\">'+ctl.db+':'+ctl.id+'<\/span><\/span><a class=\"mdl-list__item-secondary-action delctl\" href=\"#\"><i class=\"material-icons\">delete<\/i><\/a><\/li>';\n  }\n  newhtml += '<\/ul>';\n  var el = $(ME).find('.'+type+'list');\n  el.html(newhtml);\n  el.find('.delctl').click(function(){\n    var i = $(this).closest('li').data('index');\n    var d = list.splice(i,1);\n    start();\n    var m1 = $('#'+d[0].uuid)[0].api;\n    me.viewer.removeModel(m1);\n  });\n  el.find('.editctl').click(function(){\n    var i = $(this).closest('li').data('index');\n    var d = list[i];\n    var m1 = $('#'+d.uuid)[0].api;\n\n    me.edit3d = d;\n    $('#edit3dctlname').val(d.name).parent()[0].MaterialTextfield.checkDirty();\n\n    d.pos = d.pos ? d.pos : {\"x\":0,\"y\":0,\"z\":0};\n    d.rot = d.rot ? d.rot : {\"x\":0,\"y\":0,\"z\":0};\n    d.scale = d.scale ? d.scale : {\"x\":1,\"y\":1,\"z\":1};\n    \n    var vpos = {\n      \"value\": d.pos,\n      \"cb\":function(val){\n        m1.rig.pos_x = val.x;\n        m1.rig.pos_y = val.y;\n        m1.rig.pos_z = val.z;\n        dirty();\n      }\n    };\n    var vrot = {\n      \"value\": d.rot,\n      \"cb\":function(val){\n        m1.rig.rot_x = val.x;\n        m1.rig.rot_y = val.y;\n        m1.rig.rot_z = val.z;\n        dirty();\n      }\n    };\n    var vscale = {\n      \"value\": d.scale,\n      \"cb\":function(val){\n        m1.rig.scale_x = val.x;\n        m1.rig.scale_y = val.y;\n        m1.rig.scale_z = val.z;\n        dirty();\n      }\n    };\n    installControl('#edit3dctlpos', 'threejs', 'vector3', function(api){}, vpos);\n    installControl('#edit3dctlrot', 'threejs', 'vector3', function(api){}, vrot);\n    installControl('#edit3dctlscale', 'threejs', 'vector3', function(api){}, vscale);\n\n    $('#edit3dctlinner').empty();\n    $('.edit3dhere').css('display', 'block');\n    if (m1.api && m1.api.edit) {\n      m1.api.edit('#edit3dctlinner', function(val){\n        dirty();\n      });\n    }\n  });\n}\n\n$('#add3dassetbutton').click(function(){\n  var api = $('#new3dasset')[0].api;\n  var lib = api.lib;\n  var asset = api.value();\n\n  var d = {\n    \"name\":asset,\n    \"id\":asset,\n    \"db\":lib\n  };\n  console.log(d);\n  me.queue2.push(d);\n  me.popnext();\n  me.data.three.assets.push(d);\n  start();\n});\n\n$('#add3dctlbutton').click(function(){\n  var api = $('#new3dctl')[0].api;\n  var lib = api.lib;\n  var ctl = api.value();\n  var name = api.name();\n\n  var d = {\n    \"name\":name,\n    \"id\":ctl,\n    \"db\":lib\n  };\n  me.queue.push(d);\n  me.popnext();\n  me.data.three.controls.push(d);\n  start();\n});\n\n$('#edit3dctlname').change(function(){\n  var el = $('#li_'+me.edit3d.uuid);\n  me.edit3d.name = $(this).val();\n  el.find('.namespan').text(me.edit3d.name);\n  dirty();\n});\n\n$(ME).find('.3dtab').click(function(){\n  if ($(this).hasClass(\"posetab\")){\n    $('.dg.ac').css('display', 'block');\n    $('.dg.main.a').css('width', '300px');\n  }\n  else{\n    $('.dg.ac').css('display', 'none');\n  }\n});\n\n$(ME).find('.newposebutton').click(function(){\n  \n  function cb(val){\n    var rig = me.viewer.modelapi.rig;\n    rig = Object.assign({}, rig);\n    var cam = me.viewer.scene.camera;\n    var con = me.viewer.controls;\n    rig.campos = {};\n    rig.campos.x = cam.position.x;\n    rig.campos.y = cam.position.y;\n    rig.campos.z = cam.position.z;\n    rig.camrot = {};\n    rig.camrot.x = con.target.x;\n    rig.camrot.y = con.target.y;\n    rig.camrot.z = con.target.z;\n    rig.camscale = {};\n    rig.camscale.x = cam.scale.x;\n    rig.camscale.y = cam.scale.y;\n    rig.camscale.z = cam.scale.z;\n    \n    var pose = {\n      \"name\": val,\n      \"id\": guid(),\n      \"pose\": rig\n    };\n    \n    me.poses.push(pose);\n    rebuildPoses();\n    savePoses();\n  }\n  \n  var data = {\n    \"title\": \"New Pose\",\n    \"text\": \"Enter a name for the new pose\",\n    \"subtext\": \"\",\n    \"cb\": cb\n  };\n  \n  installControl('#popmeup2', 'metabot', 'promptdialog', null, data);\n});\n\n","groups":"anonymous","ctl":"qtmtmq1682e957160gd9b3","html":"<div class='fullwidth matrixviewer'><\/div>\n<div class='ctllistwrap'>\n  <div class = \"mdl-tabs mdl-js-tabs\">\n    <div class = \"mdl-tabs__tab-bar\">\n      <a href = \"#tab1-panel\" class = \"3dtab mdl-tabs__tab is-active\">Controls<\/a>\n      <a href = \"#tab2-panel\" class = \"3dtab mdl-tabs__tab\">Assets<\/a>\n      <a href = \"#tab3-panel\" class = \"3dtab mdl-tabs__tab\">Behaviors<\/a>\n      <a href = \"#tab4-panel\" class = \"3dtab posetab mdl-tabs__tab\">Poses<\/a>\n    <\/div>\n    <div class = \"mdl-tabs__panel is-active\" id = \"tab1-panel\">\n      <div class='ctllist'><\/div>\n      <div id='new3dctl' class='data-control' data-control='metabot:controlselect'><\/div>\n      <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored\" id=\"add3dctlbutton\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>  \n    <\/div>\n    <div class = \"mdl-tabs__panel\" id = \"tab2-panel\">\n      <div class='assetlist'><\/div>\n      <div id='new3dasset' class='data-control' data-control='metabot:assetselect'><\/div>\n      <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored\" id=\"add3dassetbutton\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>\n    <\/div>\n    <div class = \"mdl-tabs__panel\" id = \"tab3-panel\">\n      <h3>[Behaviors]<\/h3>\n    <\/div>\n    <div class = \"mdl-tabs__panel\" id = \"tab4-panel\">\n      <div class='poselistgoeshere'><br><\/div>\n      <button class=\"newposebutton mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>\n      <h4>Pose Animations<\/h4>\n      <div class='animationlistgoeshere'><\/div>\n    <\/div>\n  <\/div>\n<\/div>\n\n<div class='edit3dhere'>\n  <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n    <input class=\"mdl-textfield__input\" type=\"text\" id=\"edit3dctlname\">\n    <label class=\"mdl-textfield__label\" for=\"edit3dctlname\">Name<\/label>\n  <\/div>\n  <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-dirty\">\n    <div id='edit3dctlpos'><\/div>\n    <label class=\"mdl-textfield__label\" for=\"edit3dctlpos\">Position<\/label>\n  <\/div>\n  <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-dirty\">\n    <div class='data-control' data-control='threejs:vector3' id='edit3dctlrot'><\/div>\n    <label class=\"mdl-textfield__label\" for=\"edit3dctlrot\">Rotation<\/label>\n  <\/div>\n  <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label is-dirty\">\n    <div class='data-control' data-control='threejs:vector3' id='edit3dctlscale'><\/div>\n    <label class=\"mdl-textfield__label\" for=\"edit3dctlscale\">Scale<\/label>\n  <\/div>\n  <div id='edit3dctlinner'><\/div>\n<\/div>\n\n<div id='popmeup2'><\/div>\n","three":{"controls":[],"assets":[]},"db":"metabot","desc":""},"readers":["anonymous"],"id":"qtmtmq1682e957160gd9b3","sessionid":"jvgvwg16b7a4d277bt3","time":1624024267693,"addr":"/0:0:0:0:0:0:0:1:59138","username":"admin"}