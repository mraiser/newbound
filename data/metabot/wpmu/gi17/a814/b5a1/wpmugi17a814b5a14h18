{"data":{"css":".newparam {\n  display:none;\n}\n\n.newparamaddbutton{\n  font-size:10px;\n  width:auto;\n  height:auto;\n  padding:5px;\n}\n\n.noborder{\n  border:none;\n}\n\n.dontaddmethodparam{\n  padding-top:3px;\n  padding-bottom:4px;\n  position:relative;\n  top:-1px;\n}\n\n.mpdelete {\n  vertical-align:middle;\n  cursor:pointer;\n  color:#7c7f86;\n}\n\n.behaviorflow{\n  position:relative;\n}","data":[],"name":"editbehavior","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(api){\n  componentHandler.upgradeAllRegistered();\n  \n  me.cmddata = ME.DATA;\n  \n  var el = $(ME).find('.behaviorname');\n  el.val(ME.DATA.name);\n  el.change(updateBehaviorName);\n  el.keyup(updateBehaviorName);\n  \n  buildParams();\n  \n  if (ME.DATA.lang != 'flow'){\n    var cmtheme = typeof CODEMIRRORTHEME != 'undefined' ? CODEMIRRORTHEME : 'abcdef';\n    var c = $(ME).find('.behaviorcode')[0];\n    $(c).val(ME.DATA.body);\n    var conf = {\n      mode : \"javascript\",\n      theme: cmtheme,\n      lineWrapping: true,\n      autofocus : false,\n      viewportMargin: Infinity\n    };\n    c.cm = CodeMirror.fromTextArea(c, conf);\n    c.cm.on('change', function(x){\n      ME.DATA.body = c.cm.getValue();\n      me.parent.dirty();\n    });\n  }\n  else{\n    $(ME).find('.behaviorcode').css('display', 'none');\n\n    var el = $(ME).find(\".behaviorflow\");\n    el.height($(ME).closest('.navtab').height() - 100);\n    el.width($(ME).parent().find('.matrixviewer').width() - 40);\n    \n    var d = ME.DATA.flow ? ME.DATA.flow : {\"cons\":[], \"cmds\":[], \"input\":{}, \"output\":{}};\n    installControl(el[0], \"flow\", \"editor\", function(api){\n      me.floweditor = api;\n      api.parent = me;\n\n      me.dirty = function(){\n        me.parent.dirty();\n        setTimeout(function(){ ME.DATA.flow = api.getData(); }, 500);\n      }\n    }, d);\n  }\n  \n  $(ME).find('.addmethodparam').click(function(){\n    $(this).css('display', 'none');\n    $(ME).find('.newparam').css('display', 'inline-block');\n  });\n\n  $(ME).find('.dontaddmethodparam').click(function(){\n    $(ME).find('.addmethodparam').css('display', 'inline-block');\n    $(ME).find('.newparam').css('display', 'none');\n  });\n  \n  $(ME).find('.newparamaddbutton').click(function(){\n    var p = { \n      \"name\": $(ME).find('.newparamname').val().trim(),\n      \"type\": \"object\"\n    };\n\n    if (p.name.length<1) alert(\"Please give the new parameter a valid name\");\n    else if (getByProperty(me.cmddata.params, 'name', p.name)) alert('There is already a parameter with that name.');\n    else {\n      me.cmddata.params.push(p);\n      $(ME).find('.addmethodparam').css('display', 'inline-block');\n      $(ME).find('.newparam').css('display', 'none');\n      buildParams();\n      me.parent.dirty();\n      me.parent.rebuildBehaviors();\n    }\n  });\n};\n\nfunction updateBehaviorName(){\n  ME.DATA.name = $(ME).find('.behaviorname').val();\n  me.parent.dirty();\n  me.parent.rebuildBehaviors();\n}\n\nfunction buildParams(){\n  if (!me.cmddata.params) me.cmddata.params = [];\n  var list = me.cmddata.params;\n  var params = '';\n  var b = false;\n  for (var i in list){\n    var rdpi = list[i];\n    if (b) params += ', ';\n    params += '<i class=\"mdc-list-item__graphic material-icons mpdelete\" aria-hidden=\"true\" data-index=\"'+i+'\">delete<\/i>';\n    params += rdpi.name;\n  }\n  $(ME).find('.methodparams').html(params);\n  $(ME).find('.mpdelete').click(function(){\n    var i = $(this).data('index');\n    me.cmddata.params.splice(i,1);\n    buildParams();\n    me.parent.dirty();\n    me.parent.rebuildBehaviors();\n  });\n}\n","groups":"","ctl":"wpmugi17a814b5a14h18","html":"me.<input type='text' class='behaviorname'> = function(\n<span class='methodparams'><\/span>\n<button class='bggray noborder addmethodparam'>+<\/button>\n<input type='text' class='newparamname newparam'>\n<div class=\"mdc-icon-toggle material-icons bggray newparam newparamaddbutton\">done<\/div>\n<button class='bggray noborder newparam dontaddmethodparam'>x<\/button>){\n<textarea class='behaviorcode'><\/textarea>\n<div class='behaviorflow'><\/div>\n};","three":{"controls":[],"assets":[],"behaviors":[],"animations":[],"poses":[]},"db":"metabot","desc":""},"id":"wpmugi17a814b5a14h18","sessionid":"jvgvwg16b7a4d277bt3","time":1626116188133,"addr":"/0:0:0:0:0:0:0:1:38258","username":"admin"}