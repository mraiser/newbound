{"data":{"css":"","data":[],"name":"assetlist","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  componentHandler.upgradeAllRegistered();\n  \n  me.storedb = ME.DATA.storedb;\n  me.storeid = ME.DATA.storeid;\n  \n  var data = {\n    allownone:ME.DATA.allownone,\n    allowadd:ME.DATA.allowadd,\n    lib:ME.DATA.lib,\n    cb:function(val){\n//      alert(val);\n    },\n    ready:function(api){\n//      alert(api.value());\n    }\n  };\n  installControl($(ME).find('.assetselect')[0], 'metabot', 'assetselect', function(api){\n   me.picker = api;\n  }, data);\n  \n  if (me.storedb){\n    json('../botmanager/read', 'db='+me.storedb+'&id='+me.storeid, function(result){\n      me.list = result.data ? result.data.list : [];\n      rebuild();\n    });\n  }\n  else{\n    me.list = ME.DATA.list ? ME.DATA.list : [];\n    rebuild();\n  }\n};\n\nfunction rebuild(){\n  var list = me.list;\n  var newhtml = '<ul class=\"demo-list-icon mdl-list\">';\n  for (var i in list){\n    newhtml += '<li class=\"mdl-list__item\"><span class=\"mdl-list__item-primary-content\"><i class=\"deleteasset material-icons mdl-list__item-icon\" data-index=\"'+i+'\" >delete<\/i>'+list[i]+'<\/span><\/li>';\n  }\n  newhtml += '<\/ul>';\n  $(ME).find('.assetlist').html(newhtml).find('.deleteasset').click(function(){\n    me.list.splice($(this).data('index'),1);\n    save();\n  });\n  componentHandler.upgradeAllRegistered();\n}\n\n$(ME).find('.addassetbutton').click(function(){\n  var lib = me.picker.lib;\n  var ass = me.picker.value();\n  me.list.push(lib+':'+ass);\n  save();\n});\n\nfunction save(){\n  if (me.storedb){\n    var data = { list: me.list };\n    json('../botmanager/write', 'db='+me.storedb+'&id='+me.storeid+'&data='+encodeURIComponent(JSON.stringify(data)), function(result){ \n      rebuild();\n    });  \n  }\n  else rebuild();\n  if (ME.DATA.cb) ME.DATA.cb(me.list);\n}\n\n$(document).click(function(event) {\n   window.lastElementClicked = event.target;\n});\n","groups":"anonymous","ctl":"xmtpzj165f8115689u368","html":"<div class='assetlist'><\/div>\n<div class='assetselect'><\/div>\n<button class=\"addassetbutton mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored\">\n  <i class=\"material-icons\">add<\/i>\n<\/button>\n","db":"metabot","desc":""},"readers":["anonymous"],"id":"xmtpzj165f8115689u368","sessionid":"jvgvwg16b7a4d277bt3","time":1574954038181,"addr":"/0:0:0:0:0:0:0:1:49192","username":"admin"}