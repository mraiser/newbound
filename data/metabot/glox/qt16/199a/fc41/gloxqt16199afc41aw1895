{"data":{"css":".thin{\n  height:40px;\n}\n\n.thin2{\n  height:80px;\n}\n\n.greyedout{\n  position:fixed;\n  z-index:5;\n  top:0px;\n  left:0px;\n  width:100%;\n  height:100%;\n  background-color:#00000033;\n}\n\n.dbg{\n  position:fixed;\n  z-index:6;\n  top:0px;\n  left:0px;\n  width:0px;\n  height:0px;\n  overflow:hidden;\n}\n\n.dialog-card-wide{\n  margin-left:auto;\n  margin-right:auto;\n}\n\n.floatright{\n  float:right;\n}\n\n.bggreen{\n  background-color:#84bd00;\n}","data":[],"name":"uploaddialog","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nif (!ME.DATA.cb) ME.DATA.cb = function(val){\n  alert(val);\n};\n\nif (!ME.DATA.validate) ME.DATA.validate = function(val){\n  return val.length>0;\n};\n\nme.ready = function(){\n  componentHandler.upgradeAllRegistered();\n\n  if (ME.DATA.title) $(ME).find('.mdl-card__title-text').text(ME.DATA.title);\n  if (ME.DATA.text) $(ME).find('.subtext').text(ME.DATA.text);\n  if (ME.DATA.ok) $(ME).find('.continuebutton').text(ME.DATA.ok);\n  if (ME.DATA.cancel) $(ME).find('.cancelbutton').text(ME.DATA.cancel);\n  \n  var x1, y1;\n  \n  if (window.lastElementClicked) {\n    var o = $(window.lastElementClicked).offset();\n    x1 = o.left;\n    y1 = o.top;\n  }\n  else {\n    x1 = 0;\n    y1 = 0;\n  }\n  \n  var y2 = Math.max(112, ($(window).height()/2)-200);\n  \n  $(ME).find('.dbg').css('left', x1+'px').css('top', y1+'px').animate({top: y2+'px', left:'0px',width:'100%',height:'100%'},500);\n  $(ME).find('.cancelbutton').click(function(){\n    $(ME).find('.dbg').animate({top:y1+'px',left:x1+'px',width:'0px',height:'0px'},500);\n    $(ME).find('.greyedout').css('display', 'none');\n  });\n  $(ME).find('.continuebutton').click(function(){\n    \n    if (!ME.DATA.validate || ME.DATA.validate($(ME).find('#sample3').val())){\n      \n      var progress = $(ME).find('.mdl-progress');\n      progress.addClass('mdl-progress__indeterminate');\n      \n      var f = $(ME).find('#sample3')[0];\n      var n = f.files.length;\n      var i = 0;\n      \n      function popNext(){\n        var file = f.files[i++];\n        if (file) {\n          var name = ME.DATA.rename ? guid() : file.name;\n          var formData = new FormData();\n          formData.append(\"file\", file);\n          formData.append(\"name\", name);\n          formData.append(\"originalname\", file.name);\n\n          var xhr = new XMLHttpRequest();\n          xhr.open('POST', '../botmanager/asset?db='+encodeURIComponent(ME.DATA.lib), true);\n          xhr.onload = function (val) {\n            var response = JSON.parse(val.currentTarget.response);\n            console.log(\"RESPONSE: \"+val.currentTarget.response);\n            if (response.status != 'ok'){\n              alert('Unable to upload: '+response.msg);\n            }\n            else {\n              ME.DATA.cb(name);\n              $(ME).find('.dbg').animate({width:'0px',height:'0px'},500);\n              $(ME).find('.greyedout').css('display', 'none');\n              \n            }\n          };\n          \n          xhr.upload.addEventListener(\"progress\", function(e) {\n            progress.removeClass('mdl-progress__indeterminate');\n            var pc = e.loaded / e.total * 100;\n            progress[0].MaterialProgress.setProgress(pc);\n          }, false);    \n          \n          xhr.send(formData);\n        }\n      }\n      popNext();\n    }\n  });\n  \n  if (ME.DATA.validate) {\n    $(ME).on('change','#sample3' , validate);\n    validate();\n  }\n};\n\nfunction validate(){\n  var isok = ME.DATA.validate($(ME).find('#sample3').val());\n  if (isok) $(ME).find('.continuebutton').removeAttr('disabled').removeClass('mdl-button--disabled');\n  else $(ME).find('.continuebutton').attr(\"disabled\", \"disabled\").addClass('mdl-button--disabled');\n}\n\nvar upd = $(ME).find('.dialog-card-wide');\nvar pubg = upd;\n\nupd.on('dragover', function(e){\n  e.preventDefault();  \n  e.stopPropagation();\n  pubg.addClass('bggreen');\n});\nupd.on('dragenter', function(e){\n  e.preventDefault();  \n  e.stopPropagation();\n  pubg.addClass('bggreen');\n});\nupd.on('dragleave', function(e){\n  e.preventDefault();  \n  e.stopPropagation();\n  pubg.removeClass('bggreen');\n});\nupd.on('drop', function(e){\n  e.preventDefault();  \n  e.stopPropagation();\n  pubg.removeClass('bggreen');\n  $(ME).find('#sample3')[0].files = e.originalEvent.dataTransfer.files;\n  var isok = ME.DATA.validate(e.originalEvent.dataTransfer.files[0].name);\n  if (isok) {\n    ME.DATA.validate = null;\n    $(ME).find('.continuebutton').click();\n  }\n});\n","groups":"anonymous","ctl":"gloxqt16199afc41aw1895","html":"<div class='greyedout'><\/div>\n<div class='dbg'>\n  <div class=\"dialog-card-wide mdl-card mdl-shadow--2dp\">\n    <div class=\"mdl-card__title\">\n      <h2 class=\"mdl-card__title-text\">Upload File<\/h2>\n    <\/div>\n    <div class=\"mdl-card__supporting-text thin2\">\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n          <input class=\"mdl-textfield__input\" type=\"file\" id=\"sample3\">\n          <div id=\"p1\" class=\"mdl-progress mdl-js-progress\"><\/div>\n        <\/div>\n      <\/form>\n    <\/div>    \n    <div class=\"mdl-card__supporting-text thin subtext\">\n      Select a file or drag files here.\n    <\/div>\n    <div class=\"mdl-card__actions mdl-card--border\">\n      <a class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect floatright continuebutton\">\n        upload\n      <\/a>\n      <a class=\"mdl-button mdl-button--flat mdl-js-button mdl-js-ripple-effect cancelbutton\">\n        cancel\n      <\/a>\n    <\/div>\n  <\/div>\n<\/div>","db":"metabot","desc":""},"readers":["anonymous"],"id":"gloxqt16199afc41aw1895","sessionid":"jhtpuq15d03ce0a74q0","time":1543357163270,"addr":"/0:0:0:0:0:0:0:1:53801","username":"mraiser"}