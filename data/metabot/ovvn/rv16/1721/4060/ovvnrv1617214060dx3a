{"data":{"java":"//return ((com.newbound.robot.MetaBot)BotBase.getBot(\"metabot\")).apps();\n\nBotManager bm = (BotManager)botmanager;\nJSONObject apps = new JSONObject();\n\njava.io.File bpf = new java.io.File(bm.getRootDir(), \"botd.properties\");\njava.util.Properties bp = bm.loadProperties(bpf);\nJSONArray installed = new JSONArray(bp.getProperty(\"bots\").split(\",\"));\ninstalled.put(\"com.newbound.robot.BotManager\");\napps.put(\"installed\", installed);\n\nJSONArray ja = new JSONArray();\n\nJSONObject identity = null;\ntry { identity = bm.getData(\"runtime\", \"metaidentity\").getJSONObject(\"data\"); } catch (Exception x) {\n  identity = new JSONObject();\n  identity.put(\"displayname\", \"Sum Dev\");\n  identity.put(\"organization\", \"\");\n  identity.put(\"uuid\", bm.getLocalID());\n  try { bm.newDB(\"runtime\", null, null); } catch (Exception xx) {}\n  bm.setData(\"runtime\", \"metaidentity\", identity, null, null);\n}\n\njava.io.File root = bm.getRootDir().getParentFile();\nString[] sa = root.list();\nint i = sa.length;\nwhile (i-->0)\n{\n  String id = sa[i];\n  \n  java.io.File f = new java.io.File(root, id);\n  if (f.isDirectory())\n  {\n    f = new java.io.File(f, \"app.properties\");\n    if (f.exists()) try\n    {\n  System.out.println(id);\n      \n      java.util.Properties p = bm.loadProperties(f);\n      JSONObject jo = new JSONObject();\n      jo.put(\"id\", id);\n      jo.put(\"service\", id);\n      \n      JSONArray libs;\n      String s = p.getProperty(\"libraries\");\n      if (s != null) libs = new JSONArray(s.split(\",\")); \n      else libs = new JSONArray();\n      jo.put(\"libraries\", libs);\n      \n      s = p.getProperty(\"ctldb\");\n      if (s != null)\n      {\n        JSONObject ctl = new JSONObject();\n        ctl.put(\"db\", s);\n        ctl.put(\"id\", p.getProperty(\"ctlid\"));\n        jo.put(\"control\", ctl);\n      }\n      \n      String name = p.getProperty(\"name\");\n      if (name == null) name = id;\n      jo.put(\"name\", name);\n      \n      s = p.getProperty(\"desc\");\n      if (s == null) s = \"The \"+name+\" application\";\n      jo.put(\"desc\", s);\n      \n      s = p.getProperty(\"index\");\n      if (s == null) s = \"index.html\";\n      jo.put(\"index\", s);\n\n      s = p.getProperty(\"price\");\n      if (s == null) s = \"0\";\n      jo.put(\"price\", Double.parseDouble(s));\n\n      s = p.getProperty(\"forsale\");\n      if (s == null) s = \"true\";\n      jo.put(\"forsale\", Boolean.parseBoolean(s));\n\n      s = p.getProperty(\"img\");\n      if (s == null) s = \"/metabot/img/icon-square-app-builder.png\";\n      jo.put(\"img\", s);\n\n      s = p.getProperty(\"botclass\");\n      if (s == null) s = \"com.newbound.robot.published.\"+bm.lettersAndNumbersOnly(name);\n      jo.put(\"class\", s);\n      jo.put(\"active\", id.equals(\"botmanager\") || bp.getProperty(\"bots\").indexOf(s) != -1);\n\n      s = p.getProperty(\"version\");\n      if (s == null) s = \"0\";\n      jo.put(\"version\", s);\n      \n      s = p.getProperty(\"vendor\");\n      if (s == null) s = bm.getLocalID();\n      jo.put(\"vendor\", s);\n      \n      s = p.getProperty(\"vendorversion\");\n      if (s == null) s = \"0\";\n      jo.put(\"vendorversion\", s);\n            \n      s = p.getProperty(\"author\");\n      if (s == null) \n      {\n        s = bm.getLocalID();\n        jo.put(\"authorname\", identity.getString(\"displayname\"));\n        jo.put(\"authororg\", identity.getString(\"organization\"));\n      }\n      jo.put(\"author\", s);\n      \n      s = p.getProperty(\"authorname\");\n      if (s != null) jo.put(\"authorname\", s);\n      \n      s = p.getProperty(\"authororg\");\n      if (s != null) jo.put(\"authororg\", s);\n      \n      s = p.getProperty(\"hash\");\n      if (s != null) jo.put(\"hash\", s);\n      \n      s = p.getProperty(\"signature\");\n      if (s != null) jo.put(\"signature\", s);\n      \n      s = p.getProperty(\"key\");\n      if (s != null) jo.put(\"key\", s);\n      \n      JSONArray gen;\n      s = p.getProperty(\"generate\");\n      if (s != null) gen = new JSONArray(s.split(\",\")); \n      else gen = new JSONArray();\n      jo.put(\"generate\", gen);\n      \n      jo.put(\"published\", p.getProperty(\"key\") != null);\n      \n      ja.put(jo);\n    }  \n    catch (Exception x) { x.printStackTrace(); }\n  }\n}\n\napps.put(\"list\", ja);\nreturn apps;","import":"import java.io.*;\nimport java.util.*;\nimport org.json.*;\nimport java.net.*;\nimport com.newbound.robot.*;\nimport com.newbound.robot.published.*;\n","returntype":"JSONObject","groups":"anonymous","params":[{"name":"botmanager","type":"Bot"}],"desc":"List the apps installed on this device"},"readers":["anonymous"],"id":"ovvnrv1617214060dx3a","sessionid":"jhtpuq15d03ce0a74q0","time":1541266683422,"addr":"/0:0:0:0:0:0:0:1:53472","username":"mraiser"}