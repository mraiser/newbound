{"id": "ismhyw1617188944fuda1", "data": {"css": ".hidden{\n  display:none;\n}\n\n.pubindent{\n  margin:50px;\n  max-width:100%;\n}\n\n.center{\n  text-align:center;\n}\n\n.butpad {\n  padding:10px;\n  font-size:large;\n  text-transform: uppercase;\n}\n\n#pa_msg{\n  padding-bottom:20px;\n}\n\n.publishappwrapx{\n  width:100%;\n}\n\n.xwide{\n  width:100%;\n}\n\n.pubform {\n  display:flex;\n  flex-wrap:wrap;\n  justify-content:center;\n}\n\n.pubform > form{\n  width:600px;\n  max-width:67vw;\n  margin-left:20px;\n  margin-right:20px;\n}\n\n#deletethiscontrol{\n  float:right;\n}", "data": [], "name": "publishapp", "js": "var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar data = ME.DATA; //$(ME).data('control');\n  console.log(data);\n$('#publishappname').text('Publish '+data.name);\nvar hold = data.ctl;\n    \nme.ready = function(){    \n//  componentHandler.upgradeAllRegistered();\n  send_appdata(data, function(result){\n    console.log(result);\n  //  installControl('#publishappfieldset', 'taskbot', 'fieldset', function(result){}, result.data);\n    var d = me.properties = result.data;\n    d.ctlid = data.ctl;\n\n    if (!d.desc || d.desc == '') d.desc = $('#ov_desc').val();\n    else if (!d.subtitle || d.subtitle == '') d.subtitle = $('#ov_desc').val();\n\n    $('#publishappname').text('Publish '+d.name+' ('+d.ctlid+')');\n    $('#pa_name').val(d.name)[0].oval = d.name;\n    $('#pa_libraries').val(d.libraries);\n    $('#pa_index').val(d.index);\n    $('#pa_img').val(d.img);\n    $('#pa_class').val(d.botclass);  \n    $('#pa_desc').val(d.desc);  \n    $('#pa_video').val(d.video);  \n    $('#pa_detail').val(d.detail);  \n    $('#pa_subtitle').val(d.subtitle);  \n    $('#pa_forsale').prop('checked', d.forsale == 'true');  \n\n    if (d.generate)\n    {\n      $('#pa_genhtml').prop('checked', d.generate.indexOf(\"html\") != -1);\n      $('#pa_genjava').prop('checked', d.generate.indexOf(\"java\") != -1);\n    }\n\n    componentHandler.upgradeAllRegistered();\n  });\n\n  me.deleteControl = function(ctldb, ctlid){\n    json('../botmanager/read', 'db='+ctldb+'&id=controls', function(result){\n      var list = result.data.list;\n      var i = list.indexOf(getByProperty(list, \"id\", ctlid));\n      list.splice(i,1);\n      json('../botmanager/write', 'db='+ctldb+'&id=controls&data='+encodeURIComponent(JSON.stringify(result.data)), function(result){\n        json('../botmanager/delete', 'db='+encodeURIComponent(ctldb)+'&id='+encodeURIComponent(ctlid), function(result){\n          $('.menubuttonback').click();\n        });\n      });\n    });\n  };\n};\n\n$('#deletethiscontrol').click(function(){\n  if (confirm(\"Are you really sure you want to permanently delete this control?\")) $('.publish')[0].api.deleteControl(me.properties.ctldb, me.properties.ctlid);\n});\n\n$('#pa_publishtheappnow').click(function(){\n  $('#pa_msg').html('<i>Saving app properties...</i>');\n  var d = updateProps();\n  send_save(d, function(result){\n    if (result.status != 'ok') $('#pa_msg').html('<font color=\"red\">ERROR: '+result.msg+'</font>');\n    else {\n      $('#pa_msg').html('Checking status of libraries...');\n      send_status(d.libraries, function(result){\n        function whenDone(){\n          $('#pa_msg').html('Publishing app '+d.name);\n          send_publishapp(d.id, function(result){\n            if (result.status != 'ok') $('#pa_msg').html('<font color=\"red\">ERROR: '+result.msg+'</font>');\n            else {\n              $('#pa_msg').html('The app has been published. You may need to restart services to see changes.');\n              setTimeout(\"$('#pa_msg').html('');\", 5000);\n            }\n          });\n        }\n        \n        function popNext(){\n          if (result.data.libraries.length == 0) whenDone();\n          else {\n            var rdl = result.data.libraries.pop();\n            if (rdl.dirty){\n              $('#pa_msg').html('Publishing library: '+rdl.id);\n              send_publishlib(rdl.id, function(result){\n                if (result.status != 'ok') $('#pa_msg').html('<font color=\"red\">ERROR: '+result.msg+'</font>');\n                else {\n                  $('#pa_msg').html('Library '+rdl.id+' has been published');\n                  popNext();\n                }\n              });\n            }\n            else popNext();\n          }\n        }\n        \n        popNext();\n      });\n    }\n  });\n});\n\nfunction updateProps(){\n  var d = me.properties;\n  d.name = $('#pa_name').val();\n  d.libraries = $('#pa_libraries').val();\n  d.index = $('#pa_index').val();\n  d.img = $('#pa_img').val();\n  d.botclass = $('#pa_class').val();\n  d.desc = $('#pa_desc').val();\n  d.video = $('#pa_video').val();\n  d.detail = $('#pa_detail').val();\n  d.subtitle = $('#pa_subtitle').val();\n  d.forsale = $('#pa_forsale').prop('checked') ? 'true' : 'false';\n  \n  var a = $('#pa_genhtml').prop('checked');\n  var b = $('#pa_genjava').prop('checked');\n  \n  d.generate = a && b ? 'html,java' : a ? 'html' : b ? 'java' : '';\n  \n  return d;\n}\n\n$('#pa_saveprops').click(function(){\n  var d = updateProps();\n  send_save(d, function(result){\n    if (result.status == 'ok') $('#pa_msg').html('Your app has been saved.');\n    else $('#pa_msg').html('<font color=\"red\">ERROR: '+result.msg+'</font>');\n    setTimeout(\"$('#pa_msg').html('');\", 5000);\n  });\n});  \n\nfunction updateNames(){\n  var oval = this.oval;\n  console.log(oval);\n  var v = this.oval = $(this).val();\n  \n  $('#publishappname').text('Publish '+v);\n  if ($('#pa_desc').val() == 'The '+oval+' application') $('#pa_desc').val('The '+v+' application');\n  if ($('#pa_class').val() == 'com.newbound.robot.published.'+oval) $('#pa_class').val('com.newbound.robot.published.'+v);\n}\n\n$('#pa_name').change(updateNames);\n$('#pa_name').keyup(updateNames);\n", "groups": "", "html": "<div class='pubindent'>\n  <div class=\"publishappwrapx mdl-card mdl-shadow--2dp\">\n    <div class=\"mdl-card__title\">\n      <h2 class=\"mdl-card__title-text\" id=\"publishappname\"></h2>\n    </div>\n    <div class=\"mdl-card__supporting-text pubform\">\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_name\">\n          <label class=\"mdl-textfield__label\" for=\"pa_name\">Name</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_class\">\n          <label class=\"mdl-textfield__label\" for=\"pa_class\">Class</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_index\">\n          <label class=\"mdl-textfield__label\" for=\"pa_index\">Index File</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_libraries\">\n          <label class=\"mdl-textfield__label\" for=\"pa_libraries\">Libraries</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_subtitle\">\n          <label class=\"mdl-textfield__label\" for=\"pa_subtitle\">Subtitle</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_desc\">\n          <label class=\"mdl-textfield__label\" for=\"pa_desc\">Description</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_img\">\n          <label class=\"mdl-textfield__label\" for=\"pa_img\">Icon</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_video\">\n          <label class=\"mdl-textfield__label\" for=\"pa_video\">Video (embed html)</label>\n        </div>\n      </form>\n      <form action=\"#\">\n        <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label xwide\">\n          <input class=\"mdl-textfield__input\" type=\"text\" id=\"pa_detail\">\n          <label class=\"mdl-textfield__label\" for=\"pa_detail\">Detail (LIB:CTL:DATA)</label>\n        </div>\n      </form>\n      <form action=\"#\">      \n        <label class=\"mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect\" for=\"pa_forsale\">\n          <input type=\"checkbox\" id=\"pa_forsale\" class=\"mdl-checkbox__input\">\n          <span class=\"mdl-checkbox__label\">Make Public</span>\n        </label>\n      </form>      \n    </div>\n    <div id='pa_msg' class='mdl-card__supporting-text'></div>\n    <div class=\"mdl-card__actions mdl-card--border\">\n      <a class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect\" id=\"pa_publishtheappnow\">\n        publish\n      </a>\n      <a class=\"mdl-button mdl-js-button mdl-js-ripple-effect\" id=\"deletethiscontrol\">\n        delete this control\n      </a>\n    </div>\n  </div>  \n  \n  \n  \n  \n  \n  <div class='hidden'>\n    <label>Generate HTML<input type='checkbox' id='pa_genhtml'></label>\n    <label>Generate Java<input type='checkbox' id='pa_genjava'></label>\n  </div>\n  <br>\n</div>", "ctl": "ismhyw1617188944fuda1", "cmd": [{"java": "hxhohr161719787c8xde6", "name": "appdata", "id": "xjgptu161719787cbgde7"}, {"java": "ttzzty16171c3e58fnb6", "name": "publishapp", "id": "ntszti16171c3e592pb7"}, {"java": "nuotwo16171c53f53zc0", "name": "publishlib", "id": "igyxpg16171c53f55vc1"}, {"java": "msqgom16171c6b68arca", "name": "save", "id": "kzrptq16171c6b68dxcb"}, {"java": "pnrjpt16171c8342dud4", "name": "status", "id": "otnnno16171c83430ld5"}], "three": {"controls": []}, "db": "metabot", "desc": ""}, "username": "xxx", "sessionid": "rvswlk16a182b19bbl0", "addr": "/127.0.0.1:54928", "time": 1555183666372}