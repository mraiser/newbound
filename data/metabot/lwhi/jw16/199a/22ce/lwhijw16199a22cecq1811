{"data":{"css":".mdl-button--fab.mdl-button--colored{\n  background-color:#83bc00;\n}\n\n.mdl-button--fab.mdl-button--colored:hover{\n  background-color:#b7ef49;\n}\n\n.installareax{\n  position:absolute;\n  top:160px;\n  left:290px;\n  right:100px;\n  z-index:100;\n}\n\n.appupdatebutton{\n  color:#83bc00;\n  position:absolute;\n  top:-20px;\n  right:0px;\n  display:none;\n}\n\n.mdl-card__actions{\n  position:relative;\n}\n\n.app-card-square > .mdl-card__actions {\n  height: 52px;\n  padding: 16px;\n  background: #7c7f8688;\n}\n\n.app-card-image__filename {\n  color: #fff;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.app-card-square.mdl-card {\n  width: 200px;\n  height: 200px;\n  background: url('../metabot/img/icon-square-app-builder.png') center / cover;\n  float: left;\n  margin: 1rem;\n  position: relative;\n}\n\n.app-card-square.mdl-card:hover {\n  box-shadow: 0 8px 10px 1px rgba(0, 0, 0, .14), 0 3px 14px 2px rgba(0, 0, 0, .12), 0 5px 5px -3px rgba(0, 0, 0, .2);\n}\n\n.app-card-square{\n  background: #7c7f8688;\n}\n\n.appbutton{\n  display:none;\n}\n\n.restartarea{\n  display:none;\n}\n\n.mdl-button--accent.mdl-button--accent.mdl-button--raised{\n  color:white;\n}\n\n.appinfo-meta{\n  margin-top:50px;\n  margin-left:50px;\n}\n\n.appinfo-close{\n  color:white;\n}\n\n.flex{\n  display:flex;\n  flex-wrap: wrap;\n  width:100%;\n}\n\n.greyout{\n  position:fixed;\n  z-index:50;\n  top:0px;\n  left:0px;\n  width:100%;\n  height:100%;\n  background-color:#00000033;\n  display:none;\n}\n\n.app-detail{\n  display:none;\n  position:fixed;\n  width:0px;\n  height:0px;\n  z-index:51;\n}\n\n.appinfo-header{\n  background-color:#7c7f86;\n  color:white;\n}\n\n.appinfo-img{\n  width:200px;\n  height:200px;\n  margin-left:50px;\n  margin-top:50px;\n  display:inline-block;\n}\n\n.appinfo-api{\n  margin:50px;\n}","data":[],"name":"appcard","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  \n//  componentHandler.upgradeElement($(ME).find('.peerselect')[0]);\n  \n//  var elid = guid();\n//  $(ME).find('.peerselect')[0].id = elid;\n  \n//  getmdlSelect.init(\"#\"+elid);\n  \n  var app = me.app = ME.DATA.data;\n  var title = app.name+' v'+app.version+(app.remote ? ' (available)' : !app.installed ? ' (inactive)' : '');\n  var src = app.installed ||  !app.peers || !app.peers[0] ? app.img : '../peerbot/remote/'+app.peers[0].id+app.img;\n  \n  $(ME).find('.app-card-square.mdl-card').css('background', 'url(\"'+src+'\") center / cover');\n  $(ME).find('.app-card-image__filename').html(title);\n  $(ME).find('.appinfo-title').html(title);\n  $(ME).find('.appinfo-ctlid').html(app.id);\n  $(ME).find('.appinfo-author').html(app.authorname+' ('+app.author+')');\n  $(ME).find('.appinfo-desc').html(app.desc);\n\n  $(ME).find('.appinfo-img').prop('src', src);\n  \n  if (app.remote) $(ME).find('.app-card-square > .mdl-card__actions').css('background-color', '#84bd0088');\n  else if (!app.installed) $(ME).find('.app-card-square > .mdl-card__actions').css('background-color', '#00000088');\n\n  if (!app.remote) {\n    installControl($(ME).find('.appinfo-api')[0], 'botmanager', 'api', function(result){}, {appid:app.id});\n  }\n  \n  $(ME).find('.app-card-square').click(function(){\n    \n    var list = [];\n    for (var i in app.peers) {\n      var p = app.peers[i];\n      var a = getByProperty(p.apps.list, 'id', app.id);\n      var o = { id:p.id, name: 'v'+a.version+' - '+p.name+' ('+p.id+')'};\n      list.push(o);\n    }\n    if (!app.local || (app.local && Number(app.version) < Number(app.available))) \n      installControl($(ME).find('.injectselect')[0], 'metabot', 'select', function(){}, { label:'Download from peer', list: list });\n    \n    $(ME).find('.app-install-button').css('display', !app.local ? 'inline-block' : 'none');\n    $(ME).find('.app-run-button').css('display', app.installed ? 'inline-block' : 'none');\n    $(ME).find('.app-deactivate-button').css('display', app.installed ? 'inline-block' : 'none');\n    $(ME).find('.app-edit-button').css('display', app.local ? 'inline-block' : 'none');\n    $(ME).find('.app-activate-button').css('display', app.local && !app.installed ? 'inline-block' : 'none');\n    $(ME).find('.app-uninstall-button').css('display', app.local && !app.installed ? 'inline-block' : 'none');\n    $(ME).find('.app-update-button').css('display', app.local && Number(app.version) < Number(app.available) ? 'inline-block' : 'none');\n    \n    var x = $('body').width()-100;\n    var y = $('body').height()-210;\n    var w = $(ME).width();\n    var h = $(ME).height();\n    var x2 = $(ME).offset().left;\n    var y2 = $(ME).offset().top;\n    $(ME).find('.greyout').css('display', 'block');\n    $(ME).find('.app-detail').css('top', y2+'px').css('left', x2+'px').css('width', w+'px').css('height', h+'px').css('display', 'block').animate({top:\"160px\", width:x+\"px\", height:y+\"px\", left:\"50px\"}, 500);;\n    \n    $(ME).find('.appinfo-close').click(function(){\n      var x = $(ME).offset().left;\n      var y = $(ME).offset().top;\n      var w = $(ME).width();\n      var h = $(ME).height();\n      $(ME).find('.app-detail').animate({top:y+\"px\", width:w+\"px\", height:h+\"px\", left:x+\"px\"}, 500, function(){\n        $(this).css('display', 'none');\n        $(ME).find('.greyout').css('display', 'none');\n      });;\n    });\n    \n  });\n\n  $(ME).find('.app-run-button').click(function(){ window.location.href='../'+app.id+'/'+app.index; });\n  $(ME).find('.app-edit-button').click(function(){ window.location.href='../metabot/editcontrol.html?db='+app.control.db+'&id='+app.control.id; });\n  \n  $(ME).find('.app-deactivate-button').click(function(){ \n    json('../metabot/deactivate', 'classname='+encodeURIComponent(app.class), function(result){\n      $(ME).find('.restartarea').css('display', 'block');\n    });\n  });  \n  \n  $(ME).find('.app-activate-button').click(function(){ \n    json('../metabot/activate', 'classname='+encodeURIComponent(app.class), function(result){\n      $(ME).find('.restartarea').css('display', 'block');\n    });\n  });  \n  \n  $(ME).find('.app-uninstall-button').click(function(){ \n    json('../metabot/uninstall', 'appid='+encodeURIComponent(app.id), function(result){\n      window.location.href = window.location.href;\n    });\n  });  \n  \n  $(ME).find('.app-update-button').click(function(){ \n    var sel = $(ME).find('.mdl-selectfield__select');\n    app.selectedpeer = document.body.peers[sel.val()];\n    $(ME).find('.mdl-selectfield__select').change(function(){\n      app.selectedpeer = document.body.peers[sel.val()];\n    });\n    \n    $('.appactions').css('display', 'none');\n    \n    app.cb = function(){\n      $(ME).find('.app-update-button').css('display', 'none');\n      $(ME).find('.restartarea').css('display', 'block');\n      $(ME).find('.injectselect').html('');\n    };\n    \n    installControl($(ME).find('.installarea')[0], 'metabot', 'installapp', function(api){}, app);\n  });\n  \n  $(ME).find('.app-install-button').click(function(){ \n    app.selectedpeer = document.body.peers[$(ME).find('.mdl-selectfield__select').val()];\n    $(ME).find('.mdl-selectfield__select').change(function(){\n      app.selectedpeer = document.body.peers[sel.val()];\n    });\n    \n    \n    $('.appactions').css('display', 'none');\n    \n    app.cb = function(){\n      $(ME).find('.app-install-button').css('display', 'none');\n//      $(ME).find('.restartarea').css('display', 'block');\n      $(ME).find('.injectselect').html('');\n      $(ME).find('.app-activate-button').click();\n    };\n    \n    installControl($(ME).find('.installarea')[0], 'metabot', 'installapp', function(api){}, app);\n  });\n  \n};\n\n$(window).resize(function(){\n  var x = $('body').width()-100;\n  var y = $('body').height()-210;\n\n  $(ME).find('.app-detail').css('width', x+'px').css('height', y+'px');\n});","groups":"","ctl":"lwhijw16199a22cecq1811","html":"<div class=\"mdl-card mdl-shadow--2dp app-card-square\">\n  <div class=\"mdl-card__title mdl-card--expand\"><\/div>\n  <div class=\"mdl-card__actions\">\n    <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab mdl-button--colored appupdatebutton\">\n      <i class=\"material-icons\">get_app<\/i>\n    <\/button>\n    <span class=\"app-card-image__filename\"><\/span>\n  <\/div>\n<\/div>\n\n<div class='greyout'><\/div>\n\n<div class=\"mdl-card mdl-shadow--4dp app-detail\">\n  <div class=\"mdl-layout mdl-js-layout mdl-layout--fixed-header\">\n    <header class=\"mdl-layout__header appinfo-header\">\n      <div class=\"mdl-layout__header-row\">\n        <span class=\"mdl-layout-title appinfo-title\"><\/span>\n        <div class=\"mdl-layout-spacer\"><\/div>\n        <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab appinfo-close\">\n          <i class=\"material-icons\">close<\/i>\n        <\/button>\n      <\/div>\n    <\/header>\n    \n    <div class='flex'>\n      <img class='appinfo-img'>\n      \n      <div class='appinfo-meta'>\n        App ID: <span class='appinfo-ctlid'><\/span><br>\n        Author: <span class='appinfo-author'><\/span><br>\n        <br>\n        \n        <div class='injectselect'><\/div>\n        \n        <div class='installarea'><\/div>\n        <div class=\"appactions\">\n<button class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--colored app-update-button appbutton\">Update<\/button>\n<button class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--colored app-install-button appbutton\">Install<\/button>\n<button class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--colored app-run-button appbutton\">Run<\/button>\n<button class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--accent app-edit-button appbutton\">Edit<\/button>        \n<button class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--accent app-activate-button appbutton\">activate<\/button>        \n<button class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--accent app-deactivate-button appbutton\">deactivate<\/button>        \n<button class=\"mdl-button mdl-js-button mdl-button--raised mdl-button--accent app-uninstall-button appbutton\">uninstall<\/button>        \n        <\/div>\n        <div class='restartarea'>\n          <br>\n          You will need to restart services to see the changes.\n          <div class='data-control' data-control='metabot:restartbutton'><\/div>\n        <\/div>      \n        <br><br>\n        <span class='appinfo-desc'><\/span>\n      <\/div>\n  \n      <div class='appinfo-api'><\/div>\n    <\/div>\n  <\/div>\n<\/div>\n","three":{"controls":[]},"db":"metabot","desc":""},"id":"lwhijw16199a22cecq1811","sessionid":"jhtpuq15d03ce0a74q0","time":1551884856479,"addr":"/0:0:0:0:0:0:0:1:56322","username":"mraiser"}