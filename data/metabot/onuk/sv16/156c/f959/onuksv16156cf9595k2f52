{"data":{"timer":[],"css":".CodeMirror {\n  height:auto;\n}\n\n.menubuttonback, .pagetitle{\n  display:inline-block;\n  background-color: #282b30;\n  padding:10px;\n}\n\n.greentext{\n  color:#83bc00;\n  margin-bottom:-20px;\n}\n\n.mdc-fab__icon{\n  font-family: 'Material Icons';\n  font-weight: normal;\n  font-style: normal;\n  font-size: 24px;\n  line-height: 1;\n  letter-spacing: normal;\n  text-transform: none;\n}\n\n.dark{\n  color:black;\n}\n\n.three{\n  position:relative;\n  width:100%;\n  height:100%;\n  display:none;\n}\n\n.popupdialog-cmd-name-close, .popupdialog-timer-name-close, .popupdialog-event-name-close{\n  position:absolute;\n  top:10px;\n  right:10px;\n  cursor:pointer;\n  color:black;\n}\n\n.popupdialog-cmd-name, .popupdialog-timer-name, .popupdialog-event-name{\n  position:fixed;\n  top:200px;\n  left:50%;\n  width:400px;\n  margin-left:-200px;\n  display:none;\n  z-index:3;\n}\n  \n.savebutton{\n    position: fixed;\n    top: 10px;\n    right: 10px;\n    z-index:5;\n}\n\n.previewbutton{\n    position: absolute;\n    top: 10px;\n    right: 90px;\n    z-index:5;\n}\n\n.addcommandbutton, .addtimerbutton, .addeventbutton{\n  margin-top:-5px;\n  font-size: large;\n}\n\n.whitetext, .overview-textrow > p{\n  color:white;\n}\n\n.tablewhite{\n  background-color:white;\n  color:black;\n}\n\n.cmditem, .timeritem, .eventitem{\n  cursor:pointer;\n}\n\n.overview{\n  display:inline-block;\n  vertical-align:top;\n  margin-left:50px;\n  margin-top:50px;\n  background-color:white;\n  color:black;\n}\n\n.commandlist, .timerlist, .eventlist{\n  display:inline-block;\n  vertical-align:top;\n  margin-left:50px;\n  margin-top:50px;\n}\n\n#previewrow{\n  height:0px;\n}\n\n.html5{\n  width:100%;\n  height:100%;\n}\n\n.api, .publish, .info, .three{\n  display:none;\n  background-color:#282b30;\n  color:white;\n  width:100%;\n  height:100%;\n  overflow-y:auto;\n}\n\n.CodeMirror-scroll{\n  height:100%;\n}\n\n.grabby-v{\n  background-color:#505359;\n  color:white;\n  border-top:thin solid #7c7f86;\n  border-bottom:thin solid #282b30;\n  width:100%;  \n  height:20px;\n  position:relative;\n}\n\n.preview-title{\n  padding-left:20px;\n}\n\n.zoomer{\n  color:white;\n  position:absolute;\n  cursor:pointer;\n}\n\n.zoomer-min, .zoomer-pmin{\n  right:21px;\n  font-size:1.22em;\n  top:2px;\n}\n\n.zoomer-max, .zoomer-pmax{\n  top:0px;\n  right:0px;\n  font-size:1.4em;\n}\n\n.menubutton{\n  cursor:pointer;\n  color:white;\n}\n\n.editor{\n  width:100%;\n  height:100%;\n  background-color:#282b30;\n  color:white;\n  overflow:hidden;\n  position:relative;\n  padding:0px;\n}\n\n.editor-title{\n  position:absolute;\n  display:inline-block;\n  vertical-align:top;\n  font-family: \"Lato\", \"Lucida Grande\", \"Lucida Sans Unicode\", Tahoma, Sans-Serif;\n  font-weight: bold;\n  width:80px;\n}\n\n.editor-code{\n  position:absolute;\n  top:25px;\n  left:20px;\n  right:0px;\n  bottom:0px;\n}\n\n.editor-code-textarea{\n  width:100%;\n  height:100%;\n  background-color:#282b30;\n  color:white;\n  border:none;\n}\n\n.vbar, .grabbybar{\n  width:20px;\n  height:100%;\n  display:inline-block;\n  vertical-align:top;\n  background-color:#505359;\n  border-left:thin solid #7c7f86;\n  border-right:thin solid #282b30;\n}\n\n.grabbybar{\n  cursor: ew-resize;\n}\n\n.grabby-v{\n  cursor: ns-resize;\n}\n\n.darkbg{\n  vertical-align:top;\n  background-color: #282b30;\n  color:white;\n}\n\n.toolbar-theme-primary {\n  background-color: #282b30;\n  color: #fff;\n  height: 56px;\n  padding: 16px;\n  flex-direction: row;\n  align-items: center;\n  display: flex;\n  position: relative;\n  width: 100%;\n  box-sizing: border-box;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n  -webkit-box-pack: justify;\n  justify-content: space-between;\n}\n\n.toolbar-title {\n  padding-top:12px;\n}\n\n.navbutton{\n  position:relative;\n  width: 25%;\n  padding-top: 5px;\n  padding-bottom: 10px;\n  padding-left: 0px;\n  padding-right: 0px;\n  margin: 0px;\n  border:none;\n  cursor:pointer;\n  text-transform: uppercase;\n  font-size:14px;\n  background-color: #282b30;\n  border-bottom: 2px #505359 solid;\n  color: #7c7f86;\n  text-shadow: 0 0 0 #7c7f86;\n}\n\n.navbutton:hover{\n  color: white;\n  text-shadow: 0 0 0 white;\n}\n\n.navbutton.selected{\n  color: white;\n  background-color:#fff2;\n  text-shadow: 0 0 0 white;  \n  border-bottom: 2px #7c7f86 solid;\n}\n\niframe.width-changed {\n    width: 100%;\n    display: block;\n    border: 0;\n    height: 0;\n    margin: 0;\n}\n\n.bgwhite{\n  background-color:white;\n  color:black;\n}\n\n.bggray{\n  background-color:#7c7f86;\n  color:white;\n}\n\n.bgdark{\n  background-color:#282b30;\n  color:white;\n}\n\n.bggreen{\n  background-color:#84bd00;\n  color:white;\n}\n\n.popupdialog-cmd-name-inner, .popupdialog-timer-name-inner, .popupdialog-event-name-inner{\n  height:180px;\n  color:black;\n  background-color:white;\n}\n\n.grayout {\n  position:fixed;\n  top:0px;\n  left:0px;\n  width:100%;\n  height:100%;\n  background-color:#00000033;\n  display:none;\n  z-index:2;\n}\n\n.mdl-selectfield__select{\n  color:#aaa;\n}\n\n","data":[],"name":"editcontrol","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar db = 'blockchain';\nvar id = 'nmqppn1606ab8b19er5b8';\n\n$(ME).find('.menubuttonback').click(function(){ window.location.href='../metabot/index.html?db='+db; });\n\nvar cmtheme = typeof CODEMIRRORTHEME != 'undefined' ? CODEMIRRORTHEME : 'abcdef';\n\nme.ready = function(){\n  if (getQueryParameter('db') != 'null'){\n    db = getQueryParameter('db');\n    lookupID(db, getQueryParameter('id'), function(result){\n      id = result;\n      load();\n    });\n  }\n  else load();\n  \n  var t = getQueryParameter('tab');\n  if (t != 'null') $('#b_'+t).click();\n};\n\n$(ME).find('.savebutton').click(saveControl);\n$(ME).find('#save-overview-button').click(saveControl);\n$(ME).find('#ov_groups').keyup(function(){ $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); });\n$(ME).find('#ov_desc').keyup(function(){ $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); });\n\nfunction saveControl(){\n  var x = testData();\n  if (x != true) { \n    alert(x); \n    return; \n  }\n  \n  me.CTLDATA.html = $(ME).find('.html-textarea')[0].cm.getValue();\n  me.CTLDATA.css = $(ME).find('.css-textarea')[0].cm.getValue();\n  me.CTLDATA.js = $(ME).find('.js-textarea')[0].cm.getValue();\n  me.CTLDATA.attachmentkeynames = [ 'html', 'css', 'js' ];\n\n  var readers = $('#ov_groups').val().trim();\n  if (readers != '') readers = '&readers='+JSON.stringify(readers.split(','));\n\n  var dat = JSON.parse($(ME).find('.data-textarea')[0].cm.getValue());\n  var datas = [];\n  for (var i in dat){\n    var d = dat[i];\n    var o = getByProperty(me.CTLDATA.data, 'name', i);\n    \n    var did = o ? o.id : guid();\n    var args = 'id='+did+'&db='+db+'&data='+encodeURIComponent(JSON.stringify(d))+readers;\n    json('../botmanager/write', args, function result(){});\n    datas.push({\"name\":i,\"id\":did});\n  } \n  me.CTLDATA.data = datas;\n  \n  me.CTLDATA.groups = $('#ov_groups').val();\n  me.CTLDATA.desc = $('#ov_desc').val();\n\n  json('../botmanager/write', 'db='+encodeURIComponent(db)+'&id='+encodeURIComponent(id)+readers+'&data='+encodeURIComponent(JSON.stringify(me.CTLDATA)), function(result){\n    if (result.status == 'ok') {\n      $('.savebutton').removeClass('mdl-button--colored').addClass('mdl-button--accent');\n    }\n    else alert(result.msg);\n  });\n}\nme.saveControl = saveControl;\n\n\n$(ME).find('.addcommandbutton').click(function(){\n  var el = $(ME).find('.popupdialog-cmd-name');\n  $('.grayout').css('display', 'block');\n  el.css('width', '0px').css('height', '0px').css('margin-left', '0px').css('margin-top', '0px').css('border-radius', '40px').css('display', 'block').animate({'width':'400px', 'height':'240px', 'margin-left':'-200px', 'margin-top':'-90px', 'border-radius': '0px'},500,function(){});\n});\n\n$(ME).find('.addtimerbutton').click(function(){\n  var el = $(ME).find('.popupdialog-timer-name');\n  $('.grayout').css('display', 'block');\n  el.css('width', '0px').css('height', '0px').css('margin-left', '0px').css('margin-top', '0px').css('border-radius', '40px').css('display', 'block').animate({'width':'400px', 'height':'240px', 'margin-left':'-200px', 'margin-top':'-90px', 'border-radius': '0px'},500,function(){});\n});\n\n$(ME).find('.addeventbutton').click(function(){\n  var el = $(ME).find('.popupdialog-event-name');\n  $('.grayout').css('display', 'block');\n  el.css('width', '0px').css('height', '0px').css('margin-left', '0px').css('margin-top', '0px').css('border-radius', '40px').css('display', 'block').animate({'width':'400px', 'height':'240px', 'margin-left':'-200px', 'margin-top':'-90px', 'border-radius': '0px'},500,function(){});\n});\n\nfunction addTimer(){\n  if ($(ME).find('.addthetimer').hasClass('mdl-button--colored')){\n    var name = $('#newtimername').val();\n    if (name == '') error('You must name this timer task');\n    else if (getByProperty(me.CTLDATA.timer, 'name', name) != null) alert('There is already a timer task with that name');\n    else {\n  //    info('<i>Adding new timer task...<\/i>');\n      var data = {};\n      json('../botmanager/write', 'db='+db+'&data='+encodeURIComponent(JSON.stringify(data)), function(result){\n        if (result.status != 'ok') alert(result.msg);\n        else{\n          data.name = name;\n          data.id = result.id;\n          if (!me.CTLDATA.timer) me.CTLDATA.timer = [];\n          me.CTLDATA.timer.push(data);\n          saveControl();\n          me.buildTimerList();\n          $(ME).find('.popupdialog-timer-name-close').click();\n  //        editTimer(data.id, saveTimer);\n        }\n      });\n    }\n  }\n}\n$(ME).find('.addthetimer').click(addTimer);\n\nfunction addEvent(){\n  if ($(ME).find('.addtheevent').hasClass('mdl-button--colored')){\n    var name = $('#neweventname').val();\n    if (name == '') error('You must name this event task');\n    else if (getByProperty(me.CTLDATA.event, 'name', name) != null) alert('There is already a event task with that name');\n    else {\n  //    info('<i>Adding new event task...<\/i>');\n      var data = {};\n      json('../botmanager/write', 'db='+db+'&data='+encodeURIComponent(JSON.stringify(data)), function(result){\n        if (result.status != 'ok') alert(result.msg);\n        else{\n          data.name = name;\n          data.id = result.id;\n          if (!me.CTLDATA.event) me.CTLDATA.event = [];\n          me.CTLDATA.event.push(data);\n          saveControl();\n          me.buildEventList();\n          $(ME).find('.popupdialog-event-name-close').click();\n  //        editEvent(data.id, saveEvent);\n        }\n      });\n    }\n  }\n}\n$(ME).find('.addtheevent').click(addEvent);\n\n$(ME).find('.navbutton').click(function(){\n  $(ME).find('.navbutton').removeClass('selected');\n  $(this).addClass('selected').blur();\n  $(ME).find('.navtab').css('display', 'none');\n  $(ME).find('.'+this.id.substring(2)).css('display', 'block');\n  $(window).resize();\n\n  $('.dg.ac').css('display', 'none');\n});\n\nfunction load(){\n  json('../botmanager/read', 'db='+db+'&id='+id, function(result){\n      me.build(result);\n      installControl('.publish', 'metabot', 'publishapp', function(){\n//        componentHandler.upgradeAllRegistered();\n      }, me.CTLDATA);\n  });\n}\n\nfunction testData(){\n  try{\n    var dat = JSON.parse($(ME).find('.data-textarea')[0].cm.getValue());\n    \n    for (var i in dat){\n      var d = dat[i];\n      if (JSON.stringify(d).charAt(0) != '{') return \"Top level attribute \"+i+\" is not a JSON object. All top level attributes of Control Data must be JSON objects.\";\n    }\n    \n    \n    $(ME).find('.editor-data').find('.editor-title').css('color', 'white');\n    return true\n  }\n  catch (x) {\n    $(ME).find('.editor-data').find('.editor-title').css('color', 'red');\n    return \"Invalid JSON data\";\n  }\n}\n\nfunction buildData(){\n  var list = me.CTLDATA.data ? me.CTLDATA.data.slice() : [];\n  var dat = {};\n  \n  function popNext(){\n    if (list.length>0){\n      var d = list.shift();\n      json('../botmanager/read', 'db='+db+'&id='+d.id, function(result){\n        dat[d.name] = result.data;\n        popNext();\n      });\n    }\n    else{\n      dat = JSON.stringify(dat, null, 2);\n      $(ME).find('.data-textarea').val(dat);\n      \n      var conf = {\n        mode : \"javascript\",\n        theme: cmtheme,\n        lineWrapping: true,\n        autofocus : false,\n        viewportMargin: Infinity,\n        onChange: function (cm) { $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); testData(); }\n      };\n\n      var c = $(ME).find('.data-textarea')[0];\n      c.cm = CodeMirror.fromTextArea(c, conf);\n      c.cm.on('change', function (cm) { $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); testData(); });\n    }\n  }\n  popNext();\n}\n\nme.build = function(result){  \n  result.data.db = db;\n  result.data.ctl = id;\n  me.CTLDATA = result.data;\n//  $(ME).find('.currentcontrolid').text(id);\n  $(ME).find('.ctl-lib').text(db);\n  $(ME).find('.ctl-name').text(result.data.name);\n  $(ME).find('.html-textarea').val(result.data.html);\n  $(ME).find('.css-textarea').val(result.data.css);\n  $(ME).find('.js-textarea').val(result.data.js);\n  $(ME).find('#ov_groups').val(result.data.groups);\n  $(ME).find('#ov_desc').val(result.data.desc);\n  \n  buildData();\n  \n  var conf = {\n    mode : \"htmlmixed\",\n    theme: cmtheme,\n    lineWrapping: true,\n    autofocus : false,\n    viewportMargin: Infinity,\n    onChange: function (cm) { $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); }\n  };\n  var c = $(ME).find('.html-textarea')[0];\n  c.cm = CodeMirror.fromTextArea(c, conf);\n  c.cm.on('change', function (cm) { $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); testData(); });\n  \n  c = $(ME).find('.css-textarea')[0];\n  conf.mode='css';\n  c.cm = CodeMirror.fromTextArea(c, conf);\n  c.cm.on('change', function (cm) { $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); testData(); });\n  \n  c = $(ME).find('.js-textarea')[0];\n  conf.mode='javascript';\n  c.cm = CodeMirror.fromTextArea(c, conf);\n  c.cm.on('change', function (cm) { $('.savebutton').removeClass('mdl-button--accent').addClass('mdl-button--colored'); testData(); });\n  \n  var w = $(ME).width();\n  var num = 0;\n  if (result.data.html) { num++; $(ME).find('.editor-html').addClass('hasstuff'); }\n  if (result.data.css) { num++; $(ME).find('.editor-css').addClass('hasstuff'); }\n  if (result.data.js) { num++; $(ME).find('.editor-js').addClass('hasstuff'); }\n  if (result.data.data && result.data.data.length>0) { num++; $(ME).find('.editor-data').addClass('hasstuff'); }\n  \n  if (num>0) {\n    $('.editor').parent().width('20');\n    $('.hasstuff').parent().width(w/num);\n  }\n\n  me.buildCommandList();\n  me.buildTimerList();\n  me.buildEventList();\n  \n  $(\"#b_api\").click(function(e){\n//    var el = $(ME).find('.three-main');\n//    el.empty();\n  })\n  $(\"#b_three\").click(function(e){\n//    var el = $(ME).find('.three-main');\n//    el.empty();\n//    installControl(el[0], 'metabot', 'edit3d', function(api){ api.editor = me; }, me.CTLDATA);\n  });\n  \n  installControl($(ME).find('.three-main')[0], 'metabot', 'edit3d', function(api){ api.editor = me; }, me.CTLDATA);\n};\n\nme.buildEventList = function(){\n  var newhtml = '';\n  for (var i in me.CTLDATA.event){\n    var event = me.CTLDATA.event[i];\n    newhtml += '<tr data-eventid=\"'+event.id+'\" class=\"eventitem\"><td class=\"mdl-data-table__cell--non-numeric\">'+event.name+'<\/td><td class=\"mdl-data-table__cell--non-numeric\"><i class=\"mdc-list-item__graphic material-icons\" aria-hidden=\"true\">edit<\/i><\/td><\/tr>';\n  }\n  $('.eventlist-inner').html(newhtml);\n  $(ME).find('.eventitem').click(function(){\n    var cid = $(this).data('eventid');\n    var event = getByProperty(me.CTLDATA.event, 'id', cid);\n        \n    var data = { \"db\": db, \"ctl\": id, \"event\": event, \"name\": event.name, \"data\": me.CTLDATA, \"ctlapi\": me };\n    \n    $(ME).find('.api-main').css('display', 'none');\n    $(ME).find('.api-editevent').css('display', 'block');\n    installControl('.api-editevent', 'metabot', 'editevent', function(){}, data);\n  });\n};\n\nme.buildTimerList = function(){\n  var newhtml = '';\n  for (var i in me.CTLDATA.timer){\n    var timer = me.CTLDATA.timer[i];\n    newhtml += '<tr data-timerid=\"'+timer.id+'\" class=\"timeritem\"><td class=\"mdl-data-table__cell--non-numeric\">'+timer.name+'<\/td><td class=\"mdl-data-table__cell--non-numeric\"><i class=\"mdc-list-item__graphic material-icons\" aria-hidden=\"true\">edit<\/i><\/td><\/tr>';\n  }\n  $('.timerlist-inner').html(newhtml);\n  $(ME).find('.timeritem').click(function(){\n    var cid = $(this).data('timerid');\n    var timer = getByProperty(me.CTLDATA.timer, 'id', cid);\n        \n    var data = { \"db\": db, \"ctl\": id, \"timer\": timer, \"name\": timer.name, \"data\": me.CTLDATA, \"ctlapi\": me };\n    \n    $(ME).find('.api-main').css('display', 'none');\n    $(ME).find('.api-edittimer').css('display', 'block');\n    installControl('.api-edittimer', 'metabot', 'edittimer', function(){}, data);\n  });\n};\n\nme.buildCommandList = function(){\n  var newhtml = '';\n  for (var i in me.CTLDATA.cmd){\n    var cmd = me.CTLDATA.cmd[i];\n    newhtml += '<tr data-cmdid=\"'+cmd.id+'\" class=\"cmditem\"><td class=\"mdl-data-table__cell--non-numeric\">'+cmd.name+'<\/td><td class=\"mdl-data-table__cell--non-numeric\"><i class=\"mdc-list-item__graphic material-icons\" aria-hidden=\"true\">edit<\/i><\/td><\/tr>';\n  }\n  $('.commandlist-inner').html(newhtml);\n  $(ME).find('.cmditem').click(function(){\n    var cid = $(this).data('cmdid');\n    json('../botmanager/read', 'db='+encodeURIComponent(db)+'&id='+encodeURIComponent(cid), function(result){\n      var cmd = getByProperty(me.CTLDATA.cmd, 'id', cid);\n      if (result.data){\n        result.data.name = cmd.name;\n        cmd = result.data;\n        cmd.id = cid;\n      }\n      var data = { \"db\": db, \"ctl\": id, \"cmd\": cmd, \"name\": cmd.name, \"data\": me.CTLDATA, \"ctlapi\": me };\n\n      $(ME).find('.api-main').css('display', 'none');\n      $(ME).find('.api-editcommand').css('display', 'block');\n      installControl('.api-editcommand', 'metabot', 'editcommand', function(){}, data);\n    });\n  });\n};\n\n$(ME).find('.zoomer-pmin').click(function(){\n  $('#previewcol').html('');\n  var tr1 = $('#previewrow');\n  var tr2 = tr1.prev().prev();\n  var h1 = tr1.height();\n  var h2 = tr2.height();\n  tr1.css('height', '0px');\n  tr2.css('height', (h1+h2)+'px');\n});\n\n$(ME).find('.zoomer-pmax').click(function(){\n  var tr1 = $('#previewrow');\n  var tr2 = tr1.prev().prev();\n  var h1 = tr1.height();\n  var h2 = tr2.height();\n  tr2.css('height', '0px');\n  tr1.css('height', (h1+h2)+'px');\n  if (!$(\"#previewframe\")[0]) $('.previewbutton').click(); \n});\n\n$('.previewbutton').click(function(){\n  if ($('#previewrow').height() == 0) $('#previewrow').css('height', '50%');\n  $('#previewcol').html('<iframe src=\"../botmanager/shell.html\" style=\"border:none;width:100%;height:100%;\" id=\"previewframe\"><\/iframe>');\n  $(\"#previewframe\").contents().find(\"body\").html('');\n  buildPreview(db, id);\n});\n\nfunction buildPreview(DB, CTL, cb) {\n  $('#previewframe').prop('src', $('#previewframe').prop('src'));\n  setTimeout(function(){\n\t$('#previewframe')[0].contentWindow.installControl('body', DB, CTL, cb);\n\t$(window).resize();\n  }, 500);\n  \n}\n\n$('.zoomer-min').click(function(){\n  var td = $(this).closest('td');\n  var w = (td.parent().width() -20)/3;\n  $('.editor').parent().width(w);\n  td.css('width', '20px');\n});\n\n$('.zoomer-max').click(function(){\n  $('.editor').parent().width('20px');\n  var td = $(this).closest('td');\n  var w = td.parent().width() - 60;\n  td.css('width', w+'px');\n});\n\nvar elems = $('.grabbybar');\nelems.on('mousedown', function(e) {\n  var elem = this;\n  var td1 = $(elem).parent().parent();\n  var td2 = td1.prev();\n  var w1 = td1.width();\n  var w2 = td2.width();\n  \n  e = e || window.event;\n  var start = 0, diff = 0;\n  if( e.pageX) start = e.pageX;\n  else if( e.clientX) start = e.clientX;\n\n  elem.style.position = 'relative';\n  document.body.onmousemove = function(e) {\n      e = e || window.event;\n      var end = 0;\n      if( e.pageX) end = e.pageX;\n      else if( e.clientX) end = e.clientX;\n\n      diff = end-start;\n      td1.width((w1-diff)+\"px\");\n      td2.width((w2+diff)+\"px\");\n  };\n  document.body.onmouseup = function() {\n      elem.style.position = 'static';\n      document.body.onmousemove = document.body.onmouseup = null;\n  };\n});\n\nelems = $('.grabby-v');\nelems.on('mousedown', function(e) {\n  var elem = this;\n  var tr1 = $(elem).parent().parent();\n  var tr2 = tr1.prev();\n  tr1 = tr1.next();\n  var h1 = tr1.height();\n  var h2 = tr2.height();\n  \n  e = e || window.event;\n  var start = 0, diff = 0;\n  if( e.pageY) start = e.pageY;\n  else if( e.clientY) start = e.clientY;\n\n  elem.style.position = 'relative';\n  document.body.onmousemove = function(e) {\n      e = e || window.event;\n      var end = 0;\n      if( e.pageY) end = e.pageY;\n      else if( e.clientY) end = e.clientY;\n\n      diff = end-start;\n    \n      tr1.height((h1-diff)+\"px\");\n      tr2.height((h2+diff)+\"px\");\n    \n      if (!$(\"#previewframe\")[0]) $('.previewbutton').click(); \n    \n      var eds = $('.editor-code-textarea');\n      for (var i in eds) if (eds[i].cm) eds[i].cm.refresh();\n  };\n  document.body.onmouseup = function() {\n      // do something with the action here\n      // elem has been moved by diff pixels in the X axis\n      elem.style.position = 'relative';\n      document.body.onmousemove = document.body.onmouseup = null;\n  };\n});\n\n$.event.special.widthChanged = {\n        remove: function() {\n            $(this).children('iframe.width-changed').remove();\n        },\n        add: function () {\n            var elm = $(this);\n            var iframe = elm.children('iframe.width-changed');\n            if (!iframe.length) {\n                iframe = $('<iframe/>').addClass('width-changed').prependTo(this);\n            }\n            var oldWidth = elm.width();\n            function elmResized() {\n                var width = elm.width();\n                if (oldWidth != width) {\n                    elm.trigger('widthChanged', [width, oldWidth]);\n                    oldWidth = width;\n                }\n            }\n\n            var timer = 0;\n            var ielm = iframe[0];\n            (ielm.contentWindow || ielm).onresize = function() {\n                clearTimeout(timer);\n                timer = setTimeout(elmResized, 20);\n            };\n        }\n    }\n\n\n$('.editor').on('widthChanged',function(){\n  var w = $(this).width();\n  if (w<200){\n    $(this).find('.editor-code').css('display', 'none');\n    $(this).find('.zoomer').css('display', 'none');\n    $(this).find('.editor-title').css('transform', 'rotate(90deg)').css('top', '34px').css('left', '-29px');\n    $(this).parent().css('width', '20px');\n  }\n  else{\n    $(this).find('.editor-code').css('display', 'block');\n    $(this).find('.zoomer').css('display', 'block');\n    $(this).find('.editor-title').css('transform', 'rotate(0deg)').css('top', '0px').css('left', '20px');\n  }\n  \n  var eds = $('.editor-code-textarea');\n  for (var i in eds) if (eds[i].cm) eds[i].cm.refresh();\n});\n\nfunction closeAddTimerDialog(){\n  var el = $(ME).find('.popupdialog-timer-name');\n  el.animate({'width':'0px', 'height':'0px', 'margin-left':'0px', 'margin-top':'0px', 'border-radius': '40px'},500,function(){\n    el.css('display', 'none');\n  });\n  $('.grayout').css('display', 'none');\n}\n\n$(ME).find('.popupdialog-timer-name-close').click(closeAddTimerDialog);\n\nfunction closeAddEventDialog(){\n  var el = $(ME).find('.popupdialog-event-name');\n  el.animate({'width':'0px', 'height':'0px', 'margin-left':'0px', 'margin-top':'0px', 'border-radius': '40px'},500,function(){\n    el.css('display', 'none');\n  });\n  $('.grayout').css('display', 'none');\n}\n\n$(ME).find('.popupdialog-event-name-close').click(closeAddEventDialog);\n\nfunction closeAddDialog(){\n  var el = $(ME).find('.popupdialog-cmd-name');\n  el.animate({'width':'0px', 'height':'0px', 'margin-left':'0px', 'margin-top':'0px', 'border-radius': '40px'},500,function(){\n    el.css('display', 'none');\n  });\n  $('.grayout').css('display', 'none');\n}\n\n$(ME).find('.popupdialog-cmd-name-close').click(closeAddDialog);\n\n$(ME).find('.addthecmd').click(function(){\n  if ($(this).hasClass('mdl-button--colored')){\n    var name = $(ME).find('#newcommandname').val();\n    if (getByProperty(me.CTLDATA.cmd, 'name', name) != null) alert('There is already a command with that name');\n    else{\n      var data = { java: 'return null;' };\n      json('../botmanager/write', 'db='+db+'&data='+encodeURIComponent(JSON.stringify(data)), function(result){\n        if (result.status != 'ok') alert(result.msg);\n        else {\n          data.name = name;\n          data.java = result.id;\n\n          json('../botmanager/write', 'db='+db+'&data='+encodeURIComponent(JSON.stringify(data)), function(result){\n            if (result.status != 'ok') error(result.msg);\n            else{\n              data.id = result.id;\n              if (!me.CTLDATA.cmd) me.CTLDATA.cmd = [];\n              me.CTLDATA.cmd.push(data);\n              saveControl();\n              me.buildCommandList();\n              closeAddDialog();\n            }\n          });\n        }\n      });\n    }\n  }\n});\n\nvar validchars = 'abcdefghijklmnopqrstuvwxyz_0123456789';\n\nfunction checkname(a, b){\n  var s = $(ME).find(a).val();\n  var i = s.length;\n  if (i == 0) return false;\n  \n  var bool = true;\n  while (i-->0) if (validchars.indexOf(s.charAt(i)) == -1) { bool = false; break; }\n  if (bool) $(ME).find(b).removeClass('mdl-button--accent').addClass('mdl-button--colored').removeAttr('disabled');\n  else $(ME).find(b).removeClass('mdl-button--colored').addClass('mdl-button--accent').prop('disabled', 'true');\n};\n\nfunction checkcmdname(){ checkname('#newcommandname', '.addthecmd'); }\nfunction checktimername(){ checkname('#newtimername', '.addthetimer'); }\nfunction checkeventname(){ checkname('#neweventname', '.addtheevent'); }\n  \n$(ME).find('#newcommandname').change(checkcmdname);\n$(ME).find('#newcommandname').keyup(checkcmdname);\n\n$(ME).find('#newtimername').change(checktimername);\n$(ME).find('#newtimername').keyup(checktimername);\n\n$(ME).find('#neweventname').change(checkeventname);\n$(ME).find('#neweventname').keyup(checkeventname);\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","groups":"anonymous","html":"<div style='position:fixed;top:0px;left:0px;width:100%;height:100%;font-family: Roboto,sans-serif;'>\n  <table border='1' cellpadding='0' cellspacing='0' width='100%' height='100%'>\n    <tr>\n      <td height='80px' class='darkbg'>\n        <i class=\"mdc-icon-toggle material-icons menubutton menubuttonback\" role=\"button\" aria-label=\"Back\">arrow_back<\/i>\n        &nbsp;\n        <div class='pagetitle'>\n          Metabot Control Editor\n          <br>\n          <span class='ctl-lib'><\/span>:<span class='ctl-name'><\/span>\n        <\/div>\n        <br>\n        <button \n          id='b_html5' class='navbutton selected' data-role='none'>HTML5<\/button><button \n          id='b_three' class='navbutton' data-role='none'>3D<\/button><button \n          id='b_api' class='navbutton' data-role='none'>API<\/button><!--button \n          id='b_info' class='navbutton' data-role='none'>INFO<\/button--><button \n          id='b_publish' class='navbutton' data-role='none'>PUBLISH<\/button>\n      <\/td>\n    <\/tr>\n    <tr>\n      <td>\n        <div class='navtab html5'>\n          \n            <button class=\"previewbutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent\">preview<\/button>\n            <button class=\"savebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent addthelib\">save<\/button>\n          \n          \n          <table border='0' cellpadding='0' cellspacing='0' width='100%' height='100%'>\n            <tr>\n              <td width='25%'>\n                <div class='editor editor-html'>\n                  <div class='vbar'><\/div>\n                  <div class='editor-title'>\n                    HTML\n                  <\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-min\" aria-label=\"Minimize\">call_to_action<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-max\" aria-label=\"Maximize\">web_asset<\/div>\n                  <div class='editor-code'>\n                    <textarea class='editor-code-textarea html-textarea'><\/textarea>\n                  <\/div>\n                <\/div>\n              <\/td>\n              <td width='25%'>\n                <div class='editor editor-css'>\n                  <div class='grabbybar'><\/div>\n                  <div class='editor-title'>CSS<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-min\" aria-label=\"Minimize\">call_to_action<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-max\" aria-label=\"Maximize\">web_asset<\/div>\n                  <div class='editor-code'>\n                    <textarea class='editor-code-textarea css-textarea'><\/textarea>\n                  <\/div>\n                <\/div>\n              <\/td>\n              <td width='25%'>\n                <div class='editor editor-js'>\n                  <div class='grabbybar'><\/div>\n                  <div class='editor-title'>JS<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-min\" aria-label=\"Minimize\">call_to_action<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-max\" aria-label=\"Maximize\">web_asset<\/div>\n                  <div class='editor-code'>\n                    <textarea class='editor-code-textarea js-textarea'><\/textarea>\n                  <\/div>\n                <\/div>\n              <\/td>\n              <td>\n                <div class='editor editor-data'>\n                  <div class='grabbybar'><\/div>\n                  <div class='editor-title'>DATA<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-min\" aria-label=\"Minimize\">call_to_action<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-max\" aria-label=\"Maximize\">web_asset<\/div>\n                  <div class='editor-code'>\n                    <textarea class='editor-code-textarea data-textarea'><\/textarea>\n                  <\/div>\n                <\/div>\n              <\/td>\n            <\/tr>\n            <tr height='20px'>\n              <td colspan='4'>\n                <div class='grabby-v'>\n                  <div class='editor-title preview-title'>\n                    PREVIEW\n                  <\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-pmin\" aria-label=\"Minimize\">call_to_action<\/div>\n                  <div class=\"mdc-icon-toggle material-icons zoomer zoomer-pmax\" aria-label=\"Maximize\">web_asset<\/div>\n                <\/div>\n              <\/td>\n            <\/tr>\n            <tr id='previewrow'>\n              <td id='previewcol' colspan='4'><\/td>\n            <\/tr>\n          <\/table>\n        <\/div>\n        <div class='navtab three'>\n          <button class=\"savebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent addthelib\">save<\/button>\n          <div class='three-main'><\/div>\n        <\/div>\n        <div class='navtab api'>\n          <div class='api-main'>\n\n            <button class=\"savebutton mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent addthelib\">save<\/button>\n\n            <div class='mdl-card mdl-shadow--2dp overview'>\n              <div class=\"mdl-card__title\">\n                <h2 class=\"mdl-card__title-text\">Overview<\/h2>\n              <\/div>\n              <div class=\"mdl-card__supporting-text\">\n                <form action=\"#\">\n                  <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                    <input class=\"mdl-textfield__input\" type=\"text\" id=\"ov_groups\" placeholder=\"Comma separated no spaces\">\n                    <label class=\"mdl-textfield__label\" for=\"ov_groups\">Groups<\/label>\n                  <\/div>\n                <\/form>              \n                <div class='greentext'>Description<\/div>\n                <form action=\"#\">\n                  <div class=\"mdl-textfield mdl-js-textfield\">\n                    <textarea class=\"mdl-textfield__input\" type=\"text\" rows= \"3\" id=\"ov_desc\" placeholder=\"Enter a description for this control\" ><\/textarea>\n                    <label class=\"mdl-textfield__label\" for=\"ov_desc\">Description<\/label>\n                  <\/div>\n                <\/form>              \n              <\/div>\n            <\/div>\n            \n            \n            \n            \n            <div class='mdl-data-table-wrapper commandlist'>\n              \n              <table class=\"mdl-data-table mdl-js-data-table tablewhite\">\n                <thead>\n                  <tr>\n                    <th class=\"mdl-data-table__cell--non-numeric\" colspan=\"2\">Commands<\/th>\n                  <\/tr>\n                <\/thead>\n                <tbody class='commandlist-inner'>\n                <\/tbody>\n              <\/table>\n              <br>\n              <center>\n                <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addcommandbutton\">\n                  <i class=\"material-icons\">add<\/i>\n                <\/button>\n              <\/center>\n            <\/div>  \n            \n            <div class='mdl-data-table-wrapper timerlist'>\n              <table class=\"mdl-data-table mdl-js-data-table tablewhite\">\n                <thead>\n                  <tr>\n                    <th class=\"mdl-data-table__cell--non-numeric\" colspan=\"2\">Timers<\/th>\n                  <\/tr>\n                <\/thead>\n                <tbody class='timerlist-inner'>\n                <\/tbody>\n              <\/table>\n              <br>\n              <center>\n                <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addtimerbutton\">\n                  <i class=\"material-icons\">add<\/i>\n                <\/button>\n              <\/center>\n            <\/div>  \n            \n            <div class='mdl-data-table-wrapper eventlist'>\n              <table class=\"mdl-data-table mdl-js-data-table tablewhite\">\n                <thead>\n                  <tr>\n                    <th class=\"mdl-data-table__cell--non-numeric\" colspan=\"2\">Events<\/th>\n                  <\/tr>\n                <\/thead>\n                <tbody class='eventlist-inner'>\n                <\/tbody>\n              <\/table>\n              <br>\n              <center>\n                <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addeventbutton\">\n                  <i class=\"material-icons\">add<\/i>\n                <\/button>\n              <\/center>\n            <\/div>  \n\n          <\/div>        \n\n          <div class='api-editcommand'><\/div>\n          <div class='api-edittimer'><\/div>\n          <div class='api-editevent'><\/div>\n          \n          <div class='grayout'><\/div>\n          \n          \n          \n          \n          <div class=\"mdl-card mdl-shadow--2dp popupdialog-cmd-name\">\n            <div class=\"mdl-card__title\">\n              <h2 class=\"mdl-card__title-text\">New Command<\/h2>\n            <\/div>\n            <div class=\"mdl-card__supporting-text\">\n              <form action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                  <input class=\"mdl-textfield__input\" type=\"text\" id=\"newcommandname\">\n                  <label class=\"mdl-textfield__label\" for=\"newcommandname\">Name<\/label>\n                <\/div>\n              <\/form>\n              Lowercase letters, numbers and underscores only\n            <\/div>\n            <div class=\"mdl-card__actions mdl-card--border\">\n              <a class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent addthecmd\">\n                add\n              <\/a>\n            <\/div>\n            <div class=\"mdl-card__menu popupdialog-cmd-name-close\">\n              <button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">\n                <i class=\"material-icons\">close<\/i>\n              <\/button>\n            <\/div>\n          <\/div>          \n          \n          <div class=\"mdl-card mdl-shadow--2dp popupdialog-timer-name\">\n            <div class=\"mdl-card__title\">\n              <h2 class=\"mdl-card__title-text\">New Timer<\/h2>\n            <\/div>\n            <div class=\"mdl-card__supporting-text\">\n              <form action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                  <input class=\"mdl-textfield__input\" type=\"text\" id=\"newtimername\">\n                  <label class=\"mdl-textfield__label\" for=\"newtimername\">Name<\/label>\n                <\/div>\n              <\/form>\n              Lowercase letters, numbers and underscores only\n            <\/div>\n            <div class=\"mdl-card__actions mdl-card--border\">\n              <a class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent addthetimer\">\n                add\n              <\/a>\n            <\/div>\n            <div class=\"mdl-card__menu popupdialog-timer-name-close\">\n              <button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">\n                <i class=\"material-icons\">close<\/i>\n              <\/button>\n            <\/div>\n          <\/div>          \n          \n           <div class=\"mdl-card mdl-shadow--2dp popupdialog-event-name\">\n            <div class=\"mdl-card__title\">\n              <h2 class=\"mdl-card__title-text\">New event<\/h2>\n            <\/div>\n            <div class=\"mdl-card__supporting-text\">\n              <form action=\"#\">\n                <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n                  <input class=\"mdl-textfield__input\" type=\"text\" id=\"neweventname\">\n                  <label class=\"mdl-textfield__label\" for=\"neweventname\">Name<\/label>\n                <\/div>\n              <\/form>\n              Lowercase letters, numbers and underscores only\n            <\/div>\n            <div class=\"mdl-card__actions mdl-card--border\">\n              <a class=\"mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--accent addtheevent\">\n                add\n              <\/a>\n            <\/div>\n            <div class=\"mdl-card__menu popupdialog-event-name-close\">\n              <button class=\"mdl-button mdl-button--icon mdl-js-button mdl-js-ripple-effect\">\n                <i class=\"material-icons\">close<\/i>\n              <\/button>\n            <\/div>\n          <\/div>          \n         \n          \n          \n          \n          \n          \n        <\/div>\n        <div class='navtab info'>INFO<\/div>\n        <div class='navtab publish'><\/div>\n      <\/td>\n    <\/tr>\n  <\/table>\n<\/div>\n\n","ctl":"onuksv16156cf9595k2f52","cmd":[],"three":{"controls":[{"shape":"sphere","color":65280,"rotation":[0,0,0],"scale":[1,1,1],"id":"shape","position":[0,0,0],"uuid":"6561c927-5d60-4642-ba8c-a60db9b7b3ec","db":"test"}],"assets":[],"behaviors":[],"animations":[],"poses":[]},"db":"metabot","desc":""},"readers":["anonymous"],"id":"onuksv16156cf9595k2f52","sessionid":"jvgvwg16b7a4d277bt3","time":1640369439123,"addr":"/0:0:0:0:0:0:0:1:48202","username":"admin"}