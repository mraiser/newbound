{"data":{"timer":[],"css":".padsides{\n  margin-left:50px;\n  margin-right:50px;\n}\n\n.mdl-data-table-wrapper{\n  display:inline-block;\n  vertical-align:top;\n  margin-right:50px;\n}\n\n.deletelibrarybutton{\n  float:right;\n}\n\n.mdc-list-item__graphic{\n  cursor:pointer;\n}\n\n.chiptable{\n  position:relative;\n  top:-20px;\n  font-size:xx-small;\n}","data":[],"name":"libinfo","js":"var me = this; \nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  var v = ME.DATA.version ? ME.DATA.version : 0;\n  $(ME).find('.titlelibname').text(ME.DATA.id+' v'+v);\n  buildGroups();\n  buildControls();\n  buildAssets();\n  setCryptoSwitch();\n  componentHandler.upgradeAllRegistered();\n};\n\n$(ME).find('.addcontrolbutton').click(function(){\n  var data = {\n    title:'New Control',\n    text:'New Control name',\n    subtext:'lowercase letters, numbers, and underscores only.',\n    cancel:'cancel',\n    ok:'create',\n    validate:function(val){\n      if (val.length == 0) return false;\n      var validchars = 'abcdefghijklmnopqrstuvwxyz_0123456789';\n      var i = val.length;\n      while (i-->0) if (validchars.indexOf(val.charAt(i)) == -1) return false;\n      return true;\n    },\n    cb: function(val){\n      var ctl = { name: val };\n      json('../botmanager/write', 'db='+encodeURIComponent(ME.DATA.id)+'&data='+encodeURIComponent(JSON.stringify(ctl)), function(result){\n        if (result.status != 'ok') alert(result.msg);\n        else {\n          ctl.id = result.id;\n          if (!me.controls) me.controls = {};\n          if (!me.controls.list) me.controls.list = [];\n          me.controls.list.push(ctl);\n          saveControls();\n        }\n      });\n    }\n  };\n  installControl($(ME).find('.dialogdiv')[0], 'metabot', 'promptdialog', function(){}, data);\n});\n\n$(ME).find('.addassetbutton').click(function(){\n  var db = ME.DATA.id;\n  var data = {\n    title:'Upload Asset',\n    cancel:'cancel',\n    ok:'upload',\n    lib:db,\n    validate:function(val){\n      if (val.length == 0) return false;\n      return true;\n    },\n    cb: function(val){\n      var ctl = { name: val, id: val };\n\n      if (!me.assets) me.assets = {};\n      if (!me.assets.list) me.assets.list = [];\n      me.assets.list.push(ctl);\n      saveAssets();\n    }\n  };\n  installControl($(ME).find('.dialogdiv')[0], 'metabot', 'uploaddialog', function(){}, data);\n});\n\n$(ME).find('.deletelibrarybutton').click(function(){\n  var data = {\n    title:'Delete Library',\n    text:'Are you sure you want to delete this library? This cannot be undone.',\n    cancel:'cancel',\n    ok:'delete',\n    cb: function(){\n      var args = {lib:ME.DATA.id};\n      json('../metabot/call', 'db=metabot&name=metabot&cmd=deletelibrary&args='+encodeURIComponent(JSON.stringify(args)), function(result){\n        $('#libraries-tab')[0].api.ready();\n        $(ME).empty();\n      });\n    }\n  };\n  installControl($(ME).find('.dialogdiv')[0], 'metabot', 'confirmdialog', function(){}, data);\n});\n\nfunction saveControls(){\n  var ctl = me.controls;\n  var readers = [ \"anonymous\" ];\n  json('../botmanager/write', 'db='+encodeURIComponent(ME.DATA.id)+'&id=controls&readers='+encodeURIComponent(JSON.stringify(readers))+'&data='+encodeURIComponent(JSON.stringify(ctl)), function(result){\n    if (result.status != 'ok') alert(result.msg);\n    else {\n      buildControls();\n    }\n  });\n}\n\nfunction saveGroups(){\n  if (! ME.DATA.readers)  ME.DATA.readers = [];\n  json('../botmanager/convertdb', 'db='+encodeURIComponent(ME.DATA.id)+'&readers='+encodeURIComponent(JSON.stringify(ME.DATA.readers)), function(result){\n//    alert(JSON.stringify(result));\n  });\n}\n\nfunction buildGroups(){\n  var newhtml = '';\n  for (var i in ME.DATA.readers){\n    var g = ME.DATA.readers[i];\n    newhtml += '<span class=\"mdl-chip mdl-chip--deletable\"><span class=\"mdl-chip__text\">'+g+'<\/span><button type=\"button\" class=\"groupdelete mdl-chip__action\"><i class=\"material-icons\">cancel<\/i><\/button><\/span>';\n  }\n  $(ME).find('.groupchips').html(newhtml).find('.groupdelete').click(function(){\n    var i = ME.DATA.readers.indexOf($(this).prev().text());\n    ME.DATA.readers.splice(i,1);\n    buildGroups();\n    saveGroups();\n  });\n  json('../securitybot/listgroups', null, function(result){\n    newhtml = '<button id=\"groupmenu\" class=\"mdl-button mdl-js-button mdl-button--icon\"><i class=\"material-icons\">group_add<\/i><\/button><ul class=\"mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect\" for=\"groupmenu\">';\n    for (var i in result.data){\n      newhtml += '<li class=\"mdl-menu__item addgroup\">'+result.data[i]+'<\/li>';\n    }\n    newhtml += '<\/ul>';\n    $(ME).find('.groupchips').append(newhtml).find('.addgroup').click(function(){\n      if (! ME.DATA.readers)  ME.DATA.readers = [];\n      var i = ME.DATA.readers.indexOf($(this).text());\n      if (i == -1)  {\n        ME.DATA.readers.push($(this).text());\n        buildGroups();\n        saveGroups();\n      }\n    });\n    componentHandler.upgradeAllRegistered();\n  });\n}\n\nfunction buildControls(){\n  var db = ME.DATA.id;\n  json('../botmanager/read', 'db='+db+'&id=controls', function(result){\n    me.controls = result.data;\n    me.controls.list.sort(function(a,b) {return (a.name.toLowerCase() > b.name.toLowerCase()) ? 1 : ((b.name.toLowerCase() > a.name.toLowerCase()) ? -1 : 0);} ); \n    var newhtml = '';\n    for (var i in me.controls.list){\n      var ctl = me.controls.list[i];\n      var clickme = '<a class=\"previewctl\" href=\"../metabot/preview.html?db='+db+'&id='+ctl.id+'\" target=\"_blank\">'+ctl.name+'<\/a>';\n      newhtml += '<tr data-ctlitem=\"'+ctl.id+'\" class=\"ctlrow\"><td class=\"mdl-data-table__cell--non-numeric\">'+clickme+'<\/td><td class=\"mdl-data-table__cell--non-numeric\"><i class=\"editctlicon mdc-list-item__graphic material-icons\" aria-hidden=\"true\">edit<\/i><\/td><\/tr>';\n    }\n    $(ME).find('.controlsbody').html(newhtml);\n    $(ME).find('.editctlicon').click(function(){\n      window.location.href = '../metabot/editcontrol.html?db='+db+'&id='+$(this).closest('.ctlrow').data('ctlitem');\n    });\n  });  \n}\n\nfunction saveAssets(){\n  var ctl = me.assets;\n  var readers = [ \"anonymous\" ];\n  json('../botmanager/write', 'db='+encodeURIComponent(ME.DATA.id)+'&id=assets&readers='+encodeURIComponent(JSON.stringify(readers))+'&data='+encodeURIComponent(JSON.stringify(ctl)), function(result){\n    if (result.status != 'ok') alert(result.msg);\n    else {\n      buildAssets();\n    }\n  });\n}\n\nfunction buildAssets(){\n  var db = ME.DATA.id;\n  var args = {lib:db};\n  json('../metabot/call', 'db=metabot&name=metabot&cmd=rebuildassets&args='+encodeURIComponent(JSON.stringify(args)), function(result){\n    json('../botmanager/read', 'db='+db+'&id=assets', function(result){\n      me.assets = result.data;\n      me.assets.list.sort(function(a,b) {return (a.name.toLowerCase() > b.name.toLowerCase()) ? 1 : ((b.name.toLowerCase() > a.name.toLowerCase()) ? -1 : 0);} ); \n      var newhtml = '';\n      for (var i in me.assets.list){\n        var ctl = me.assets.list[i];\n        var clickme = '<a href=\"../botmanager/asset/'+db+'/'+ctl.id+'\" target=\"_blank\">'+ctl.name+'<\/a>';\n        newhtml += '<tr data-assitem=\"'+ctl.id+'\" class=\"assrow\"><td class=\"mdl-data-table__cell--non-numeric\">'+clickme+'<\/td><td class=\"mdl-data-table__cell--non-numeric\"><i class=\"mdc-list-item__graphic material-icons\" aria-hidden=\"true\">delete<\/i><\/td><\/tr>';\n      }\n      $(ME).find('.assetsbody').html(newhtml);\n      $(ME).find('.assrow').find('.mdc-list-item__graphic').click(function(){\n        var id = $(this).closest('.assrow').data('assitem');\n        var data = {\n          title:'Delete Asset',\n          text:'Are you sure you want to delete this Asset? This cannot be undone.',\n          cancel:'cancel',\n          ok:'delete',\n          cb: function(){\n//            alert(id);\n            \n            \n            \n            json('../botmanager/asset', 'db='+encodeURIComponent(ME.DATA.id)+'&name='+encodeURIComponent(id)+'&delete=true', function(result){\n              if (result.status != 'ok') alert('ERROR: '+result.msg);\n              else {\n                var a = getByProperty(me.assets.list, \"id\", id);\n                var i = me.assets.list.indexOf(a);\n                me.assets.list.splice(i,1);\n                saveAssets();\n              }\n            });\n            \n            \n            \n            \n            \n            \n          }\n        }\n        installControl($(ME).find('.dialogdiv')[0], 'metabot', 'confirmdialog', function(){}, data);\n      });\n    });  \n  });\n}\n\nfunction setCryptoSwitch(){\n  if (ME.DATA.encryption != \"NONE\"){\n    var x = $('#cryptoswitch').prop(\"checked\", true).parent()[0];\n    if (x.MaterialSwitch) x.MaterialSwitch.checkToggleState();\n  }\n  $('#cryptoswitch').change(function(){\n    var crypto = $('#cryptoswitch').prop(\"checked\") ? \"AES\" : \"NONE\";\n    json('../botmanager/convertdb', 'db='+encodeURIComponent(ME.DATA.id)+'&encryption='+crypto, function(result){\n      if (result.status != 'ok') alert(result.msg);\n    });\n  });\n}\n\n\n\n\n","groups":"","html":"<div class='padsides'>\n  <button class=\"mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect deletelibrarybutton\">\n    delete\n  <\/button>\n  \n  <h1 class='titlelibname'><\/h1>\n  <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" class=\"chiptable\"><tr><td width=\"150px\">\n      <label class=\"mdl-switch mdl-js-switch mdl-js-ripple-effect\" for=\"cryptoswitch\">\n        <input type=\"checkbox\" id=\"cryptoswitch\" class=\"mdl-switch__input\">\n        <span class=\"mdl-switch__label\">Encrypted<\/span>\n      <\/label>  \n    <\/td><td>\n      <div class='groupchips'><\/div>\n  <\/td><\/tr><\/table>\n  <div class='mdl-data-table-wrapper'>\n    <table class=\"mdl-data-table mdl-js-data-table\">\n      <thead>\n        <tr>\n          <th class=\"mdl-data-table__cell--non-numeric\" colspan=\"2\">Controls<\/th>\n        <\/tr>\n      <\/thead>\n      <tbody class='controlsbody'>\n      <\/tbody>\n    <\/table>\n    <br>\n    <center>\n      <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addcontrolbutton\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>\n    <\/center>\n  <\/div>  \n  \n  <div class='mdl-data-table-wrapper'>\n    <table class=\"mdl-data-table mdl-js-data-table\">\n      <thead>\n        <tr>\n          <th class=\"mdl-data-table__cell--non-numeric\" colspan=\"2\">Assets<\/th>\n        <\/tr>\n      <\/thead>\n      <tbody class='assetsbody'>\n      <\/tbody>\n    <\/table>\n    <br>\n    <center>\n      <button class=\"mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored addassetbutton\">\n        <i class=\"material-icons\">add<\/i>\n      <\/button>\n    <\/center>\n  <\/div>  \n  <br><br>\n<\/div>\n<div class='dialogdiv'><\/div>","ctl":"pzykkh1614869bc5apad0","cmd":[],"three":{"controls":[]},"db":"metabot","desc":""},"id":"pzykkh1614869bc5apad0","sessionid":"jhtpuq15d03ce0a74q0","time":1552938697247,"addr":"/0:0:0:0:0:0:0:1:50346","username":"mraiser"}