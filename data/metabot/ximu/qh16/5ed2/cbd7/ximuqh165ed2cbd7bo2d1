{"data":{"css":".outmost{\n  position:relative;\n}\n\n.addass {\n  top:0px;\n  left:280px;\n  position:absolute;\n  display:none;\n}\n","data":[],"name":"assetselect","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar cbs = [];\nvar lib = me.lib = ME.DATA.lib;\nif (!lib) {\n  var val = ME.DATA.value;\n  if (val){\n    var i = val.indexOf(':');\n    if (i>0){\n      lib = me.lib = val.substring(0,i);\n      me.selectedasset = val.substring(i+1);\n    }\n  }\n}\n\nme.ready = function(){\n  var validchars = 'abcdefghijklmnopqrstuvwxyz_0123456789';\n\n  function validateString(val){\n    if (val.length == 0) return false;\n    var i = val.length;\n    while (i-->0) if (validchars.indexOf(val.charAt(i)) == -1) return false;\n    return true;\n  }\n  \n  function libselcallback(val, ocb){\n    if (val){\n      lib = me.lib = ME.DATA.lib = val;\n      rebuild();\n    }\n  }\n  \n  if (ME.DATA.lib) libselcallback(ME.DATA.lib);\n  else{\n    function libselready(api){\n      libselcallback(api.value())\n    }\n\n    var data = {\n      allowadd:ME.DATA.allowadd,\n      allownone:ME.DATA.allownone,\n      value: lib,\n      ready: libselready,\n      cb: libselcallback\n    };\n\n    var el = $(ME).find('.libraryselect');\n    installControl(el[0], 'metabot', 'libraryselect', function(){}, data);\n  }\n\n  rebuild();\n\n  if (ME.DATA.cb) me.change(ME.DATA.cb);\n\n  var aa = ME.DATA.allowadd ? true : false;\n  if (aa) {\n    setTimeout(function(){\n      $(ME).find('.addass').css('display', 'block').click(function(){\n        var data = {\n          lib:me.lib,\n          validate:function(val){\n            if (val.length == 0) return false;\n            return true;\n          },\n          cb: function(val){\n            ME.DATA.value = val;\n            var ctl = { name: val, id: val };\n\n            if (!me.assets) me.assets = {};\n            if (!me.assets.list) me.assets.list = [];\n            me.assets.list.push(ctl);\n            saveAssets(function(){\n//              $(ME).find('.assetselect').find('select').val(val);\n              rebuild();\n            });\n          }\n        };\n        var eid = guid();\n        var el = $('<div id=\"'+eid+'\" class=\"uploadassetdialogdiv\"><\/div>')[0];\n        $('body').append(el);\n        installControl(el, 'metabot', 'uploaddialog', function(){}, data);\n      });\n    }, 1000);\n  }\n};\n\nfunction sortAssets(){\n  me.list.sort(function(a,b) {return (a.name.toLowerCase() > b.name.toLowerCase()) ? 1 : ((b.name.toLowerCase() > a.name.toLowerCase()) ? -1 : 0);} ); \n}  \n\nfunction rebuild(){\n  json('../botmanager/read', 'db='+lib+'&id=assets', function(result){\n    var alist = result.data ? result.data.list : [];\n    me.list = alist;\n    sortAssets();\n    me.assets = { list:me.list };\n\n    var l = ME.DATA.label ? ME.DATA.label : 'Select an Asset';\n    var a = ME.DATA.allownone ? true : false;\n    var data = {\n      label: l,\n      list: me.list,\n      value:me.selectedasset,\n      allownone:a,\n      cb:function(val){\n        for (var i in cbs) cbs[i](val);\n      },\n      ready:function(api){\n        if (ME.DATA.ready) ME.DATA.ready(me);\n      }\n    };\n\n    installControl($(ME).find('.assetselwrap')[0], 'metabot', 'select', function(api){}, data);\n  });\n}\n\nme.change = function(cb){\n  cbs.push(cb);\n};\n\nme.value = function(){\n  return $(ME).find('.assetselwrap').find('select').val();\n};\n\nfunction saveAssets(cb){\n  debugger;\n  var ctl = me.assets;\n  var readers = [ \"anonymous\" ];\n  json('../botmanager/write', 'db='+encodeURIComponent(me.lib)+'&id=assets&readers='+encodeURIComponent(JSON.stringify(readers))+'&data='+encodeURIComponent(JSON.stringify(ctl)), function(result){\n    if (result.status != 'ok') alert(result.msg);\n    else {\n      rebuild();\n    }\n  });\n}\n\n","groups":"anonymous","ctl":"ximuqh165ed2cbd7bo2d1","html":"<div class='libraryselect'><\/div>\n<div class='outmost'>\n  <div class='assetselwrap'><\/div>\n  <button class=\"mdl-button mdl-js-button mdl-button--icon mdl-button--colored addass addbut\">\n    <i class=\"material-icons\">add<\/i>\n  <\/button>  \n<\/div>\n","db":"metabot","desc":""},"readers":["anonymous"],"id":"ximuqh165ed2cbd7bo2d1","sessionid":"jvgvwg16b7a4d277bt3","time":1574954038190,"addr":"/0:0:0:0:0:0:0:1:49158","username":"admin"}