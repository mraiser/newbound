{"data":{"css":"canvas {\n  width: 100%;\n  height: 100%;\n}","data":[],"name":"dial","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar data = me.data = $(ME).data('control');\nvar canvas = me.canvas = $(ME).find('canvas')[0];\nvar ctx = me.ctx = canvas.getContext('2d');\n\nme.ready = function(){\n  me.value = $.isNumeric(me.data.value) ? me.data.value : '--';\n  me.units = me.data.units ? me.data.units : '';\n  me.title = me.data.title ? me.data.title : '';\n  me.range = me.data.range ? me.data.range : [0, 100];\n  me.refresh = me.data.refresh; \n  me.redraw();\n  \n  if (me.refresh){\n    function r(){\n      me.refresh(function(){\n        me.redraw();\n        if (me.refresh && $('#'+me.UUID)[0]) setTimeout(r, 1000);\n      });\n    }\n    r();\n  }\n};\n\nme.redraw = function(){\n  var w = $(ME).width();\n  var h = $(ME).height();\n  \n  var L = Math.min(w,h);\n  var offx = (w-L)/2;\n  var offy = (h-L)/2;\n\n  var v = me.value;\n  var percent = $.isNumeric(me.data.value) ? (v - me.range[0]) / (me.range[1] - me.range[0]) : 0;\n  var units = me.units;\n\n  var large = 56*L/150;\n  var medium = 24*L/150;\n  var small = 18*L/150;\n  \n  var stroke1 = 15*L/150;\n  var stroke2 = 5*L/150;\n  var stroke3 = 2*L/150;\n  \n  offy += medium / 2;\n\n  var h1 = offy + 20 + L/2; //yoff + 24*h/150;\n  var h2 = offy + large*0.65;\n  var h3 = offy + medium / 2; //*h/150;\n\n  canvas.width = w;\n  canvas.height = h;\n  \n  ctx.strokeStyle = '#aaa';\n  ctx.lineWidth = stroke1;\n  ctx.beginPath();\n  ctx.arc(offx+L/2,h1,L/3,0.75*Math.PI,2*Math.PI);\n  ctx.stroke();    \n  \n  ctx.strokeStyle = '#4b8c2a';\n  ctx.beginPath();\n  ctx.arc(offx+L/2,h1,L/3,0.75*Math.PI,0.75*Math.PI + percent*1.25*Math.PI);\n  ctx.stroke();  \n  \n  ctx.font = medium+\"px Arial\";\n  ctx.fillStyle = '#fff';\n  ctx.lineWidth = stroke3;\n  ctx.strokeStyle = '#000';\n  ctx.textAlign = 'center';\n  ctx.shadowColor = 'black';\n\n  ctx.strokeText(me.title,offx+L/2,h3);\n  ctx.fillText(me.title,offx+L/2,h3);\n\n  ctx.font = large+\"px Arial\";\n  ctx.lineWidth = stroke2;\n  ctx.strokeText(v,offx+L/2,h1+large/4);\n  ctx.fillText(v,offx+L/2,h1+large/4);\n\n  ctx.font = small+\"px Arial\";\n  ctx.lineWidth = stroke3;\n  ctx.strokeText(units,offx+L/2,h1+h2-offy);\n  ctx.fillText(units,offx+L/2,h1+h2-offy);\n};\n\nme.update = function(d){\n  me.value = me.data.value = d;\n  me.redraw();\n};\n","groups":"anonymous","ctl":"pzjouy16794af90f4g4bf","html":"<canvas />","three":{"controls":[]},"db":"metabot","desc":""},"readers":["anonymous"],"id":"pzjouy16794af90f4g4bf","sessionid":"jhtpuq15d03ce0a74q0","time":1551802180111,"addr":"/0:0:0:0:0:0:0:1:49353","username":"mraiser"}