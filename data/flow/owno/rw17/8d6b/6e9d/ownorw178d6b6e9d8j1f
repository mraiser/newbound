{"data":{"data":[],"name":"inputbar","groups":"anonymous","ctl":"ownorw178d6b6e9d8j1f","three":{"controls":[{"color":"0xffff00","pos":{"x":"0","y":"0","z":"0"},"rot":{"x":"0","y":"0","z":"0"},"name":"outerbox","scale":{"x":"1","y":"0.2","z":"0.2"},"id":"hmzspn1682ebb4187udc6e","uuid":"be2c7e00-1d8f-4da0-a19b-803236bca81a","db":"threejs"}],"assets":[],"behaviors":[{"name":"animate","id":"812d8917-f327-4be2-beb8-03d5c372fcec","params":[{"name":"model","type":"object"}],"body":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.data = ME.DATA;\nme.model = model;\nme.type = \"putbar\";\nme.box = me.children[0];\nif (!me.nodes) me.nodes = [];\nif (!me.minw) me.minw = 0.5;\nme.updateWidth();\n"},{"name":"render","id":"9aa158dd-d235-4e94-ab89-440a891e0658","params":[],"body":"var me = this;\nfor (var i in me.nodes) {\n  me.nodes[i].target_z = me.target_z;\n  me.nodes[i].target_rot = me.target_rot;\n}\n"},{"name":"dirty","id":"ee48a583-ecbc-4150-a484-0d10b2c79dcc","params":[],"body":"var me = this;\nme.parent.dirty();"},{"name":"getCode","id":"e5de943a-ca6c-42d5-8211-515c6cca8026","params":[],"body":"var me = this;\n\nvar o = {};\nfor (var j=0; j<me.nodes.length; j++){\n  var n = me.nodes[j];\n  if (!n.data.mode) n.data.mode = \"regular\";\n  o[n.data.name] = {\n    \"x\": n.model.rig.pos_x,\n    \"type\": n.data.type,\n    \"mode\": n.data.mode\n  };\n  if (n.data.loop){\n    if (n.data.loop.data) o[n.data.name].loop = n.data.loop.data.name;\n    else o[n.data.name].loop = n.data.loop;\n  }\n}\nreturn o;\n"},{"name":"spaceNodes","id":"95059c25-8cc1-43da-92c0-8a79e4d35600","params":[],"body":"var me = this;\nvar c = me.nodes.length;\nvar w = Math.max(me.box.rig.scale_x - 0.5, 0.25 * (c-1) + 0.5);\nvar d = c == 1 ? 0 : Math.max(0.25, w / (c-1));\nvar o = c == 1 ? 0 : w / -2;\nfor (var i=0; i<c; i++){\n  var node = me.nodes[i];\n  node.model.rig.pos_x = i * d + o;\n}\nme.updateWidth();\n"},{"name":"setNodes","id":"5c95aa6a-1fbd-4f4d-b4af-46ba4ad2fd06","params":[{"name":"data","type":"object"},{"name":"cb","type":"object"}],"body":"var me = this;\nvar list = [];\nfor (var name in data) list.push(name);\nif (me.nodes.length<list.length) me.addNode({\"name\": \"xxx\", \"type\": \"object\", \"mode\": \"regular\"}, new THREE.Vector3(0,0,0), function(api){\n  me.spaceNodes();\n  me.setNodes(data, cb);\n});\nelse {\n  while (me.nodes.length>list.length){\n    me.nodes[me.nodes.length-1].delete();\n  }\n  for (var i=0; i<me.nodes.length; i++)\n  {\n    var node = me.nodes[i];\n    var d = data[list[i]];\n    if (d.x) node.model.rig.pos_x = d.x;\n    node.data.name = list[i];\n    if (d.type) node.data.type = d.type;\n    if (d.mode) node.data.mode = d.mode;\n    if (d.loop) node.data.loop = d.loop;\n    if (node.editor){\n      node.editor.find(\".node_name\").val(list[i]);\n      node.editor.find(\".node_type_div\")[0].api.val(node.data.type);\n      node.editor.find(\".node_mode_div\")[0].api.val(node.data.mode);\n    }\n    node.checkIcon();\n  }\n  me.updateWidth();\n  if (cb) cb();\n}\n"},{"name":"updateWidth","id":"78cab84b-0674-4ad5-9c7c-e5202709b634","params":[],"body":"var me = this;\nvar minhalf = me.minw/2;\nvar minx = -minhalf;\nvar maxx = minhalf;\nfor (var i=0; i<me.nodes.length; i++){\n  if (Number(me.nodes[i].model.rig.pos_x)<minx) minx = Number(me.nodes[i].model.rig.pos_x);\n  if (Number(me.nodes[i].model.rig.pos_x)>maxx) maxx = Number(me.nodes[i].model.rig.pos_x);\n}\nme.minx = Math.min(0-(minhalf), minx);\nme.maxx = Math.max(me.minw/2, maxx);\n\nvar w = Math.max(me.minw, me.maxx - me.minx + 0.5);\nme.box.rig.scale_x = w;\nme.box.rig.pos_x = w/2 + me.minx - 0.25;\n\nif (me.parent && me.parent.updateWidth) me.parent.updateWidth();\n"},{"name":"select","id":"5a946f47-3b4b-4e45-83f4-dcd05afe0a71","params":[],"body":"var me = this;\nme.box.api.data.color = 0x0000ff;\nme.box.api.rebuild();\n"},{"name":"unselect","id":"887bef95-2420-45e2-bb3f-fc9cacdae16b","params":[],"body":"var me = this;\nme.box.api.data.color = 0xffffff;\nme.box.api.rebuild();\n"},{"name":"drag","id":"f89e3108-9e5f-4f9d-b676-0c1cfa103f93","params":[{"name":"event","type":"object"}],"body":"// FIXME - Adjust by click offset from centeer\nvar me = this;\nif (!me.immobile){\n  var pos = me.model.scene.viewer.to3D(event.clientX, event.clientY);\n  me.model.rig.pos_x = pos.x;\n  me.model.rig.pos_y = pos.y;\n  me.model.rig.pos_z = pos.z;\n  me.updateLines();\n}\n"},{"name":"updateLines","id":"86d8a935-825b-497a-b10a-4e2d82a192e1","params":[],"body":"var me = this;\nfor (var i in me.nodes) me.nodes[i].updateLines();"},{"name":"getNodeByName","id":"e243f440-e459-4a3d-a81a-5553bda4c80a","params":[{"name":"name","type":"object"}],"body":"var me = this;\nfor (var i in me.nodes) if (me.nodes[i].data.name == name) return me.nodes[i];\nreturn null;\n"},{"name":"nextNodeName","id":"aea54f02-1a9e-4ee9-8135-14082b37f826","params":[],"body":"var me = this;\nvar i = 0;\nwhile (i<26) { // FIXME\n  var res = String.fromCharCode(97+i++);\n  if (!me.getNodeByName(res)) return res;\n}\nreturn \"a\"+newDate().getTime();\n"},{"name":"addNode","id":"ad1e5511-2ba6-4944-b112-e6e3c80c04b4","params":[{"name":"ctl","type":"object"},{"name":"pos","type":"object"},{"name":"cb","type":"object"}],"body":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nvar el = $('<div/>');\n$(ME).append(el);\nme.model.scene.viewer.add(el[0], \"flow\", \"node\", function(model){\n  me.children.push(model);\n  me.nodes.push(model.api);\n  model.api.parent = me;\n  model.parent = me;\n  model.api.direction = me.direction;\n  model.rig.pos_x = pos.x;\n  if (cb) cb(model.api);\n}, ctl, me.model.group);\n"},{"name":"click","id":"49d5f251-07de-46e7-a32e-df21b26eeb38","params":[{"name":"e","type":"object"}],"body":"var me = this;\n\nif (!e.handled){\n  e.handled = true;\n  if (e.shiftKey) {\n    var pos = me.model.scene.viewer.to3D(e.clientX, e.clientY);\n    var m = me;\n    while (m && m.model && m.model.rig){\n      pos.x -= m.model.rig.pos_x;\n      m = m.parent;\n      if (m.type == 'case') break;\n    }\n    var ctl = {\n      \"name\": me.nextNodeName(),\n      \"type\": \"object\"\n    };\n    me.addNode(ctl, pos);\n  }\n  else {\n    var p = me.parent;\n    while (p.type != 'case') p = p.parent;\n    p.select(me);\n  }\n}\nreturn false;\n"}],"animations":[],"poses":[]},"db":"flow","attachmentkeynames":["html","css","js"],"desc":""},"readers":["anonymous"],"id":"ownorw178d6b6e9d8j1f","time":1640454970514,"addr":"/0:0:0:0:0:0:0:1:54118","username":"admin"}