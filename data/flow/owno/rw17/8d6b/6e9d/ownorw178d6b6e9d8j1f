{"data":{"attachmentkeynames":["html","css","js"],"ctl":"ownorw178d6b6e9d8j1f","data":[],"db":"flow","desc":"","groups":"anonymous","name":"inputbar","three":{"animations":[],"assets":[],"behaviors":[{"body":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.data = ME.DATA;\nme.model = model;\nme.type = \"putbar\";\nme.box = me.children[0];\nme.updateWidth();\n","id":"812d8917-f327-4be2-beb8-03d5c372fcec","name":"animate","params":[{"name":"model","type":"object"}]},{"body":"var me = this;\nfor (var i in me.nodes) {\n  me.nodes[i].target_z = me.target_z;\n  me.nodes[i].target_rot = me.target_rot;\n}\n","id":"9aa158dd-d235-4e94-ab89-440a891e0658","name":"render","params":[]},{"body":"var me = this;\nme.parent.dirty();","id":"ee48a583-ecbc-4150-a484-0d10b2c79dcc","name":"dirty","params":[]},{"body":"var me = this;\n\nvar o = {};\nfor (var j=0; j<me.nodes.length; j++){\n  var n = me.nodes[j];\n  if (!n.data.mode) n.data.mode = \"regular\";\n  o[n.data.name] = {\n    \"x\": n.model.rig.pos_x,\n    \"type\": n.data.type,\n    \"mode\": n.data.mode\n  };\n  if (n.data.loop){\n    if (n.data.loop.data) o[n.data.name].loop = n.data.loop.data.name;\n    else o[n.data.name].loop = n.data.loop;\n  }\n}\nreturn o;\n","id":"e5de943a-ca6c-42d5-8211-515c6cca8026","name":"getCode","params":[]},{"body":"var me = this;\nvar c = me.nodes.length;\nif (me.box && c>0){\n  var w = Math.max(me.box.rig.scale_x - 0.5, 0.25 * (c-1) + 0.5);\n  var d = c == 1 ? 0 : Math.max(0.25, w / (c-1));\n  var o = c == 1 ? 0 : w / -2;\n  for (var i=0; i<c; i++){\n    var node = me.nodes[i];\n    node.model.rig.pos_x = i * d + o;\n  }\n}\nme.updateWidth();\n","id":"95059c25-8cc1-43da-92c0-8a79e4d35600","name":"spaceNodes","params":[]},{"body":"var me = this;\nvar list = [];\nfor (var name in data) list.push(name);\nif (me.nodes.length<list.length) me.addNode({\"name\": \"xxx\", \"type\": \"object\", \"mode\": \"regular\"}, new THREE.Vector3(0,0,0), function(api){\n  me.spaceNodes();\n  me.setNodes(data, cb);\n});\nelse {\n  while (me.nodes.length>list.length){\n    me.nodes[me.nodes.length-1].delete();\n  }\n  for (var i=0; i<me.nodes.length; i++)\n  {\n    var node = me.nodes[i];\n    var d = data[list[i]];\n    if (d.x) node.model.rig.pos_x = d.x;\n    \n    if (!node.data) {\n      var NODE = $('#'+node.UUID)[0];\n      node.data = NODE.DATA;\n    }\n\n    node.data.name = list[i];\n    if (d.type) node.data.type = d.type;\n    if (d.mode) node.data.mode = d.mode;\n    if (d.loop) node.data.loop = d.loop;\n    if (node.editor){\n      node.editor.find(\".node_name\").val(list[i]);\n      node.editor.find(\".node_type_div\")[0].api.val(node.data.type);\n      node.editor.find(\".node_mode_div\")[0].api.val(node.data.mode);\n    }\n    node.checkIcon();\n  }\n  me.updateWidth();\n  if (cb) cb();\n}\n","id":"5c95aa6a-1fbd-4f4d-b4af-46ba4ad2fd06","name":"setNodes","params":[{"name":"data","type":"object"},{"name":"cb","type":"object"}]},{"body":"var me = this;\nif (!me.nodes) me.nodes = [];\nif (!me.minw) me.minw = 0.5;\nvar minhalf = me.minw/2;\nvar minx = -minhalf;\nvar maxx = minhalf;\nfor (var i=0; i<me.nodes.length; i++){\n  if (Number(me.nodes[i].model.rig.pos_x)<minx) minx = Number(me.nodes[i].model.rig.pos_x);\n  if (Number(me.nodes[i].model.rig.pos_x)>maxx) maxx = Number(me.nodes[i].model.rig.pos_x);\n}\nme.minx = Math.min(0-(minhalf), minx);\nme.maxx = Math.max(me.minw/2, maxx);\n\nif (me.box) {\n  var w = Math.max(me.minw, me.maxx - me.minx + 0.5);\n  me.box.rig.scale_x = w;\n  me.box.rig.pos_x = w/2 + me.minx - 0.25;\n}\n\nif (me.parent && me.parent.updateWidth) me.parent.updateWidth();\n","id":"78cab84b-0674-4ad5-9c7c-e5202709b634","name":"updateWidth","params":[]},{"body":"var me = this;\nme.box.api.data.color = 0x0000ff;\nme.box.api.rebuild();\n","id":"5a946f47-3b4b-4e45-83f4-dcd05afe0a71","name":"select","params":[]},{"body":"var me = this;\nme.box.api.data.color = 0xffffff;\nme.box.api.rebuild();\n","id":"887bef95-2420-45e2-bb3f-fc9cacdae16b","name":"unselect","params":[]},{"body":"// FIXME - Adjust by click offset from centeer\nvar me = this;\nif (!me.immobile){\n  var pos = me.model.scene.viewer.to3D(event.clientX, event.clientY);\n  me.model.rig.pos_x = pos.x;\n  me.model.rig.pos_y = pos.y;\n  me.model.rig.pos_z = pos.z;\n  me.updateLines();\n}\n","id":"f89e3108-9e5f-4f9d-b676-0c1cfa103f93","name":"drag","params":[{"name":"event","type":"object"}]},{"body":"var me = this;\nfor (var i in me.nodes) me.nodes[i].updateLines();","id":"86d8a935-825b-497a-b10a-4e2d82a192e1","name":"updateLines","params":[]},{"body":"var me = this;\nfor (var i in me.nodes) if (me.nodes[i].data.name == name) return me.nodes[i];\nreturn null;\n","id":"e243f440-e459-4a3d-a81a-5553bda4c80a","name":"getNodeByName","params":[{"name":"name","type":"object"}]},{"body":"var me = this;\nvar i = 0;\nwhile (i<26) { // FIXME\n  var res = String.fromCharCode(97+i++);\n  if (!me.getNodeByName(res)) return res;\n}\nreturn \"a\"+newDate().getTime();\n","id":"aea54f02-1a9e-4ee9-8135-14082b37f826","name":"nextNodeName","params":[]},{"body":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\n\nif (false) {\n\nvar el = $('<div/>');\n$(ME).append(el);\nme.model.scene.viewer.add(el[0], \"flow\", \"node\", function(model){\n  me.children.push(model);\n  me.nodes.push(model.api);\n  model.api.parent = me;\n  model.parent = me;\n  model.api.direction = me.direction;\n  model.rig.pos_x = pos.x;\n  if (cb) cb(model.api);\n}, ctl, me.model.group);\n\n  \n}","id":"ad1e5511-2ba6-4944-b112-e6e3c80c04b4","name":"addNode","params":[{"name":"ctl","type":"object"},{"name":"pos","type":"object"},{"name":"cb","type":"object"}]},{"body":"var me = this;\n\nif (!e.handled){\n  e.handled = true;\n  if (e.shiftKey) {\n    var pos = me.model.scene.viewer.to3D(e.clientX, e.clientY);\n    var m = me;\n    while (m && m.model && m.model.rig){\n      pos.x -= m.model.rig.pos_x;\n      m = m.parent;\n      if (m.type == 'case') break;\n    }\n    var ctl = {\n      \"name\": me.nextNodeName(),\n      \"type\": \"object\"\n    };\n    me.addNode(ctl, pos);\n  }\n  else {\n    var p = me.parent;\n    while (p.type != 'case') p = p.parent;\n    p.select(me);\n  }\n}\nreturn false;\n","id":"49d5f251-07de-46e7-a32e-df21b26eeb38","name":"click","params":[{"name":"e","type":"object"}]}],"controls":[{"color":"0xffff00","db":"app","id":"thjigj18acf15b42an59c","name":"outerbox","pos":{"x":"0","y":"0","z":"0"},"rot":{"x":"0","y":"0","z":"0"},"scale":{"x":"1","y":"0.2","z":"0.2"},"uuid":"be2c7e00-1d8f-4da0-a19b-803236bca81a"}],"poses":[]}},"id":"ownorw178d6b6e9d8j1f","readers":["anonymous"],"time":1703519857083,"username":"system","writers":[]}