{"data":{"css":"","data":[],"name":"operation_editor","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  if (!ME.DATA.name) ME.DATA.name = \"UNTITLED\";\n  $(ME).find(\".operation_name\").val(ME.DATA.name).keyup(function(x){\n    me.parent.setLabel($(event.target).val());\n  }).change(function(x){\n    me.parent.setLabel($(event.target).val());\n  });\n  $(ME).find(\".operation_cvalue\").val(ME.DATA.name).keyup(function(x){\n    me.parent.setLabel($(event.target).val());\n    $(ME).find(\".operation_name\").val($(event.target).val());\n  }).change(function(x){\n    me.parent.setLabel($(event.target).val());\n    $(ME).find(\".operation_name\").val($(event.target).val());\n  });\n  componentHandler.upgradeAllRegistered();\n  \n  if (!ME.DATA.type) ME.DATA.type = \"local\";\n  var d = { \n    \"list\": [ \"local\", \"primitive\", \"constant\", \"command\" ],\n    \"value\": ME.DATA.type,\n    \"label\": \"Type\",\n    \"cb\": function(val){\n      ME.DATA.type = val;\n      me.parent.setShape(val);\n      if (val == \"primitive\"){\n        val = me.primselect.value();\n        ME.DATA.name = val;\n        me.parent.setLabel(val);\n        $(ME).find(\".operation_name\").val(val);\n        me.parent.setNodes(me.prims[val]);\n      }\n      else if (val == \"constant\"){\n        me.parent.setNodes({\"in\":{}, \"out\":{\"a\":{}}});\n        $(ME).find(\".operation_cvalue\").val($(ME).find(\".operation_name\").val());\n      }\n      else if(val == \"command\"){\n        selectCommand();\n      }\n      updateLayout();\n    }\n  };\n  \n  var el = $(ME).find(\".operation_type_div\");\n  installControl(el[0], \"metabot\", \"select\", function(api){}, d);\n  \n  json(\"../botmanager/primitives\", null, function(result){\n    me.prims = result;\n    var list = [];\n    for (var name in me.prims) list.push(name);\n    var d = { \n      \"list\": list,\n      \"value\": ME.DATA.name,\n      \"label\": \"Primitive\",\n      \"cb\": function(val){\n        ME.DATA.name = val;\n        me.parent.setLabel(val);\n        $(ME).find(\".operation_name\").val(val);\n        me.parent.setNodes(me.prims[val]);\n      }\n    };\n  \n    var el = $(ME).find(\".operation_prim_list_div\");\n    installControl(el[0], \"metabot\", \"select\", function(api){ \n      me.primselect = api; \n    }, d);\n  });\n  \n  if (!ME.DATA.ctype) ME.DATA.ctype = 'string';\n  var d = { \n    \"list\": [ \"int\", \"decimal\", \"boolean\", \"string\", \"object\", \"array\" ],\n    \"value\": ME.DATA.ctype,\n    \"label\": \"Constant Type\",\n    \"cb\": function(val){\n      ME.DATA.ctype = val;\n    }\n  };\n  var el = $(ME).find(\".operation_ctype_list_div\");\n  installControl(el[0], \"metabot\", \"select\", function(api){}, d);\n\n  var d = {\n    \"value\": ME.DATA.command,\n    \"cb\": function(val){\n      if (ME.DATA.type == \"command\") selectCommand();\n    },\n    \"ready\": function(api) {\n      me.cmdsel = api;\n    }\n  };\n  var el = $(ME).find(\".commandselectdiv\");\n  installControl(el[0], \"metabot\", \"commandselect\", function(api){}, d);\n\n  updateLayout();\n};\n\nfunction selectCommand(){\n  var cmdid = me.cmdsel.value();\n  var cmdname = me.cmdsel.name();\n  var cmdctl = me.cmdsel.ctlsel.value();\n  var ctllib = me.cmdsel.ctlsel.lib;\n  ME.DATA.command = ctllib+\":\"+cmdctl+\":\"+cmdid;\n  me.parent.setLabel(cmdname);\n  $(ME).find(\".operation_name\").val(cmdname);\n  //var command = me.cmdsel.command();\n  json('../botmanager/read', 'db='+ctllib+'&id='+cmdid, function(result){\n    var type = result.data.type ? result.data.type : result.data.lang ? result.data.lang : \"java\";\n    var code = result.data[type];\n    json('../botmanager/read', 'db='+ctllib+'&id='+code, function(result){\n      // FIXME - Does not match list of ctypes\n      var nodes = {};\n      nodes.in = {};\n      nodes.out = {\n        \"result\" : {\n          \"type\": result.data.returntype ? result.data.returntype.toLowerCase() : \"object\"\n        }\n      };\n      for (var i in result.data.params){\n        var param = result.data.params[i];\n        nodes.in[param.name] = {\n          \"type\": param.type.toLowerCase()\n        };\n      }\n      me.parent.setNodes(nodes);\n    });\n  });\n}\n\nfunction updateLayout(){\n  $(ME).find(\".operation_name\").closest(\"form\").css(\"display\", ME.DATA.type == \"local\" ? \"block\" : \"none\"); \n  $(ME).find(\".operation_prim_list_div\").css(\"display\", ME.DATA.type == \"primitive\" ? \"block\" : \"none\"); \n  $(ME).find(\".operation_ctype\").css(\"display\", ME.DATA.type == \"constant\" ? \"block\" : \"none\");   \n  $(ME).find(\".commandselectdiv\").css(\"display\", ME.DATA.type == \"command\" ? \"block\" : \"none\");   \n};","groups":"","ctl":"qkuyuv178f4f93d86t19","html":"<h3>Operation<\/h3>\n<div class=\"operation_type_div\"><\/div>\n<form action=\"#\">\n  <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n    <input class=\"mdl-textfield__input operation_name\" type=\"text\" id=\"operation_name\">\n    <label class=\"mdl-textfield__label\" for=\"operation_name\">Label<\/label>\n  <\/div>\n<\/form>\n<div class=\"operation_prim_list_div\"><\/div>\n<div class=\"operation_ctype\">\n  <div class=\"operation_ctype_list_div\"><\/div>\n  <form action=\"#\">\n    <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n      <input class=\"mdl-textfield__input operation_cvalue\" type=\"text\" id=\"operation_cvalue\">\n      <label class=\"mdl-textfield__label\" for=\"operation_cvalue\">Value<\/label>\n    <\/div>\n  <\/form>\n<\/div>\n<div class=\"commandselectdiv\" ><\/div>","three":{"controls":[]},"db":"flow","desc":""},"id":"qkuyuv178f4f93d86t19","sessionid":"jvgvwg16b7a4d277bt3","time":1619276769525,"addr":"/0:0:0:0:0:0:0:1:33736","username":"admin"}