{"data":{"css":"","data":[],"name":"operation_editor","js":"var me = this;\nvar ME = $('#'+me.UUID)[0];\n\nme.ready = function(){\n  if (!ME.DATA.name) ME.DATA.name = \"UNTITLED\";\n  $(ME).find(\".operation_name\").val(ME.DATA.name).keyup(function(x){\n    me.parent.setLabel($(event.target).val());\n  }).change(function(x){\n    me.parent.setLabel($(event.target).val());\n  });\n  $(ME).find(\".operation_cvalue\").val(ME.DATA.name).keyup(function(x){\n    me.parent.setLabel($(event.target).val());\n    $(ME).find(\".operation_name\").val($(event.target).val());\n  }).change(function(x){\n    me.parent.setLabel($(event.target).val());\n    $(ME).find(\".operation_name\").val($(event.target).val());\n  });\n  componentHandler.upgradeAllRegistered();\n  \n  if (!ME.DATA.type) ME.DATA.type = \"local\";\n  var d = { \n    \"list\": [ \"local\", \"primitive\", \"constant\", \"command\", \"match\" ],\n    \"value\": ME.DATA.type,\n    \"label\": \"Type\",\n    \"cb\": function(val){\n      ME.DATA.type = val;\n      me.parent.setShape(val);\n      if (val == \"primitive\"){\n        val = me.primselect.value();\n        ME.DATA.name = val;\n        me.parent.setLabel(val);\n        $(ME).find(\".operation_name\").val(val);\n        me.parent.setNodes(me.prims[val]);\n      }\n      else if (val == \"constant\"){\n        me.parent.setNodes({\"in\":{}, \"out\":{\"a\":{}}});\n        $(ME).find(\".operation_cvalue\").val($(ME).find(\".operation_name\").val());\n      }\n      else if (val == \"match\"){\n        me.parent.setNodes({\"out\":{}, \"in\":{\"a\":{}}});\n      }\n      else if(val == \"command\"){\n        selectCommand();\n      }\n      updateLayout();\n    }\n  };\n  \n  var el = $(ME).find(\".operation_type_div\");\n  installControl(el[0], \"metabot\", \"select\", function(api){}, d);\n  \n  json(\"../botmanager/primitives\", null, function(result){\n    me.prims = result;\n    var list = [];\n    for (var name in me.prims) list.push(name);\n    var d = { \n      \"list\": list,\n      \"value\": ME.DATA.name,\n      \"label\": \"Primitive\",\n      \"cb\": function(val){\n        ME.DATA.name = val;\n        me.parent.setLabel(val);\n        $(ME).find(\".operation_name\").val(val);\n        me.parent.setNodes(me.prims[val]);\n      }\n    };\n  \n    var el = $(ME).find(\".operation_prim_list_div\");\n    installControl(el[0], \"metabot\", \"select\", function(api){ \n      me.primselect = api; \n    }, d);\n  });\n  \n  if (!ME.DATA.ctype) ME.DATA.ctype = 'string';\n  var d = { \n    \"list\": [ \"int\", \"decimal\", \"boolean\", \"string\", \"object\", \"array\" ],\n    \"value\": ME.DATA.ctype,\n    \"label\": \"Constant Type\",\n    \"cb\": function(val){\n      ME.DATA.ctype = val;\n    }\n  };\n  var el = $(ME).find(\".operation_ctype_list_div\");\n  installControl(el[0], \"metabot\", \"select\", function(api){}, d);\n\n  var d = {\n    \"value\": ME.DATA.cmd,\n    \"cb\": function(val){\n      if (ME.DATA.type == \"command\") selectCommand();\n    },\n    \"ready\": function(api) {\n      me.cmdsel = api;\n    }\n  };\n  var el = $(ME).find(\".commandselectdiv\");\n  installControl(el[0], \"metabot\", \"commandselect\", function(api){}, d);\n\n  updateLayout();\n};\n\nfunction selectCommand(){\n  var cmdid = me.cmdsel.value();\n  var cmdname = me.cmdsel.name();\n  var cmdctl = me.cmdsel.ctlsel.value();\n  var ctllib = me.cmdsel.ctlsel.lib;\n  ME.DATA.cmd = ctllib+\":\"+cmdctl+\":\"+cmdid;\n  me.parent.setLabel(cmdname);\n  $(ME).find(\".operation_name\").val(cmdname);\n  //var command = me.cmdsel.command();\n  json('../botmanager/read', 'db='+ctllib+'&id='+cmdid, function(result){\n    var type = result.data.type ? result.data.type : result.data.lang ? result.data.lang : \"java\";\n    var code = result.data[type];\n    json('../botmanager/read', 'db='+ctllib+'&id='+code, function(result){\n      // FIXME - Does not match list of ctypes\n      var nodes = {};\n      nodes.in = {};\n      nodes.out = {\n        \"result\" : {\n          \"type\": result.data.returntype ? result.data.returntype.toLowerCase() : \"object\"\n        }\n      };\n      for (var i in result.data.params){\n        var param = result.data.params[i];\n        nodes.in[param.name] = {\n          \"type\": param.type.toLowerCase()\n        };\n      }\n      me.parent.setNodes(nodes);\n    });\n  });\n}\n\nfunction updateLayout(){\n  if (ME.DATA.type == \"constant\") {\n    ME.DATA.condition = null;\n    $(ME).find(\".conditionselectdiv\").css(\"display\", \"none\");\n  }\n  else $(ME).find(\".conditionselectdiv\").css(\"display\", \"block\");\n  \n  $(ME).find(\".operation_name\").closest(\"form\").css(\"display\", ME.DATA.type == \"local\" || ME.DATA.type == \"match\" ? \"block\" : \"none\"); \n  $(ME).find(\".operation_prim_list_div\").css(\"display\", ME.DATA.type == \"primitive\" ? \"block\" : \"none\"); \n  $(ME).find(\".operation_ctype\").css(\"display\", ME.DATA.type == \"constant\" || ME.DATA.type == \"match\" ? \"block\" : \"none\");   \n  $(ME).find(\".commandselectdiv\").css(\"display\", ME.DATA.type == \"command\" ? \"block\" : \"none\");   \n  $(ME).find(\".isconcheckbox\").css(\"display\", ME.DATA.type == \"match\" ? \"none\" : \"inline-block\");   \n  $(ME).find(\".ifconditionisallowed\").css(\"margin-left\", ME.DATA.type == \"match\" ? \"0px\" : \"25px\");   \n  $(ME).find(\".showonconditional\").css(\"display\", ME.DATA.condition ? \"block\" : \"none\");\n  try { \n    $(ME).find(\"#isconditional\").prop(\"checked\", typeof ME.DATA.condition == \"object\" && ME.DATA.condition != null).parent()[0].MaterialCheckbox.checkToggleState(); \n    if (ME.DATA.condition){\n      $(ME).find(\"#ontrue\").prop(\"checked\", ME.DATA.condition.value).parent()[0].MaterialRadio.checkToggleState();\n      $(ME).find(\"#onfalse\").prop(\"checked\", !ME.DATA.condition.value).parent()[0].MaterialRadio.checkToggleState();\n      $(ME).find(\"#nextcase\").prop(\"checked\", ME.DATA.condition.rule == \"next\").parent()[0].MaterialRadio.checkToggleState();\n      $(ME).find(\"#terminate\").prop(\"checked\", ME.DATA.condition.rule == \"terminate\").parent()[0].MaterialRadio.checkToggleState();\n      $(ME).find(\"#finish\").prop(\"checked\", ME.DATA.condition.rule == \"finish\").parent()[0].MaterialRadio.checkToggleState();\n      $(ME).find(\"#fail\").prop(\"checked\", ME.DATA.condition.rule == \"fail\").parent()[0].MaterialRadio.checkToggleState();\n    }\n  } catch (x) {};\n};\n\n$(ME).find(\"#isconditional\").change(function(e){\n  var b = $(this).prop(\"checked\");\n  $(ME).find('.showonconditional').css(\"display\", b ? \"block\" : \"none\");\n  ME.DATA.condition = b ? {\n      \"value\": true,\n      \"rule\": \"next\"\n    } : null;\n  me.parent.checkIcon();\n  updateLayout();\n});\n\n$(ME).find(\"#ontrue\").click(function(e){\n  ME.DATA.condition.value = true;\n  me.parent.checkIcon();\n});\n\n$(ME).find(\"#onfalse\").click(function(e){\n  ME.DATA.condition.value = false;\n  me.parent.checkIcon();\n});\n\n$(ME).find(\"#nextcase\").click(function(e){\n  ME.DATA.condition.rule = \"next\";\n  me.parent.checkIcon();\n});\n\n$(ME).find(\"#terminate\").click(function(e){\n  ME.DATA.condition.rule = \"terminate\";\n  me.parent.checkIcon();\n});\n\n$(ME).find(\"#finish\").click(function(e){\n  ME.DATA.condition.rule = \"finish\";\n  me.parent.checkIcon();\n});\n\n$(ME).find(\"#fail\").click(function(e){\n  ME.DATA.condition.rule = \"fail\";\n  me.parent.checkIcon();\n});","groups":"","ctl":"qkuyuv178f4f93d86t19","html":"<h3>Operation<\/h3>\n<div class=\"operation_type_div\"><\/div>\n<form action=\"#\">\n  <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n    <input class=\"mdl-textfield__input operation_name\" type=\"text\" id=\"operation_name\">\n    <label class=\"mdl-textfield__label\" for=\"operation_name\">Label<\/label>\n  <\/div>\n<\/form>\n<div class=\"operation_prim_list_div\"><\/div>\n<div class=\"operation_ctype\">\n  <div class=\"operation_ctype_list_div\"><\/div>\n  <form action=\"#\">\n    <div class=\"mdl-textfield mdl-js-textfield mdl-textfield--floating-label\">\n      <input class=\"mdl-textfield__input operation_cvalue\" type=\"text\" id=\"operation_cvalue\">\n      <label class=\"mdl-textfield__label\" for=\"operation_cvalue\">Value<\/label>\n    <\/div>\n  <\/form>\n<\/div>\n<div class=\"commandselectdiv\" ><\/div>\n<div class=\"conditionselectdiv\" style=\"position:relative;\">\n  <label class=\"mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect isconcheckbox\" for=\"isconditional\" style=\"position:absolute;top:-2px;\">\n    <input type=\"checkbox\" id=\"isconditional\" class=\"mdl-checkbox__input\">\n    <span class=\"mdl-checkbox__label\"><\/span>\n  <\/label>\n  <div class=\"ifconditionisallowed\" style=\"margin-left:25px;\">Condition<\/div>\n  <div class=\"showonconditional\">\n    <div class=\"indent\">\n      <label class=\"mdl-radio mdl-js-radio mdl-js-ripple-effect\" for=\"ontrue\">\n        <input type=\"radio\" id=\"ontrue\" class=\"mdl-radio__button\" name=\"conditions\" value=\"1\" checked>\n        <span class=\"mdl-radio__label\">on true<\/span>\n      <\/label>\n      <br>\n      <label class=\"mdl-radio mdl-js-radio mdl-js-ripple-effect\" for=\"onfalse\">\n        <input type=\"radio\" id=\"onfalse\" class=\"mdl-radio__button\" name=\"conditions\" value=\"2\">\n        <span class=\"mdl-radio__label\">on false<\/span>\n      <\/label>\n    <\/div>\n    Rule\n    <div class=\"indent\">\n      <label class=\"mdl-radio mdl-js-radio mdl-js-ripple-effect\" for=\"nextcase\">\n        <input type=\"radio\" id=\"nextcase\" class=\"mdl-radio__button\" name=\"rules\" value=\"1\" checked>\n        <span class=\"mdl-radio__label\">next case<\/span>\n      <\/label>\n      <br>\n      <label class=\"mdl-radio mdl-js-radio mdl-js-ripple-effect\" for=\"terminate\">\n        <input type=\"radio\" id=\"terminate\" class=\"mdl-radio__button\" name=\"rules\" value=\"2\">\n        <span class=\"mdl-radio__label\">terminate<\/span>\n      <\/label>\n      <br>\n      <label class=\"mdl-radio mdl-js-radio mdl-js-ripple-effect\" for=\"finish\">\n        <input type=\"radio\" id=\"finish\" class=\"mdl-radio__button\" name=\"rules\" value=\"2\">\n        <span class=\"mdl-radio__label\">finish<\/span>\n      <\/label>\n      <br>\n      <label class=\"mdl-radio mdl-js-radio mdl-js-ripple-effect\" for=\"fail\">\n        <input type=\"radio\" id=\"fail\" class=\"mdl-radio__button\" name=\"rules\" value=\"2\">\n        <span class=\"mdl-radio__label\">fail<\/span>\n      <\/label>\n    <\/div>\n  <\/div>\n<\/div>","three":{"controls":[]},"db":"flow","desc":""},"id":"qkuyuv178f4f93d86t19","sessionid":"jvgvwg16b7a4d277bt3","time":1622315854043,"addr":"/0:0:0:0:0:0:0:1:57224","username":"admin"}